INFO     2023-06-20 20:18:12.917 request id: app - logging:callHandlers - Started server process [26827]
INFO     2023-06-20 20:18:12.918 request id: app - logging:callHandlers - Started server process [26827]
INFO     2023-06-20 20:18:12.918 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:18:12.918 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:18:12.918 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:18:12.918 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:18:29.543 request id: None - main:root - Here Is Your Info Log
INFO     2023-06-20 20:18:29.544 request id: app - logging:callHandlers - 127.0.0.1:51544 - "GET / HTTP/1.1" 200
INFO     2023-06-20 20:18:43.561 request id: None - main:root - Here Is Your Info Log
INFO     2023-06-20 20:18:43.562 request id: app - logging:callHandlers - 127.0.0.1:51545 - "GET / HTTP/1.1" 200
INFO     2023-06-20 20:18:49.055 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:18:49.055 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:18:49.158 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:18:49.158 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:18:49.158 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:18:49.159 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:18:49.159 request id: app - logging:callHandlers - Finished server process [26827]
INFO     2023-06-20 20:18:49.159 request id: app - logging:callHandlers - Finished server process [26827]
INFO     2023-06-20 20:18:49.393 request id: app - logging:callHandlers - Started server process [26884]
INFO     2023-06-20 20:18:49.393 request id: app - logging:callHandlers - Started server process [26884]
INFO     2023-06-20 20:18:49.393 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:18:49.394 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:18:49.394 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:18:49.394 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:19:01.359 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:19:01.360 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:19:01.460 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:19:01.461 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:19:01.461 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:19:01.461 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:19:01.462 request id: app - logging:callHandlers - Finished server process [26884]
INFO     2023-06-20 20:19:01.462 request id: app - logging:callHandlers - Finished server process [26884]
INFO     2023-06-20 20:19:01.704 request id: app - logging:callHandlers - Started server process [26907]
INFO     2023-06-20 20:19:01.704 request id: app - logging:callHandlers - Started server process [26907]
INFO     2023-06-20 20:19:01.704 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:19:01.704 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:19:01.705 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:19:01.705 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:19:04.891 request id: None - main:root - Here Is Your Info Log
INFO     2023-06-20 20:19:04.934 request id: app - logging:callHandlers - 127.0.0.1:51568 - "GET / HTTP/1.1" 500
ERROR    2023-06-20 20:19:04.935 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104d54ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104c61a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104c60fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106b57bd0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>
    │    └ <function subprocess_started at 0x105c24e00>
    └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106b691d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105c13e20>
           │       │   └ <uvicorn.server.Server object at 0x106b691d0>
           │       └ <function run at 0x105779a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x106b70d00>
           │      └ <function Runner.run at 0x1057bd9e0>
           └ <asyncio.runners.Runner object at 0x104bdbf50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1057e7600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104bdbf50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1057e7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1057bd3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10577a340>
    └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106b6ac50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106badbd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106b6ac50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105851890>
          └ <fastapi.applications.FastAPI object at 0x106badbd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106bb4e00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106b55b90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105851890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106b57e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106b55b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106badd50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106b57e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1068ad440>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106bb49a0>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106bc78d0>
                     └ <function get_request_handler.<locals>.app at 0x106bb4900>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10687b920>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': <starlette.requests.Request object at 0x106bc78d0>}
                 │         └ <function root at 0x106bb4860>
                 └ <fastapi.dependencies.models.Dependant object at 0x106baee10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 23, in root
    a = 1 / 0

ZeroDivisionError: division by zero
ERROR    2023-06-20 20:19:04.945 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104d54ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104c61a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104c60fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106b57bd0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>
    │    └ <function subprocess_started at 0x105c24e00>
    └ <SpawnProcess name='SpawnProcess-3' parent=26824 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106b691d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105c13e20>
           │       │   └ <uvicorn.server.Server object at 0x106b691d0>
           │       └ <function run at 0x105779a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x106b70d00>
           │      └ <function Runner.run at 0x1057bd9e0>
           └ <asyncio.runners.Runner object at 0x104bdbf50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1057e7600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104bdbf50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1057e7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1057bd3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10577a340>
    └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x106bb3af0>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106b6ac50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106badbd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106b6ac50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105851890>
          └ <fastapi.applications.FastAPI object at 0x106badbd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106bb4e00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106b55b90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105851890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106b57e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106b55b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106badd50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106b57e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1068ad440>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106bb4f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106bc77d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106bb49a0>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106bc78d0>
                     └ <function get_request_handler.<locals>.app at 0x106bb4900>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10687b920>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'request': <starlette.requests.Request object at 0x106bc78d0>}
                 │         └ <function root at 0x106bb4860>
                 └ <fastapi.dependencies.models.Dependant object at 0x106baee10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 23, in root
    a = 1 / 0

ZeroDivisionError: division by zero
INFO     2023-06-20 20:25:47.388 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:25:47.395 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:25:47.497 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:25:47.497 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:25:47.498 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:25:47.498 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:25:47.499 request id: app - logging:callHandlers - Finished server process [26907]
INFO     2023-06-20 20:25:47.499 request id: app - logging:callHandlers - Finished server process [26907]
ERROR    2023-06-20 20:29:34.629 request id: app - logging:callHandlers - Form data requires "python-multipart" to be installed. 
You can install "python-multipart" with: 

pip install python-multipart

ERROR    2023-06-20 20:29:34.629 request id: app - logging:callHandlers - Form data requires "python-multipart" to be installed. 
You can install "python-multipart" with: 

pip install python-multipart

INFO     2023-06-20 20:29:52.063 request id: app - logging:callHandlers - Started server process [28222]
INFO     2023-06-20 20:29:52.063 request id: app - logging:callHandlers - Started server process [28222]
INFO     2023-06-20 20:29:52.063 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:29:52.064 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:29:52.064 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:29:52.064 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:30:02.683 request id: app - logging:callHandlers - 127.0.0.1:52086 - "GET /apidocs HTTP/1.1" 404
INFO     2023-06-20 20:30:44.438 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:30:44.439 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:30:44.540 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:30:44.541 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:30:44.542 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:30:44.542 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:30:44.543 request id: app - logging:callHandlers - Finished server process [28222]
INFO     2023-06-20 20:30:44.543 request id: app - logging:callHandlers - Finished server process [28222]
INFO     2023-06-20 20:30:44.918 request id: app - logging:callHandlers - Started server process [28312]
INFO     2023-06-20 20:30:44.918 request id: app - logging:callHandlers - Started server process [28312]
INFO     2023-06-20 20:30:44.919 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:30:44.919 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:30:44.919 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:30:44.919 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:30:55.717 request id: app - logging:callHandlers - 127.0.0.1:52323 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:30:56.057 request id: app - logging:callHandlers - 127.0.0.1:52323 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:31:11.633 request id: app - logging:callHandlers - 127.0.0.1:52324 - "POST / HTTP/1.1" 405
INFO     2023-06-20 20:31:24.419 request id: app - logging:callHandlers - 127.0.0.1:52337 - "POST / HTTP/1.1" 405
INFO     2023-06-20 20:31:38.816 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:31:38.816 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:31:38.918 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:31:38.918 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:31:38.919 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:31:38.919 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:31:38.920 request id: app - logging:callHandlers - Finished server process [28312]
INFO     2023-06-20 20:31:38.920 request id: app - logging:callHandlers - Finished server process [28312]
INFO     2023-06-20 20:31:39.403 request id: app - logging:callHandlers - Started server process [28421]
INFO     2023-06-20 20:31:39.403 request id: app - logging:callHandlers - Started server process [28421]
INFO     2023-06-20 20:31:39.403 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:31:39.403 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:31:39.404 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:31:39.404 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:31:49.695 request id: app - logging:callHandlers - 127.0.0.1:52348 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:31:49.696 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ffcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f09a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f08fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1122881d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    └ <function subprocess_started at 0x105eccd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1122894d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ebbd80>
           │       │   └ <uvicorn.server.Server object at 0x1122894d0>
           │       └ <function run at 0x105a219e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11228d030>
           │      └ <function Runner.run at 0x105a91940>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105a8f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105a8f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105a91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a222a0>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112282e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
          └ <fastapi.applications.FastAPI object at 0x112282e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1122deca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112282010>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x111830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1122de7a0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1122f8510>
                     └ <function get_request_handler.<locals>.app at 0x1122de980>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 231, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x111816480>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/dependencies/utils.py", line 624, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
                   │                 │       └ {}
                   │                 └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                   └ <function run_in_threadpool at 0x1105e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                 │     │         └ <function run_sync at 0x1105eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1105ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError('path in endpoint is not allowed')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <functools._lru_cache_wrapper object at 0x111bc10c0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1122fa680>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 45, in get_storage_service
    return MinioStorage()
           └ <class 'services.minio_storage.MinioStorage'>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 14, in __init__
    self.client = Minio(
    │             └ <class 'miniopy_async.api.Minio'>
    └ <services.minio_storage.MinioStorage object at 0x1122fa750>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 156, in __init__
    self._base_url = BaseURL(
    │                └ <class 'miniopy_async.helpers.BaseURL'>
    └ <miniopy_async.api.Minio object at 0x11230a690>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/helpers.py", line 418, in __init__
    raise ValueError("path in endpoint is not allowed")

ValueError: path in endpoint is not allowed
ERROR    2023-06-20 20:31:49.711 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ffcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f09a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f08fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1122881d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    └ <function subprocess_started at 0x105eccd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1122894d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ebbd80>
           │       │   └ <uvicorn.server.Server object at 0x1122894d0>
           │       └ <function run at 0x105a219e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11228d030>
           │      └ <function Runner.run at 0x105a91940>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105a8f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105a8f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105a91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a222a0>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112282e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
          └ <fastapi.applications.FastAPI object at 0x112282e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1122deca0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112282010>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x111830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1122dede0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1122f8750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1122de7a0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1122f8510>
                     └ <function get_request_handler.<locals>.app at 0x1122de980>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 231, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x111816480>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/dependencies/utils.py", line 624, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
                   │                 │       └ {}
                   │                 └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                   └ <function run_in_threadpool at 0x1105e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                 │     │         └ <function run_sync at 0x1105eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1105ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError('path in endpoint is not allowed')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <functools._lru_cache_wrapper object at 0x111bc10c0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1122fa680>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 45, in get_storage_service
    return MinioStorage()
           └ <class 'services.minio_storage.MinioStorage'>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 14, in __init__
    self.client = Minio(
    │             └ <class 'miniopy_async.api.Minio'>
    └ <services.minio_storage.MinioStorage object at 0x1122fa750>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 156, in __init__
    self._base_url = BaseURL(
    │                └ <class 'miniopy_async.helpers.BaseURL'>
    └ <miniopy_async.api.Minio object at 0x11230a690>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/helpers.py", line 418, in __init__
    raise ValueError("path in endpoint is not allowed")

ValueError: path in endpoint is not allowed
INFO     2023-06-20 20:32:00.146 request id: app - logging:callHandlers - 127.0.0.1:52353 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:32:00.306 request id: app - logging:callHandlers - 127.0.0.1:52353 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:32:10.165 request id: app - logging:callHandlers - 127.0.0.1:52354 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:32:10.165 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ffcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f09a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f08fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1122881d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    └ <function subprocess_started at 0x105eccd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1122894d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ebbd80>
           │       │   └ <uvicorn.server.Server object at 0x1122894d0>
           │       └ <function run at 0x105a219e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11228d030>
           │      └ <function Runner.run at 0x105a91940>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105a8f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105a8f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105a91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a222a0>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112282e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
          └ <fastapi.applications.FastAPI object at 0x112282e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x112434360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112282010>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x111830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1122de7a0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x11233cf50>
                     └ <function get_request_handler.<locals>.app at 0x1122de980>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 231, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x111816480>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/dependencies/utils.py", line 624, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
                   │                 │       └ {}
                   │                 └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                   └ <function run_in_threadpool at 0x1105e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                 │     │         └ <function run_sync at 0x1105eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1105ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError('path in endpoint is not allowed')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <functools._lru_cache_wrapper object at 0x111bc10c0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1124a6780>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 45, in get_storage_service
    return MinioStorage()
           └ <class 'services.minio_storage.MinioStorage'>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 14, in __init__
    self.client = Minio(
    │             └ <class 'miniopy_async.api.Minio'>
    └ <services.minio_storage.MinioStorage object at 0x11233c0d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 156, in __init__
    self._base_url = BaseURL(
    │                └ <class 'miniopy_async.helpers.BaseURL'>
    └ <miniopy_async.api.Minio object at 0x11233c110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/helpers.py", line 418, in __init__
    raise ValueError("path in endpoint is not allowed")

ValueError: path in endpoint is not allowed
ERROR    2023-06-20 20:32:10.171 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ffcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f09a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f08fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1122881d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    └ <function subprocess_started at 0x105eccd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1122894d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ebbd80>
           │       │   └ <uvicorn.server.Server object at 0x1122894d0>
           │       └ <function run at 0x105a219e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11228d030>
           │      └ <function Runner.run at 0x105a91940>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105a8f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105a8f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105a91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a222a0>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112282e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
          └ <fastapi.applications.FastAPI object at 0x112282e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x112434360>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112282010>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x111830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1124345e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124a2c10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1122de7a0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x11233cf50>
                     └ <function get_request_handler.<locals>.app at 0x1122de980>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 231, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x111816480>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/dependencies/utils.py", line 624, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
                   │                 │       └ {}
                   │                 └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                   └ <function run_in_threadpool at 0x1105e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                 │     │         └ <function run_sync at 0x1105eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1105ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError('path in endpoint is not allowed')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <functools._lru_cache_wrapper object at 0x111bc10c0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1124a6780>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 45, in get_storage_service
    return MinioStorage()
           └ <class 'services.minio_storage.MinioStorage'>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 14, in __init__
    self.client = Minio(
    │             └ <class 'miniopy_async.api.Minio'>
    └ <services.minio_storage.MinioStorage object at 0x11233c0d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 156, in __init__
    self._base_url = BaseURL(
    │                └ <class 'miniopy_async.helpers.BaseURL'>
    └ <miniopy_async.api.Minio object at 0x11233c110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/helpers.py", line 418, in __init__
    raise ValueError("path in endpoint is not allowed")

ValueError: path in endpoint is not allowed
INFO     2023-06-20 20:34:39.952 request id: app - logging:callHandlers - 127.0.0.1:52414 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:34:40.075 request id: app - logging:callHandlers - 127.0.0.1:52414 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:34:48.893 request id: app - logging:callHandlers - 127.0.0.1:52415 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:34:48.894 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ffcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f09a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f08fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1122881d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    └ <function subprocess_started at 0x105eccd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1122894d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ebbd80>
           │       │   └ <uvicorn.server.Server object at 0x1122894d0>
           │       └ <function run at 0x105a219e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11228d030>
           │      └ <function Runner.run at 0x105a91940>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105a8f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105a8f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105a91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a222a0>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112282e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
          └ <fastapi.applications.FastAPI object at 0x112282e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x112434f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112282010>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x111830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1122de7a0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1124ba0d0>
                     └ <function get_request_handler.<locals>.app at 0x1122de980>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 231, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x111816480>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/dependencies/utils.py", line 624, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
                   │                 │       └ {}
                   │                 └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                   └ <function run_in_threadpool at 0x1105e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                 │     │         └ <function run_sync at 0x1105eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1105ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError('path in endpoint is not allowed')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <functools._lru_cache_wrapper object at 0x111bc10c0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1122fa680>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 45, in get_storage_service
    return MinioStorage()
           └ <class 'services.minio_storage.MinioStorage'>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 14, in __init__
    self.client = Minio(
    │             └ <class 'miniopy_async.api.Minio'>
    └ <services.minio_storage.MinioStorage object at 0x1124ae650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 156, in __init__
    self._base_url = BaseURL(
    │                └ <class 'miniopy_async.helpers.BaseURL'>
    └ <miniopy_async.api.Minio object at 0x11248a510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/helpers.py", line 418, in __init__
    raise ValueError("path in endpoint is not allowed")

ValueError: path in endpoint is not allowed
ERROR    2023-06-20 20:34:48.906 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ffcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f09a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f08fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1122881d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>
    │    └ <function subprocess_started at 0x105eccd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1122894d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ebbd80>
           │       │   └ <uvicorn.server.Server object at 0x1122894d0>
           │       └ <function run at 0x105a219e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11228d030>
           │      └ <function Runner.run at 0x105a91940>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105a8f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105e78dd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105a8f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105a91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a222a0>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis...not allowed')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112282e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11228ad90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
          └ <fastapi.applications.FastAPI object at 0x112282e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x112434f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111f01d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1122f59d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112282010>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1122f6f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x111830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x112435080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1124b2250>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1122de7a0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1124ba0d0>
                     └ <function get_request_handler.<locals>.app at 0x1122de980>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 231, in app
    solved_result = await solve_dependencies(
                          └ <function solve_dependencies at 0x111816480>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/dependencies/utils.py", line 624, in solve_dependencies
    solved = await run_in_threadpool(call, **sub_values)
                   │                 │       └ {}
                   │                 └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                   └ <function run_in_threadpool at 0x1105e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <functools._lru_cache_wrapper object at 0x111bc10c0>
                 │     │         └ <function run_sync at 0x1105eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1105ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=ValueError('path in endpoint is not allowed')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <functools._lru_cache_wrapper object at 0x111bc10c0>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1122fa680>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 45, in get_storage_service
    return MinioStorage()
           └ <class 'services.minio_storage.MinioStorage'>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 14, in __init__
    self.client = Minio(
    │             └ <class 'miniopy_async.api.Minio'>
    └ <services.minio_storage.MinioStorage object at 0x1124ae650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 156, in __init__
    self._base_url = BaseURL(
    │                └ <class 'miniopy_async.helpers.BaseURL'>
    └ <miniopy_async.api.Minio object at 0x11248a510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/helpers.py", line 418, in __init__
    raise ValueError("path in endpoint is not allowed")

ValueError: path in endpoint is not allowed
INFO     2023-06-20 20:38:23.200 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:38:23.201 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:38:23.302 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:38:23.303 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:38:23.303 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:38:23.304 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:38:23.304 request id: app - logging:callHandlers - Finished server process [28421]
INFO     2023-06-20 20:38:23.304 request id: app - logging:callHandlers - Finished server process [28421]
INFO     2023-06-20 20:38:23.688 request id: app - logging:callHandlers - Started server process [29113]
INFO     2023-06-20 20:38:23.689 request id: app - logging:callHandlers - Started server process [29113]
INFO     2023-06-20 20:38:23.689 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:38:23.689 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:38:23.689 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:38:23.689 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:38:29.306 request id: app - logging:callHandlers - 127.0.0.1:52523 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:38:29.507 request id: app - logging:callHandlers - 127.0.0.1:52523 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:38:38.537 request id: None - main:upload_file - collections_my.py
INFO     2023-06-20 20:38:38.540 request id: app - logging:callHandlers - 127.0.0.1:52524 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:38:38.541 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10941a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109538fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1066b8680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10951e980>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10953b610>
                     └ <function get_request_handler.<locals>.app at 0x10951eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'collections_my.py'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'collections_my.py'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'collections_my.py'
    │           │    └ <function ORJSONResponse.render at 0x1066f0900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x10947f590>
    └ <fastapi.responses.ORJSONResponse object at 0x10947f590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104b4cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104a59a80>
           └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104a58fe0>
    └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1094c3710>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>
    │    └ <function subprocess_started at 0x105a20d60>
    └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1094c8a50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105a0bd80>
           │       │   └ <uvicorn.server.Server object at 0x1094c8a50>
           │       └ <function run at 0x1055719e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1094cd030>
           │      └ <function Runner.run at 0x1055e5940>
           └ <asyncio.runners.Runner object at 0x1059c8e10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055df560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1059c8e10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055df4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1055e5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055722a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1094ca190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109524cd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1094ca190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109538f10>
          └ <fastapi.applications.FastAPI object at 0x109524cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10951ef20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1067f1f50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109538f10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109538fd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1067f1f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x1095396d0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10953ca80>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10953ca80>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x10951f2e0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x109708410>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106578e00>
          └ <starlette.datastructures.UploadFile object at 0x109708410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x105a8f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x10952bd30>
          │                 └ <starlette.datastructures.UploadFile object at 0x109708410>
          └ <function run_in_threadpool at 0x1064bc180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10952bd30>>
                 │     │         └ <function run_sync at 0x1064bef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1064be700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10952bd30>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x109538c80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x10952bd30>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:38:38.561 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10941a850>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109538fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1066b8680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10951e980>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10953b610>
                     └ <function get_request_handler.<locals>.app at 0x10951eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'collections_my.py'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'collections_my.py'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'collections_my.py'
    │           │    └ <function ORJSONResponse.render at 0x1066f0900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x10947f590>
    └ <fastapi.responses.ORJSONResponse object at 0x10947f590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104b4cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104a59a80>
           └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104a58fe0>
    └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1094c3710>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>
    │    └ <function subprocess_started at 0x105a20d60>
    └ <SpawnProcess name='SpawnProcess-4' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1094c8a50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105a0bd80>
           │       │   └ <uvicorn.server.Server object at 0x1094c8a50>
           │       └ <function run at 0x1055719e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1094cd030>
           │      └ <function Runner.run at 0x1055e5940>
           └ <asyncio.runners.Runner object at 0x1059c8e10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055df560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1059c8e10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055df4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1055e5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055722a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1094ca190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109524cd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1094ca190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109538f10>
          └ <fastapi.applications.FastAPI object at 0x109524cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10951ef20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1067f1f50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109538f10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10951f060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10953b390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109538fd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1067f1f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x1095396d0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10953ca80>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10953ca80>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x10951f2e0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x109708410>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106578e00>
          └ <starlette.datastructures.UploadFile object at 0x109708410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x105a8f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x10952bd30>
          │                 └ <starlette.datastructures.UploadFile object at 0x109708410>
          └ <function run_in_threadpool at 0x1064bc180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10952bd30>>
                 │     │         └ <function run_sync at 0x1064bef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1064be700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10952bd30>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x109538c80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x10952bd30>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:40:09.346 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:40:09.347 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:40:09.448 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:40:09.448 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:40:09.449 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:40:09.449 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:40:09.449 request id: app - logging:callHandlers - Finished server process [29113]
INFO     2023-06-20 20:40:09.450 request id: app - logging:callHandlers - Finished server process [29113]
INFO     2023-06-20 20:40:09.807 request id: app - logging:callHandlers - Started server process [29302]
INFO     2023-06-20 20:40:09.808 request id: app - logging:callHandlers - Started server process [29302]
INFO     2023-06-20 20:40:09.808 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:40:09.808 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:40:09.808 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:40:09.808 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:40:23.654 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:40:23.655 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:40:23.756 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:40:23.757 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:40:23.758 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:40:23.758 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:40:23.758 request id: app - logging:callHandlers - Finished server process [29302]
INFO     2023-06-20 20:40:23.758 request id: app - logging:callHandlers - Finished server process [29302]
INFO     2023-06-20 20:40:24.137 request id: app - logging:callHandlers - Started server process [29327]
INFO     2023-06-20 20:40:24.137 request id: app - logging:callHandlers - Started server process [29327]
INFO     2023-06-20 20:40:24.137 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:40:24.137 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:40:24.138 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:40:24.138 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:40:25.742 request id: app - logging:callHandlers - 127.0.0.1:52575 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:40:25.897 request id: app - logging:callHandlers - 127.0.0.1:52575 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:40:31.946 request id: None - main:upload_file - closest_0.py
INFO     2023-06-20 20:40:31.947 request id: app - logging:callHandlers - 127.0.0.1:52576 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:40:31.947 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107ae0fd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107af6250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107030680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107ada980>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107af5ed0>
                     └ <function get_request_handler.<locals>.app at 0x107adab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'closest_0.py'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'closest_0.py'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'closest_0.py'
    │           │    └ <function ORJSONResponse.render at 0x107068900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x107afc810>
    └ <fastapi.responses.ORJSONResponse object at 0x107afc810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102ff0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102cf9a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102cf8fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x107a7f810>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>
    │    └ <function subprocess_started at 0x1057b4d60>
    └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107a84b90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1057a3d80>
           │       │   └ <uvicorn.server.Server object at 0x107a84b90>
           │       └ <function run at 0x10553d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x107a89030>
           │      └ <function Runner.run at 0x1055ad940>
           └ <asyncio.runners.Runner object at 0x105760d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055ab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105760d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055ab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1055ad300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10553e2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107a86310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x107ae0e50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107a86310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107af6190>
          └ <fastapi.applications.FastAPI object at 0x107ae0e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107adade0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107af6210>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107af6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107af6250>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107af6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x107afdc90>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x107afdf00>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x107afdf00>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x107adb2e0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x107c00310>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106d18e00>
          └ <starlette.datastructures.UploadFile object at 0x107c00310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10622b4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x107af1960>
          │                 └ <starlette.datastructures.UploadFile object at 0x107c00310>
          └ <function run_in_threadpool at 0x106c5c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x107af1960>>
                 │     │         └ <function run_sync at 0x106c5ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x106c5e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x107af1960>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x107c72c80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x107af1960>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:40:31.961 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107ae0fd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107af6250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107030680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107ada980>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107af5ed0>
                     └ <function get_request_handler.<locals>.app at 0x107adab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'closest_0.py'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'closest_0.py'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'closest_0.py'
    │           │    └ <function ORJSONResponse.render at 0x107068900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x107afc810>
    └ <fastapi.responses.ORJSONResponse object at 0x107afc810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102ff0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102cf9a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102cf8fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x107a7f810>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>
    │    └ <function subprocess_started at 0x1057b4d60>
    └ <SpawnProcess name='SpawnProcess-6' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107a84b90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1057a3d80>
           │       │   └ <uvicorn.server.Server object at 0x107a84b90>
           │       └ <function run at 0x10553d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x107a89030>
           │      └ <function Runner.run at 0x1055ad940>
           └ <asyncio.runners.Runner object at 0x105760d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055ab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x105760d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055ab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1055ad300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10553e2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107a86310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x107ae0e50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107a86310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107af6190>
          └ <fastapi.applications.FastAPI object at 0x107ae0e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107adade0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107af6210>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107af6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107adb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107afc990>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107af6250>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107af6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x107afdc90>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x107afdf00>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x107afdf00>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x107adb2e0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x107c00310>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106d18e00>
          └ <starlette.datastructures.UploadFile object at 0x107c00310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10622b4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x107af1960>
          │                 └ <starlette.datastructures.UploadFile object at 0x107c00310>
          └ <function run_in_threadpool at 0x106c5c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x107af1960>>
                 │     │         └ <function run_sync at 0x106c5ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x106c5e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x107af1960>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x107c72c80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x107af1960>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:42:42.833 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:42:42.834 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:42:42.935 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:42:42.936 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:42:42.937 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:42:42.937 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:42:42.937 request id: app - logging:callHandlers - Finished server process [29327]
INFO     2023-06-20 20:42:42.937 request id: app - logging:callHandlers - Finished server process [29327]
INFO     2023-06-20 20:42:43.363 request id: app - logging:callHandlers - Started server process [29571]
INFO     2023-06-20 20:42:43.363 request id: app - logging:callHandlers - Started server process [29571]
INFO     2023-06-20 20:42:43.363 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:42:43.363 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:42:43.364 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:42:43.364 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:42:45.443 request id: app - logging:callHandlers - 127.0.0.1:52621 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:42:45.602 request id: app - logging:callHandlers - 127.0.0.1:52621 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:42:53.642 request id: None - main:upload_file - calculator.py
INFO     2023-06-20 20:42:53.650 request id: app - logging:callHandlers - 127.0.0.1:52622 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:42:53.651 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108be0b10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108bf5c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104b38680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x108bdaa20>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108bf9310>
                     └ <function get_request_handler.<locals>.app at 0x108bdaac0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'calculator.py'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'calculator.py'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'calculator.py'
    │           │    └ <function ORJSONResponse.render at 0x104b74900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x107bf5410>
    └ <fastapi.responses.ORJSONResponse object at 0x107bf5410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102eccae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102dd9a80>
           └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102dd8fe0>
    └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108b7f350>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>
    │    └ <function subprocess_started at 0x103da0d60>
    └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108b88710>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x103d8bd80>
           │       │   └ <uvicorn.server.Server object at 0x108b88710>
           │       └ <function run at 0x1038f19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108b81470>
           │      └ <function Runner.run at 0x103961940>
           └ <asyncio.runners.Runner object at 0x108b7d450>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10395f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108b7d450>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10395f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103961300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1038f22a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108b89f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108b73c10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108b89f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1043107d0>
          └ <fastapi.applications.FastAPI object at 0x108b73c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108bdb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104299390>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1043107d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108bf5c10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104299390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x108bf89d0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108c55b40>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108c55b40>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x108bdb380>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x108bfbdd0>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x1049f8e00>
          └ <starlette.datastructures.UploadFile object at 0x108bfbdd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x103f0f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x108be6860>
          │                 └ <starlette.datastructures.UploadFile object at 0x108bfbdd0>
          └ <function run_in_threadpool at 0x10493c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108be6860>>
                 │     │         └ <function run_sync at 0x10493ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10493e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108be6860>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x108bf7c80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x108be6860>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:42:53.668 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108be0b10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108bf5c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104b38680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x108bdaa20>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108bf9310>
                     └ <function get_request_handler.<locals>.app at 0x108bdaac0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'calculator.py'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'calculator.py'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'calculator.py'
    │           │    └ <function ORJSONResponse.render at 0x104b74900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x107bf5410>
    └ <fastapi.responses.ORJSONResponse object at 0x107bf5410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102eccae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102dd9a80>
           └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102dd8fe0>
    └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108b7f350>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>
    │    └ <function subprocess_started at 0x103da0d60>
    └ <SpawnProcess name='SpawnProcess-7' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108b88710>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x103d8bd80>
           │       │   └ <uvicorn.server.Server object at 0x108b88710>
           │       └ <function run at 0x1038f19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108b81470>
           │      └ <function Runner.run at 0x103961940>
           └ <asyncio.runners.Runner object at 0x108b7d450>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10395f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x108b7d450>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10395f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103961300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1038f22a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108b89f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108b73c10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108b89f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1043107d0>
          └ <fastapi.applications.FastAPI object at 0x108b73c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108bdb240>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104299390>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1043107d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdae80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108b7d010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108bf5c10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104299390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x108bf89d0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108c55b40>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108c55b40>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x108bdb380>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x108bfbdd0>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x1049f8e00>
          └ <starlette.datastructures.UploadFile object at 0x108bfbdd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x103f0f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x108be6860>
          │                 └ <starlette.datastructures.UploadFile object at 0x108bfbdd0>
          └ <function run_in_threadpool at 0x10493c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108be6860>>
                 │     │         └ <function run_sync at 0x10493ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10493e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108be6860>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x108bf7c80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x108be6860>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:43:31.816 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:43:31.817 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:43:31.919 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:43:31.919 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:43:31.920 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:43:31.920 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:43:31.920 request id: app - logging:callHandlers - Finished server process [29571]
INFO     2023-06-20 20:43:31.920 request id: app - logging:callHandlers - Finished server process [29571]
INFO     2023-06-20 20:43:32.279 request id: app - logging:callHandlers - Started server process [29663]
INFO     2023-06-20 20:43:32.279 request id: app - logging:callHandlers - Started server process [29663]
INFO     2023-06-20 20:43:32.279 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:43:32.279 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:43:32.280 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:43:32.280 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:43:35.004 request id: None - main:upload_file - <starlette.datastructures.UploadFile object at 0x1060312d0>
INFO     2023-06-20 20:43:35.006 request id: app - logging:callHandlers - 127.0.0.1:52650 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:43:35.008 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1028f0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102671a80>
           └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102670fe0>
    └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105fb7750>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>
    │    └ <function subprocess_started at 0x1040bcd60>
    └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105fc0b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1040abd80>
           │       │   └ <uvicorn.server.Server object at 0x105fc0b10>
           │       └ <function run at 0x1033c19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x105fb9470>
           │      └ <function Runner.run at 0x103431940>
           └ <asyncio.runners.Runner object at 0x104068c10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10342f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104068c10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10342f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103431300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1033c22a0>
    └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d23a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106018cd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d23a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10602e110>
          └ <fastapi.applications.FastAPI object at 0x106018cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106012f20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10602e1d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10602e110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10602e210>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10602e1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106018e10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10602e210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1055a8680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106012a20>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10602f790>
                     └ <function get_request_handler.<locals>.app at 0x106012ac0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'ok'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'ok'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'ok'
    │           │    └ <function ORJSONResponse.render at 0x1055e0900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x105fb6110>
    └ <fastapi.responses.ORJSONResponse object at 0x105fb6110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse
ERROR    2023-06-20 20:43:35.026 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1028f0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102671a80>
           └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102670fe0>
    └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105fb7750>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>
    │    └ <function subprocess_started at 0x1040bcd60>
    └ <SpawnProcess name='SpawnProcess-8' parent=28220 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105fc0b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1040abd80>
           │       │   └ <uvicorn.server.Server object at 0x105fc0b10>
           │       └ <function run at 0x1033c19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x105fb9470>
           │      └ <function Runner.run at 0x103431940>
           └ <asyncio.runners.Runner object at 0x104068c10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10342f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104068c10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10342f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103431300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1033c22a0>
    └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10601f130>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d23a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106018cd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d23a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10602e110>
          └ <fastapi.applications.FastAPI object at 0x106018cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106012f20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10602e1d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10602e110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10602e210>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10602e1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106018e10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10602e210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1055a8680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106013060>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10602c590>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106012a20>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10602f790>
                     └ <function get_request_handler.<locals>.app at 0x106012ac0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 270, in app
    response = actual_response_class(content, **response_args)
               │                     │          └ {'background': None}
               │                     └ 'ok'
               └ <class 'fastapi.responses.ORJSONResponse'>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 196, in __init__
    super().__init__(content, status_code, headers, media_type, background)
                     │        │            │        │           └ None
                     │        │            │        └ None
                     │        │            └ None
                     │        └ 200
                     └ 'ok'
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 55, in __init__
    self.body = self.render(content)
    │           │    │      └ 'ok'
    │           │    └ <function ORJSONResponse.render at 0x1055e0900>
    │           └ <fastapi.responses.ORJSONResponse object at 0x105fb6110>
    └ <fastapi.responses.ORJSONResponse object at 0x105fb6110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/responses.py", line 31, in render
    assert orjson is not None, "orjson must be installed to use ORJSONResponse"
           └ None

AssertionError: orjson must be installed to use ORJSONResponse
INFO     2023-06-20 20:43:56.141 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:43:56.143 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:43:56.245 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:43:56.246 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:43:56.249 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:43:56.249 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:43:56.249 request id: app - logging:callHandlers - Finished server process [29663]
INFO     2023-06-20 20:43:56.249 request id: app - logging:callHandlers - Finished server process [29663]
INFO     2023-06-20 20:44:05.681 request id: app - logging:callHandlers - Started server process [29770]
INFO     2023-06-20 20:44:05.681 request id: app - logging:callHandlers - Started server process [29770]
INFO     2023-06-20 20:44:05.681 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:44:05.681 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:44:05.682 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:44:05.682 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:44:10.941 request id: None - main:upload_file - <starlette.datastructures.UploadFile object at 0x1054ffc50>
INFO     2023-06-20 20:44:10.942 request id: app - logging:callHandlers - 127.0.0.1:52715 - "POST / HTTP/1.1" 200
INFO     2023-06-20 20:44:24.200 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:44:24.201 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:44:24.303 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:44:24.303 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:44:24.304 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:44:24.304 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:44:24.305 request id: app - logging:callHandlers - Finished server process [29770]
INFO     2023-06-20 20:44:24.305 request id: app - logging:callHandlers - Finished server process [29770]
INFO     2023-06-20 20:44:24.665 request id: app - logging:callHandlers - Started server process [29804]
INFO     2023-06-20 20:44:24.665 request id: app - logging:callHandlers - Started server process [29804]
INFO     2023-06-20 20:44:24.665 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:44:24.665 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:44:24.666 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:44:24.666 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:44:25.983 request id: None - main:upload_file - calculator.py
INFO     2023-06-20 20:44:25.983 request id: app - logging:callHandlers - 127.0.0.1:52805 - "POST / HTTP/1.1" 200
INFO     2023-06-20 20:44:31.864 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:44:31.864 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:44:31.966 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:44:31.966 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:44:31.967 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:44:31.967 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:44:31.967 request id: app - logging:callHandlers - Finished server process [29804]
INFO     2023-06-20 20:44:31.967 request id: app - logging:callHandlers - Finished server process [29804]
INFO     2023-06-20 20:44:32.300 request id: app - logging:callHandlers - Started server process [29822]
INFO     2023-06-20 20:44:32.300 request id: app - logging:callHandlers - Started server process [29822]
INFO     2023-06-20 20:44:32.301 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:44:32.301 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:44:32.301 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:44:32.301 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:44:33.731 request id: None - main:upload_file - calculator.py
INFO     2023-06-20 20:44:33.799 request id: app - logging:callHandlers - 127.0.0.1:52813 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 20:44:33.803 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100f70ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100e7da80>
           └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e7cfe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10340a490>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>
    │    └ <function subprocess_started at 0x101e44d60>
    └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10340b7d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101e2fd80>
           │       │   └ <uvicorn.server.Server object at 0x10340b7d0>
           │       └ <function run at 0x1019959e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x10340d7a0>
           │      └ <function Runner.run at 0x101a05940>
           └ <asyncio.runners.Runner object at 0x101dece90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101a03560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101dece90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101a034c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101a05300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1019962a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103419050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1034190d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103419050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10346b990>
          └ <fastapi.applications.FastAPI object at 0x1034190d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1033f7b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10346b8d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10346b990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103457ba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10346bc90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10346b8d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x103479350>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1034c6500>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1034c6500>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x103457ce0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10347bf50>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x10299ce00>
          └ <starlette.datastructures.UploadFile object at 0x10347bf50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x101eb34c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x103463610>
          │                 └ <starlette.datastructures.UploadFile object at 0x10347bf50>
          └ <function run_in_threadpool at 0x1028e0180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x103463610>>
                 │     │         └ <function run_sync at 0x1028e2f20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1028e2700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x103463610>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1034be7c0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x103463610>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:44:33.814 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100f70ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100e7da80>
           └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e7cfe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10340a490>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>
    │    └ <function subprocess_started at 0x101e44d60>
    └ <SpawnProcess name='SpawnProcess-3' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10340b7d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101e2fd80>
           │       │   └ <uvicorn.server.Server object at 0x10340b7d0>
           │       └ <function run at 0x1019959e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x10340d7a0>
           │      └ <function Runner.run at 0x101a05940>
           └ <asyncio.runners.Runner object at 0x101dece90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101a03560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x101dece90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101a034c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101a05300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1019962a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103419050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1034190d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103419050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10346b990>
          └ <fastapi.applications.FastAPI object at 0x1034190d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1033f7b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10346b8d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10346b990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103457ba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10347a490>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10346bc90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10346b8d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x103479350>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1034c6500>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1034c6500>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x103457ce0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10347bf50>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x10299ce00>
          └ <starlette.datastructures.UploadFile object at 0x10347bf50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x101eb34c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x103463610>
          │                 └ <starlette.datastructures.UploadFile object at 0x10347bf50>
          └ <function run_in_threadpool at 0x1028e0180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x103463610>>
                 │     │         └ <function run_sync at 0x1028e2f20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1028e2700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x103463610>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1034be7c0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x103463610>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:46:48.488 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:46:48.490 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:46:48.591 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:46:48.591 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:46:48.592 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:46:48.592 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:46:48.592 request id: app - logging:callHandlers - Finished server process [29822]
INFO     2023-06-20 20:46:48.593 request id: app - logging:callHandlers - Finished server process [29822]
INFO     2023-06-20 20:46:49.036 request id: app - logging:callHandlers - Started server process [30066]
INFO     2023-06-20 20:46:49.036 request id: app - logging:callHandlers - Started server process [30066]
INFO     2023-06-20 20:46:49.037 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:46:49.037 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:46:49.037 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:46:49.037 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:46:53.555 request id: None - main:upload_file - calculator.py
INFO     2023-06-20 20:46:53.627 request id: app - logging:callHandlers - 127.0.0.1:52863 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 20:46:53.637 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100cb8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100bc5a80>
           └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100bc4fe0>
    └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105e66690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>
    │    └ <function subprocess_started at 0x1024f0e00>
    └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105e67a10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1024dfe20>
           │       │   └ <uvicorn.server.Server object at 0x105e67a10>
           │       └ <function run at 0x102045a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x105e697a0>
           │      └ <function Runner.run at 0x1020b59e0>
           └ <asyncio.runners.Runner object at 0x1021d6690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1020b3600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1021d6690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1020b3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1020b53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102046340>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105e75410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105e65450>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105e75410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105ec7990>
          └ <fastapi.applications.FastAPI object at 0x105e65450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x105eb3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105ec7a50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105ec7990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105eb3ce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105ec7a90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105ec7a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x106000650>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x106000400>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x106000400>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x105eb3e20>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10600c350>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x103a94ea0>
          └ <starlette.datastructures.UploadFile object at 0x10600c350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x102543560>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x105ebff40>
          │                 └ <starlette.datastructures.UploadFile object at 0x10600c350>
          └ <function run_in_threadpool at 0x1039d8220>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x105ebff40>>
                 │     │         └ <function run_sync at 0x1039dafc0>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1039da7a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x105ebff40>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x10603b000>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x105ebff40>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:46:53.655 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100cb8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100bc5a80>
           └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100bc4fe0>
    └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105e66690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>
    │    └ <function subprocess_started at 0x1024f0e00>
    └ <SpawnProcess name='SpawnProcess-4' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105e67a10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1024dfe20>
           │       │   └ <uvicorn.server.Server object at 0x105e67a10>
           │       └ <function run at 0x102045a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x105e697a0>
           │      └ <function Runner.run at 0x1020b59e0>
           └ <asyncio.runners.Runner object at 0x1021d6690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1020b3600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1021d6690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1020b3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1020b53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102046340>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105e75410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105e65450>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105e75410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105ec7990>
          └ <fastapi.applications.FastAPI object at 0x105e65450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x105eb3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105ec7a50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105ec7990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105eb3ce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106001550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105ec7a90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105ec7a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x106000650>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x106000400>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x106000400>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x105eb3e20>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10600c350>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x103a94ea0>
          └ <starlette.datastructures.UploadFile object at 0x10600c350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x102543560>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x105ebff40>
          │                 └ <starlette.datastructures.UploadFile object at 0x10600c350>
          └ <function run_in_threadpool at 0x1039d8220>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x105ebff40>>
                 │     │         └ <function run_sync at 0x1039dafc0>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1039da7a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x105ebff40>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x10603b000>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x105ebff40>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:49:54.644 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:49:54.652 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:49:54.754 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:49:54.754 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:49:54.755 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:49:54.755 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:49:54.755 request id: app - logging:callHandlers - Finished server process [30066]
INFO     2023-06-20 20:49:54.756 request id: app - logging:callHandlers - Finished server process [30066]
INFO     2023-06-20 20:49:55.132 request id: app - logging:callHandlers - Started server process [30365]
INFO     2023-06-20 20:49:55.132 request id: app - logging:callHandlers - Started server process [30365]
INFO     2023-06-20 20:49:55.132 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:49:55.133 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:49:55.133 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:49:55.133 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:49:58.574 request id: app - logging:callHandlers - 127.0.0.1:53026 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:49:58.727 request id: app - logging:callHandlers - 127.0.0.1:53026 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:50:07.471 request id: None - main:upload_file - docker-compose.yaml
INFO     2023-06-20 20:50:07.527 request id: app - logging:callHandlers - 127.0.0.1:53027 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 20:50:07.534 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10531cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x105229a80>
           └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105228fe0>
    └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1081924d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>
    │    └ <function subprocess_started at 0x1061ece00>
    └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108193850>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061dbe20>
           │       │   └ <uvicorn.server.Server object at 0x108193850>
           │       └ <function run at 0x105d41a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1081957a0>
           │      └ <function Runner.run at 0x105db19e0>
           └ <asyncio.runners.Runner object at 0x10810d690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105daf600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10810d690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105daf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105db13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105d42340>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1081a1050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1052f0850>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1081a1050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081911d0>
          └ <fastapi.applications.FastAPI object at 0x1052f0850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1081dfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1065df910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081911d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108208040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1081f3390>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1065df910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x108203cd0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10823fe40>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10823fe40>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x108199580>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10820f750>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106d48ea0>
          └ <starlette.datastructures.UploadFile object at 0x10820f750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10625f560>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1081e9e70>
          │                 └ <starlette.datastructures.UploadFile object at 0x10820f750>
          └ <function run_in_threadpool at 0x106c8c220>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1081e9e70>>
                 │     │         └ <function run_sync at 0x106c8efc0>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x106c8e7a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1081e9e70>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x108233800>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1081e9e70>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:50:07.547 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10531cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x105229a80>
           └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105228fe0>
    └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1081924d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>
    │    └ <function subprocess_started at 0x1061ece00>
    └ <SpawnProcess name='SpawnProcess-5' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108193850>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061dbe20>
           │       │   └ <uvicorn.server.Server object at 0x108193850>
           │       └ <function run at 0x105d41a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1081957a0>
           │      └ <function Runner.run at 0x105db19e0>
           └ <asyncio.runners.Runner object at 0x10810d690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105daf600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10810d690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105daf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105db13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105d42340>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1081a1050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1052f0850>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1081a1050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081911d0>
          └ <fastapi.applications.FastAPI object at 0x1052f0850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1081dfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1065df910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1081911d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108208040>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108201dd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1081f3390>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1065df910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x108203cd0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10823fe40>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10823fe40>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x108199580>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10820f750>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106d48ea0>
          └ <starlette.datastructures.UploadFile object at 0x10820f750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10625f560>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1081e9e70>
          │                 └ <starlette.datastructures.UploadFile object at 0x10820f750>
          └ <function run_in_threadpool at 0x106c8c220>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1081e9e70>>
                 │     │         └ <function run_sync at 0x106c8efc0>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x106c8e7a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1081e9e70>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x108233800>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1081e9e70>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:51:43.923 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:51:43.924 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:51:44.026 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:51:44.026 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:51:44.027 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:51:44.028 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:51:44.028 request id: app - logging:callHandlers - Finished server process [30365]
INFO     2023-06-20 20:51:44.028 request id: app - logging:callHandlers - Finished server process [30365]
INFO     2023-06-20 20:51:44.457 request id: app - logging:callHandlers - Started server process [30582]
INFO     2023-06-20 20:51:44.457 request id: app - logging:callHandlers - Started server process [30582]
INFO     2023-06-20 20:51:44.457 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:51:44.457 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:51:44.457 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:51:44.458 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:51:51.206 request id: app - logging:callHandlers - 127.0.0.1:53150 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:51:51.322 request id: app - logging:callHandlers - 127.0.0.1:53150 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:51:59.586 request id: app - logging:callHandlers - 127.0.0.1:53151 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 20:51:59.600 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10264cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102559a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102558fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10568e7d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>
    │    └ <function subprocess_started at 0x1036bcd60>
    └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10568fb50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1036abd80>
           │       │   └ <uvicorn.server.Server object at 0x10568fb50>
           │       └ <function run at 0x1030719e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1056957a0>
           │      └ <function Runner.run at 0x1030e1940>
           └ <asyncio.runners.Runner object at 0x103202690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1030df560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x103202690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030df4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030e1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1030722a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10560e310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1056a3910>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10560e310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105700d10>
          └ <fastapi.applications.FastAPI object at 0x1056a3910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1056df740>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105700cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105700d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1056dfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105700810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105700cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105700fd0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105778280>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105778280>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1056994e0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10570bd50>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x104aa4e00>
          └ <starlette.datastructures.UploadFile object at 0x10570bd50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10370f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1056ede70>
          │                 └ <starlette.datastructures.UploadFile object at 0x10570bd50>
          └ <function run_in_threadpool at 0x1049e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1056ede70>>
                 │     │         └ <function run_sync at 0x1049eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1049ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1056ede70>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x105709400>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1056ede70>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 20:51:59.618 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10264cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102559a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102558fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10568e7d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>
    │    └ <function subprocess_started at 0x1036bcd60>
    └ <SpawnProcess name='SpawnProcess-6' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10568fb50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1036abd80>
           │       │   └ <uvicorn.server.Server object at 0x10568fb50>
           │       └ <function run at 0x1030719e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1056957a0>
           │      └ <function Runner.run at 0x1030e1940>
           └ <asyncio.runners.Runner object at 0x103202690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1030df560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x103202690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030df4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030e1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1030722a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10560e310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1056a3910>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10560e310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105700d10>
          └ <fastapi.applications.FastAPI object at 0x1056a3910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1056df740>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105700cd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105700d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1056dfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105700790>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105700810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105700cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105700fd0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105778280>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105778280>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1056994e0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10570bd50>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x104aa4e00>
          └ <starlette.datastructures.UploadFile object at 0x10570bd50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10370f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1056ede70>
          │                 └ <starlette.datastructures.UploadFile object at 0x10570bd50>
          └ <function run_in_threadpool at 0x1049e8180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1056ede70>>
                 │     │         └ <function run_sync at 0x1049eaf20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1049ea700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1056ede70>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x105709400>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1056ede70>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 20:54:46.692 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:54:46.692 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:54:46.793 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:54:46.793 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:54:46.794 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:54:46.794 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:54:46.795 request id: app - logging:callHandlers - Finished server process [30582]
INFO     2023-06-20 20:54:46.795 request id: app - logging:callHandlers - Finished server process [30582]
INFO     2023-06-20 20:54:47.244 request id: app - logging:callHandlers - Started server process [30929]
INFO     2023-06-20 20:54:47.245 request id: app - logging:callHandlers - Started server process [30929]
INFO     2023-06-20 20:54:47.245 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:54:47.245 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:54:47.245 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:54:47.245 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:56:25.040 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:56:25.047 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:56:25.150 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:56:25.150 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:56:25.152 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:56:25.152 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:56:25.153 request id: app - logging:callHandlers - Finished server process [30929]
INFO     2023-06-20 20:56:25.153 request id: app - logging:callHandlers - Finished server process [30929]
INFO     2023-06-20 20:56:56.872 request id: app - logging:callHandlers - Started server process [31166]
INFO     2023-06-20 20:56:56.872 request id: app - logging:callHandlers - Started server process [31166]
INFO     2023-06-20 20:56:56.873 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:56:56.873 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:56:56.873 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:56:56.873 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:57:02.777 request id: app - logging:callHandlers - 127.0.0.1:53333 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:57:02.931 request id: app - logging:callHandlers - 127.0.0.1:53333 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:57:11.415 request id: app - logging:callHandlers - 127.0.0.1:53334 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:57:11.417 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104840ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10474da80>
           └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10474cfe0>
    └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106e8d190>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>
    │    └ <function subprocess_started at 0x105710d60>
    └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106e8e510>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1056ffd80>
           │       │   └ <uvicorn.server.Server object at 0x106e8e510>
           │       └ <function run at 0x1052659e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x106e99030>
           │      └ <function Runner.run at 0x1052d5940>
           └ <asyncio.runners.Runner object at 0x106e83310>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1052d3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x106e83310>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1052d34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1052d5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1052662a0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106e8ff10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106e8fed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106e8ff10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e8e590>
          └ <fastapi.applications.FastAPI object at 0x106e8fed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106edf4c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106ef7510>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e8e590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ef7110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106ef7510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106eda710>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ef7110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1063ac680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106edef20>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106f02a90>
                     └ <function get_request_handler.<locals>.app at 0x106edefc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106392b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x106f069d0>}
                 │         └ <function upload_file at 0x106edee80>
                 └ <fastapi.dependencies.models.Dependant object at 0x106ef4a10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 75, in upload_file
    document = await storage.save(

NameError: name 'storage' is not defined
ERROR    2023-06-20 20:57:11.431 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104840ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10474da80>
           └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10474cfe0>
    └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106e8d190>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>
    │    └ <function subprocess_started at 0x105710d60>
    └ <SpawnProcess name='SpawnProcess-10' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106e8e510>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1056ffd80>
           │       │   └ <uvicorn.server.Server object at 0x106e8e510>
           │       └ <function run at 0x1052659e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x106e99030>
           │      └ <function Runner.run at 0x1052d5940>
           └ <asyncio.runners.Runner object at 0x106e83310>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1052d3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x106e83310>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1052d34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1052d5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1052662a0>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=True>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=True>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106e8ff10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106e8fed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106e8ff10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e8e590>
          └ <fastapi.applications.FastAPI object at 0x106e8fed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106edf4c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106ef7510>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e8e590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ef7110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106ef7510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106eda710>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ef7110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1063ac680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106edf880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f02b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106edef20>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106f02a90>
                     └ <function get_request_handler.<locals>.app at 0x106edefc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106392b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'file': <starlette.datastructures.UploadFile object at 0x106f069d0>}
                 │         └ <function upload_file at 0x106edee80>
                 └ <fastapi.dependencies.models.Dependant object at 0x106ef4a10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 75, in upload_file
    document = await storage.save(

NameError: name 'storage' is not defined
INFO     2023-06-20 20:58:03.077 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:58:03.078 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:58:03.179 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:58:03.179 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:58:03.181 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:58:03.181 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:58:03.181 request id: app - logging:callHandlers - Finished server process [31166]
INFO     2023-06-20 20:58:03.182 request id: app - logging:callHandlers - Finished server process [31166]
INFO     2023-06-20 20:58:03.559 request id: app - logging:callHandlers - Started server process [31286]
INFO     2023-06-20 20:58:03.559 request id: app - logging:callHandlers - Started server process [31286]
INFO     2023-06-20 20:58:03.559 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:58:03.559 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:58:03.560 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:58:03.560 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:58:06.036 request id: app - logging:callHandlers - 127.0.0.1:53361 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:58:06.037 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10315cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x103069a80>
           └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x103068fe0>
    └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1060d7690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>
    │    └ <function subprocess_started at 0x103f3cd60>
    └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1060eca10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x103f27d80>
           │       │   └ <uvicorn.server.Server object at 0x1060eca10>
           │       └ <function run at 0x103cc19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1060e1360>
           │      └ <function Runner.run at 0x103d35940>
           └ <asyncio.runners.Runner object at 0x103ee5190>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103d2f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x103ee5190>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103d2f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103d35300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103cc22a0>
    └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1060ee150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106130a10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1060ee150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106149c90>
          └ <fastapi.applications.FastAPI object at 0x106130a10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106127880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106149d10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106149c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106130810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106149d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106130b50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106130810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1056b8680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106127600>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106150690>
                     └ <function get_request_handler.<locals>.app at 0x1061276a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10569eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1060edfd0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x106127560>
                 └ <fastapi.dependencies.models.Dependant object at 0x106132f10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 77, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1060af380>
                     └ <services.minio_storage.MinioStorage object at 0x1060edfd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 17, in save
    found = await self.client.bucket_exists(bucket)
                  │    │                    └ 'files'
                  │    └ None
                  └ <services.minio_storage.MinioStorage object at 0x1060edfd0>

AttributeError: 'NoneType' object has no attribute 'bucket_exists'
ERROR    2023-06-20 20:58:06.050 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10315cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x103069a80>
           └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x103068fe0>
    └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1060d7690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>
    │    └ <function subprocess_started at 0x103f3cd60>
    └ <SpawnProcess name='SpawnProcess-11' parent=29764 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1060eca10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x103f27d80>
           │       │   └ <uvicorn.server.Server object at 0x1060eca10>
           │       └ <function run at 0x103cc19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1060e1360>
           │      └ <function Runner.run at 0x103d35940>
           └ <asyncio.runners.Runner object at 0x103ee5190>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103d2f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x103ee5190>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103d2f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103d35300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103cc22a0>
    └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 0x1060edfd0>>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1060ee150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106130a10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1060ee150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106149c90>
          └ <fastapi.applications.FastAPI object at 0x106130a10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106127880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106149d10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106149c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106130810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106149d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106130b50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106130810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1056b8680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106127c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10614bc90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106127600>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106150690>
                     └ <function get_request_handler.<locals>.app at 0x1061276a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10569eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1060edfd0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x106127560>
                 └ <fastapi.dependencies.models.Dependant object at 0x106132f10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 77, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1060af380>
                     └ <services.minio_storage.MinioStorage object at 0x1060edfd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 17, in save
    found = await self.client.bucket_exists(bucket)
                  │    │                    └ 'files'
                  │    └ None
                  └ <services.minio_storage.MinioStorage object at 0x1060edfd0>

AttributeError: 'NoneType' object has no attribute 'bucket_exists'
INFO     2023-06-20 20:58:16.256 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:58:16.256 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:58:16.357 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:58:16.358 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:58:16.358 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:58:16.359 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:58:16.359 request id: app - logging:callHandlers - Finished server process [31286]
INFO     2023-06-20 20:58:16.359 request id: app - logging:callHandlers - Finished server process [31286]
INFO     2023-06-20 20:58:17.645 request id: app - logging:callHandlers - Started server process [31324]
INFO     2023-06-20 20:58:17.645 request id: app - logging:callHandlers - Started server process [31324]
INFO     2023-06-20 20:58:17.645 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:58:17.645 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:58:17.646 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:58:17.646 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:58:19.930 request id: app - logging:callHandlers - 127.0.0.1:53369 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 20:58:20.098 request id: app - logging:callHandlers - 127.0.0.1:53369 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 20:58:27.406 request id: app - logging:callHandlers - 127.0.0.1:53370 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 20:58:27.407 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1052ccae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1051d9a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1051d8fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108b8fa50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>
    │    └ <function subprocess_started at 0x1061a0d60>
    └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108ba4e10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10618bd80>
           │       │   └ <uvicorn.server.Server object at 0x108ba4e10>
           │       └ <function run at 0x105cf19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108b99360>
           │      └ <function Runner.run at 0x105d65940>
           └ <asyncio.runners.Runner object at 0x1063ea710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105d5f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1063ea710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105d5f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105d65300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105cf22a0>
    └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108ba6450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108be8e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108ba6450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108c020d0>
          └ <fastapi.applications.FastAPI object at 0x108be8e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108bdfba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108c02110>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108c020d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108c021d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108c02110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108be9050>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108c021d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107a30680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x108bdf600>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108c05510>
                     └ <function get_request_handler.<locals>.app at 0x108bdf6a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107a16b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x108b0e510>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x108bdf560>
                 └ <fastapi.dependencies.models.Dependant object at 0x108bea1d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 77, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x108b67380>
                     └ <services.minio_storage.MinioStorage object at 0x108b0e510>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 17, in save
    found = await self.client.bucket_exists(bucket)
                  │    │                    └ 'files'
                  │    └ None
                  └ <services.minio_storage.MinioStorage object at 0x108b0e510>

AttributeError: 'NoneType' object has no attribute 'bucket_exists'
ERROR    2023-06-20 20:58:27.420 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1052ccae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1051d9a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1051d8fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108b8fa50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>
    │    └ <function subprocess_started at 0x1061a0d60>
    └ <SpawnProcess name='SpawnProcess-1' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108ba4e10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10618bd80>
           │       │   └ <uvicorn.server.Server object at 0x108ba4e10>
           │       └ <function run at 0x105cf19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108b99360>
           │      └ <function Runner.run at 0x105d65940>
           └ <asyncio.runners.Runner object at 0x1063ea710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105d5f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1063ea710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105d5f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105d65300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105cf22a0>
    └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 0x108b0e510>>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108ba6450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108be8e90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108ba6450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108c020d0>
          └ <fastapi.applications.FastAPI object at 0x108be8e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108bdfba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108c02110>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108c020d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108c021d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108c02110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108be9050>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108c021d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107a30680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108bdfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108c055d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x108bdf600>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108c05510>
                     └ <function get_request_handler.<locals>.app at 0x108bdf6a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107a16b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x108b0e510>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x108bdf560>
                 └ <fastapi.dependencies.models.Dependant object at 0x108bea1d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 77, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x108b67380>
                     └ <services.minio_storage.MinioStorage object at 0x108b0e510>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 17, in save
    found = await self.client.bucket_exists(bucket)
                  │    │                    └ 'files'
                  │    └ None
                  └ <services.minio_storage.MinioStorage object at 0x108b0e510>

AttributeError: 'NoneType' object has no attribute 'bucket_exists'
INFO     2023-06-20 20:58:52.993 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:58:52.994 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 20:58:53.096 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:58:53.096 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 20:58:53.097 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:58:53.097 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 20:58:53.097 request id: app - logging:callHandlers - Finished server process [31324]
INFO     2023-06-20 20:58:53.098 request id: app - logging:callHandlers - Finished server process [31324]
INFO     2023-06-20 20:58:53.476 request id: app - logging:callHandlers - Started server process [31390]
INFO     2023-06-20 20:58:53.476 request id: app - logging:callHandlers - Started server process [31390]
INFO     2023-06-20 20:58:53.476 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:58:53.477 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 20:58:53.477 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 20:58:53.477 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:00:18.855 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:00:18.858 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:00:18.960 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:00:18.960 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:00:18.961 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:00:18.961 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:00:18.962 request id: app - logging:callHandlers - Finished server process [31390]
INFO     2023-06-20 21:00:18.962 request id: app - logging:callHandlers - Finished server process [31390]
INFO     2023-06-20 21:00:19.418 request id: app - logging:callHandlers - Started server process [31530]
INFO     2023-06-20 21:00:19.418 request id: app - logging:callHandlers - Started server process [31530]
INFO     2023-06-20 21:00:19.418 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:00:19.418 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:00:19.419 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:00:19.419 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:00:20.228 request id: app - logging:callHandlers - 127.0.0.1:53410 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:00:20.419 request id: app - logging:callHandlers - 127.0.0.1:53410 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:00:25.749 request id: app - logging:callHandlers - 127.0.0.1:53411 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:00:25.750 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10060cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100519a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100518fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10348f310>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    └ <function subprocess_started at 0x1014dcd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1034a46d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1014cbd80>
           │       │   └ <uvicorn.server.Server object at 0x1034a46d0>
           │       └ <function run at 0x1010319e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103499360>
           │      └ <function Runner.run at 0x1010a1940>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10109f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10109f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1010a1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010322a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1034ec590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
          └ <fastapi.applications.FastAPI object at 0x1034ec590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1034dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1034dfe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x103501f10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x103504c10>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f540>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f540>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1034dfec0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x103514450>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102038e00>
          └ <starlette.datastructures.UploadFile object at 0x103514450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10154f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>
          │                 └ <starlette.datastructures.UploadFile object at 0x103514450>
          └ <function run_in_threadpool at 0x101f7c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>>
                 │     │         └ <function run_sync at 0x101f7ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x101f7e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x103503900>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:00:25.763 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10060cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100519a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100518fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10348f310>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    └ <function subprocess_started at 0x1014dcd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1034a46d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1014cbd80>
           │       │   └ <uvicorn.server.Server object at 0x1034a46d0>
           │       └ <function run at 0x1010319e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103499360>
           │      └ <function Runner.run at 0x1010a1940>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10109f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10109f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1010a1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010322a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1034ec590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
          └ <fastapi.applications.FastAPI object at 0x1034ec590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1034dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1034dfe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103504b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x103501f10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x103504c10>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f540>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f540>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1034dfec0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x103514450>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102038e00>
          └ <starlette.datastructures.UploadFile object at 0x103514450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10154f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>
          │                 └ <starlette.datastructures.UploadFile object at 0x103514450>
          └ <function run_in_threadpool at 0x101f7c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>>
                 │     │         └ <function run_sync at 0x101f7ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x101f7e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x103503900>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1034f7fa0>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:00:36.154 request id: app - logging:callHandlers - 127.0.0.1:53425 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:00:36.159 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10060cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100519a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100518fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10348f310>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    └ <function subprocess_started at 0x1014dcd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1034a46d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1014cbd80>
           │       │   └ <uvicorn.server.Server object at 0x1034a46d0>
           │       └ <function run at 0x1010319e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103499360>
           │      └ <function Runner.run at 0x1010a1940>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10109f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10109f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1010a1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010322a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1034ec590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
          └ <fastapi.applications.FastAPI object at 0x1034ec590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1034df9c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1035604a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x103501f10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x10353f310>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f0c0>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f0c0>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1035627a0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x1036701d0>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102038e00>
          └ <starlette.datastructures.UploadFile object at 0x1036701d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10154f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1035533a0>
          │                 └ <starlette.datastructures.UploadFile object at 0x1036701d0>
          └ <function run_in_threadpool at 0x101f7c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1035533a0>>
                 │     │         └ <function run_sync at 0x101f7ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x101f7e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1035533a0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x103503d00>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1035533a0>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:00:36.171 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10060cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100519a80>
           └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100518fe0>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10348f310>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>
    │    └ <function subprocess_started at 0x1014dcd60>
    └ <SpawnProcess name='SpawnProcess-3' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1034a46d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1014cbd80>
           │       │   └ <uvicorn.server.Server object at 0x1034a46d0>
           │       └ <function run at 0x1010319e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103499360>
           │      └ <function Runner.run at 0x1010a1940>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10109f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10348c9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10109f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1010a1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010322a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1034ec590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1034a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
          └ <fastapi.applications.FastAPI object at 0x1034ec590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1034df9c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103502410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1035604a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034ef090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x103501f10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103500890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x10353f310>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f0c0>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x10358f0c0>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1035627a0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x1036701d0>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102038e00>
          └ <starlette.datastructures.UploadFile object at 0x1036701d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10154f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1035533a0>
          │                 └ <starlette.datastructures.UploadFile object at 0x1036701d0>
          └ <function run_in_threadpool at 0x101f7c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1035533a0>>
                 │     │         └ <function run_sync at 0x101f7ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x101f7e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1035533a0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x103503d00>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1035533a0>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:00:55.622 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:00:55.622 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:00:55.723 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:00:55.724 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:00:55.725 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:00:55.725 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:00:55.725 request id: app - logging:callHandlers - Finished server process [31530]
INFO     2023-06-20 21:00:55.725 request id: app - logging:callHandlers - Finished server process [31530]
INFO     2023-06-20 21:00:56.081 request id: app - logging:callHandlers - Started server process [31603]
INFO     2023-06-20 21:00:56.081 request id: app - logging:callHandlers - Started server process [31603]
INFO     2023-06-20 21:00:56.081 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:00:56.081 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:00:56.082 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:00:56.082 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:01:11.264 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:01:11.265 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:01:11.366 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:01:11.366 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:01:11.367 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:01:11.367 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:01:11.368 request id: app - logging:callHandlers - Finished server process [31603]
INFO     2023-06-20 21:01:11.368 request id: app - logging:callHandlers - Finished server process [31603]
INFO     2023-06-20 21:01:11.727 request id: app - logging:callHandlers - Started server process [31638]
INFO     2023-06-20 21:01:11.727 request id: app - logging:callHandlers - Started server process [31638]
INFO     2023-06-20 21:01:11.727 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:01:11.727 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:01:11.728 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:01:11.728 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:17:54.995 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:17:54.997 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:17:55.097 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:17:55.097 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:17:55.098 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:17:55.098 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:17:55.099 request id: app - logging:callHandlers - Finished server process [31638]
INFO     2023-06-20 21:17:55.099 request id: app - logging:callHandlers - Finished server process [31638]
INFO     2023-06-20 21:17:55.725 request id: app - logging:callHandlers - Started server process [33272]
INFO     2023-06-20 21:17:55.725 request id: app - logging:callHandlers - Started server process [33272]
INFO     2023-06-20 21:17:55.725 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:17:55.725 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:17:55.726 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:17:55.726 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:18:02.224 request id: app - logging:callHandlers - 127.0.0.1:53947 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:18:02.444 request id: app - logging:callHandlers - 127.0.0.1:53947 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:18:12.987 request id: app - logging:callHandlers - 127.0.0.1:53948 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:18:12.988 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1046ccae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1045d9a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1045d8fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1086834d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>
    │    └ <function subprocess_started at 0x1066b4d60>
    └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108694850>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1066a3d80>
           │       │   └ <uvicorn.server.Server object at 0x108694850>
           │       └ <function run at 0x10643d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108689360>
           │      └ <function Runner.run at 0x1064ad940>
           └ <asyncio.runners.Runner object at 0x1085fd9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1064ab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1085fd9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1064ab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1064ad300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10643e2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108696110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108696090>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108696110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1086f2290>
          └ <fastapi.applications.FastAPI object at 0x108696090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1086cfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1086f2010>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1086f2290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1086cfe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1086f0610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1086f2010>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x1086f5810>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1086f7c00>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1086f7c00>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1086cfec0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x108700750>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x107c14e00>
          └ <starlette.datastructures.UploadFile object at 0x108700750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x1067074c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1086e64a0>
          │                 └ <starlette.datastructures.UploadFile object at 0x108700750>
          └ <function run_in_threadpool at 0x107b58180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1086e64a0>>
                 │     │         └ <function run_sync at 0x107b5af20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x107b5a700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1086e64a0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1086f3a40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1086e64a0>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:18:13.005 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1046ccae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1045d9a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1045d8fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1086834d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>
    │    └ <function subprocess_started at 0x1066b4d60>
    └ <SpawnProcess name='SpawnProcess-6' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108694850>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1066a3d80>
           │       │   └ <uvicorn.server.Server object at 0x108694850>
           │       └ <function run at 0x10643d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108689360>
           │      └ <function Runner.run at 0x1064ad940>
           └ <asyncio.runners.Runner object at 0x1085fd9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1064ab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1085fd9d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1064ab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1064ad300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10643e2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108696110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108696090>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108696110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1086f2290>
          └ <fastapi.applications.FastAPI object at 0x108696090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1086cfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1086f2010>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1086f2290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1086cfe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086f4f50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1086f0610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1086f2010>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x1086f5810>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1086f7c00>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1086f7c00>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1086cfec0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x108700750>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x107c14e00>
          └ <starlette.datastructures.UploadFile object at 0x108700750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x1067074c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1086e64a0>
          │                 └ <starlette.datastructures.UploadFile object at 0x108700750>
          └ <function run_in_threadpool at 0x107b58180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1086e64a0>>
                 │     │         └ <function run_sync at 0x107b5af20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x107b5a700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1086e64a0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x1086f3a40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1086e64a0>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:18:51.914 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:18:51.915 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:18:52.016 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:18:52.017 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:18:52.021 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:18:52.021 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:18:52.022 request id: app - logging:callHandlers - Finished server process [33272]
INFO     2023-06-20 21:18:52.022 request id: app - logging:callHandlers - Finished server process [33272]
INFO     2023-06-20 21:18:52.423 request id: app - logging:callHandlers - Started server process [33410]
INFO     2023-06-20 21:18:52.424 request id: app - logging:callHandlers - Started server process [33410]
INFO     2023-06-20 21:18:52.424 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:18:52.424 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:18:52.425 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:18:52.425 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:18:59.609 request id: app - logging:callHandlers - 127.0.0.1:54021 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:18:59.610 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10072cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100639a80>
           └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100638fe0>
    └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102cbb850>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>
    │    └ <function subprocess_started at 0x1015fcd60>
    └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102728b90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1015ebd80>
           │       │   └ <uvicorn.server.Server object at 0x102728b90>
           │       └ <function run at 0x1011519e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x102cc5360>
           │      └ <function Runner.run at 0x1011c5940>
           └ <asyncio.runners.Runner object at 0x102cb8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1011bf560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x102cb8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1011bf4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1011c5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1011522a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102cd2410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x102d14ed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102cd2410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x102d2c150>
          └ <fastapi.applications.FastAPI object at 0x102d14ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x102cc1440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x102d2dc10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x102d2c150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x102d0bb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x102d2dd10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x102d2dc10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x102d302d0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x102d2c740>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x102d2c740>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x102d0bc40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x102d31690>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102158e00>
          └ <starlette.datastructures.UploadFile object at 0x102d31690>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10166f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x102d21450>
          │                 └ <starlette.datastructures.UploadFile object at 0x102d31690>
          └ <function run_in_threadpool at 0x10209c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x102d21450>>
                 │     │         └ <function run_sync at 0x10209ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10209e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x102d21450>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x102d17d40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x102d21450>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:18:59.633 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10072cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100639a80>
           └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100638fe0>
    └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102cbb850>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>
    │    └ <function subprocess_started at 0x1015fcd60>
    └ <SpawnProcess name='SpawnProcess-7' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102728b90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1015ebd80>
           │       │   └ <uvicorn.server.Server object at 0x102728b90>
           │       └ <function run at 0x1011519e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x102cc5360>
           │      └ <function Runner.run at 0x1011c5940>
           └ <asyncio.runners.Runner object at 0x102cb8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1011bf560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x102cb8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1011bf4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1011c5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1011522a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102cd2410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x102d14ed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102cd2410>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x102d2c150>
          └ <fastapi.applications.FastAPI object at 0x102d14ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x102cc1440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x102d2dc10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x102d2c150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x102d0bb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x102d2f290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x102d2dd10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x102d2dc10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x102d302d0>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x102d2c740>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x102d2c740>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x102d0bc40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x102d31690>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102158e00>
          └ <starlette.datastructures.UploadFile object at 0x102d31690>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10166f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x102d21450>
          │                 └ <starlette.datastructures.UploadFile object at 0x102d31690>
          └ <function run_in_threadpool at 0x10209c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x102d21450>>
                 │     │         └ <function run_sync at 0x10209ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10209e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x102d21450>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x102d17d40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x102d21450>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:20:59.383 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:20:59.384 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:20:59.486 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:20:59.486 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:20:59.488 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:20:59.488 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:20:59.489 request id: app - logging:callHandlers - Finished server process [33410]
INFO     2023-06-20 21:20:59.489 request id: app - logging:callHandlers - Finished server process [33410]
INFO     2023-06-20 21:20:59.905 request id: app - logging:callHandlers - Started server process [33664]
INFO     2023-06-20 21:20:59.905 request id: app - logging:callHandlers - Started server process [33664]
INFO     2023-06-20 21:20:59.905 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:20:59.905 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:20:59.906 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:20:59.906 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:21:15.287 request id: app - logging:callHandlers - 127.0.0.1:54159 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:21:15.444 request id: app - logging:callHandlers - 127.0.0.1:54159 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:21:31.922 request id: app - logging:callHandlers - 127.0.0.1:54160 - "POST / HTTP/1.1" 200
INFO     2023-06-20 21:21:45.975 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:21:45.976 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:21:46.077 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:21:46.077 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:21:46.078 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:21:46.078 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:21:46.079 request id: app - logging:callHandlers - Finished server process [33664]
INFO     2023-06-20 21:21:46.079 request id: app - logging:callHandlers - Finished server process [33664]
INFO     2023-06-20 21:21:46.423 request id: app - logging:callHandlers - Started server process [33745]
INFO     2023-06-20 21:21:46.424 request id: app - logging:callHandlers - Started server process [33745]
INFO     2023-06-20 21:21:46.424 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:21:46.424 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:21:46.424 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:21:46.424 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:21:47.925 request id: app - logging:callHandlers - 127.0.0.1:54174 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:21:47.929 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100960ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10086da80>
           └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10086cfe0>
    └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1053c7410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>
    │    └ <function subprocess_started at 0x101830d60>
    └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1053dc7d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10181fd80>
           │       │   └ <uvicorn.server.Server object at 0x1053dc7d0>
           │       └ <function run at 0x1013859e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1053d1360>
           │      └ <function Runner.run at 0x1013f9940>
           └ <asyncio.runners.Runner object at 0x1017dcd10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1013f3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1017dcd10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1013f34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1013f9300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1013862a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053dde50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1053c7ed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053dde50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105605d10>
          └ <fastapi.applications.FastAPI object at 0x1053c7ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1054176a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105605d90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105605d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105417b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105605dd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105605d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105607910>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1056046c0>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1056046c0>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x105417c40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x105600c90>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102470e00>
          └ <starlette.datastructures.UploadFile object at 0x105600c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x101a0f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x10542d540>
          │                 └ <starlette.datastructures.UploadFile object at 0x105600c90>
          └ <function run_in_threadpool at 0x1023b4180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10542d540>>
                 │     │         └ <function run_sync at 0x1023b6f20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1023b6700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10542d540>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x105427cc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x10542d540>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:21:47.961 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100960ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10086da80>
           └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10086cfe0>
    └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1053c7410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>
    │    └ <function subprocess_started at 0x101830d60>
    └ <SpawnProcess name='SpawnProcess-9' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1053dc7d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10181fd80>
           │       │   └ <uvicorn.server.Server object at 0x1053dc7d0>
           │       └ <function run at 0x1013859e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1053d1360>
           │      └ <function Runner.run at 0x1013f9940>
           └ <asyncio.runners.Runner object at 0x1017dcd10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1013f3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1017dcd10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1013f34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1013f9300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1013862a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053dde50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1053c7ed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053dde50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105605d10>
          └ <fastapi.applications.FastAPI object at 0x1053c7ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1054176a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105605d90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105605d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105417b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1056049d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105605dd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105605d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105607910>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1056046c0>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x1056046c0>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x105417c40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x105600c90>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x102470e00>
          └ <starlette.datastructures.UploadFile object at 0x105600c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x101a0f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x10542d540>
          │                 └ <starlette.datastructures.UploadFile object at 0x105600c90>
          └ <function run_in_threadpool at 0x1023b4180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10542d540>>
                 │     │         └ <function run_sync at 0x1023b6f20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x1023b6700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x10542d540>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x105427cc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x10542d540>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:23:25.370 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:23:25.371 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:23:25.473 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:23:25.473 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:23:25.474 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:23:25.474 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:23:25.474 request id: app - logging:callHandlers - Finished server process [33745]
INFO     2023-06-20 21:23:25.474 request id: app - logging:callHandlers - Finished server process [33745]
INFO     2023-06-20 21:23:25.865 request id: app - logging:callHandlers - Started server process [33919]
INFO     2023-06-20 21:23:25.866 request id: app - logging:callHandlers - Started server process [33919]
INFO     2023-06-20 21:23:25.866 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:23:25.866 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:23:25.866 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:23:25.866 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:23:29.960 request id: app - logging:callHandlers - 127.0.0.1:54242 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:23:29.961 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100dc0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100ccda80>
           └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100cccfe0>
    └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104e63650>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>
    │    └ <function subprocess_started at 0x101dbcd60>
    └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104e789d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101dabd80>
           │       │   └ <uvicorn.server.Server object at 0x104e789d0>
           │       └ <function run at 0x1017e59e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x104e6d360>
           │      └ <function Runner.run at 0x101859940>
           └ <asyncio.runners.Runner object at 0x100bee710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101853560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x100bee710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1018534c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101859300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1017e62a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x104e7a150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104ebcc90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x104e7a150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105002290>
          └ <fastapi.applications.FastAPI object at 0x104ebcc90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104e69440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105002350>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105002290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104eb3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105002390>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105002350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105003d50>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105003c00>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105003c00>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x104eb3c40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10500d090>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x1043f8e00>
          └ <starlette.datastructures.UploadFile object at 0x10500d090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10390f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x104ec9420>
          │                 └ <starlette.datastructures.UploadFile object at 0x10500d090>
          └ <function run_in_threadpool at 0x10433c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x104ec9420>>
                 │     │         └ <function run_sync at 0x10433ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10433e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x104ec9420>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x105001f00>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x104ec9420>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:23:29.977 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100dc0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100ccda80>
           └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100cccfe0>
    └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104e63650>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>
    │    └ <function subprocess_started at 0x101dbcd60>
    └ <SpawnProcess name='SpawnProcess-10' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104e789d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101dabd80>
           │       │   └ <uvicorn.server.Server object at 0x104e789d0>
           │       └ <function run at 0x1017e59e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x104e6d360>
           │      └ <function Runner.run at 0x101859940>
           └ <asyncio.runners.Runner object at 0x100bee710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101853560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x100bee710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1018534c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101859300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1017e62a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x104e7a150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104ebcc90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x104e7a150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105002290>
          └ <fastapi.applications.FastAPI object at 0x104ebcc90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104e69440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105002350>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105002290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104eb3b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105000b90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105002390>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105002350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105003d50>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105003c00>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105003c00>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x104eb3c40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10500d090>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x1043f8e00>
          └ <starlette.datastructures.UploadFile object at 0x10500d090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x10390f4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x104ec9420>
          │                 └ <starlette.datastructures.UploadFile object at 0x10500d090>
          └ <function run_in_threadpool at 0x10433c180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x104ec9420>>
                 │     │         └ <function run_sync at 0x10433ef20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10433e700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x104ec9420>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x105001f00>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x104ec9420>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:25:40.953 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:25:40.953 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:25:41.055 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:25:41.055 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:25:41.056 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:25:41.056 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:25:41.057 request id: app - logging:callHandlers - Finished server process [33919]
INFO     2023-06-20 21:25:41.057 request id: app - logging:callHandlers - Finished server process [33919]
INFO     2023-06-20 21:25:41.388 request id: app - logging:callHandlers - Started server process [34154]
INFO     2023-06-20 21:25:41.388 request id: app - logging:callHandlers - Started server process [34154]
INFO     2023-06-20 21:25:41.389 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:25:41.389 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:25:41.389 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:25:41.389 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:25:45.540 request id: app - logging:callHandlers - 127.0.0.1:54327 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:25:45.678 request id: app - logging:callHandlers - 127.0.0.1:54327 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:25:53.481 request id: app - logging:callHandlers - 127.0.0.1:54328 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:25:53.482 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1045b0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1044bda80>
           └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1044bcfe0>
    └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11118f750>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>
    │    └ <function subprocess_started at 0x1066ecd60>
    └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1111a4b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1066d7d80>
           │       │   └ <uvicorn.server.Server object at 0x1111a4b10>
           │       └ <function run at 0x10613d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x111199360>
           │      └ <function Runner.run at 0x1061b1940>
           └ <asyncio.runners.Runner object at 0x11118cb50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1061ab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x11118cb50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1061ab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1061b1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10613e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1111a6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1111e8bd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1111a6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111201c90>
          └ <fastapi.applications.FastAPI object at 0x1111e8bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1111dfba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111201d10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111201c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x111201650>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111201d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1111e8d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x111201650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x110830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1111df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x111201dd0>
                     └ <function get_request_handler.<locals>.app at 0x1111df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x110816b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x111205f50>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1111df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1111ea050>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x111167380>
                     └ <services.minio_storage.MinioStorage object at 0x111205f50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1110e2660>
                   │    └ <miniopy_async.api.Minio object at 0x111201b90>
                   └ <services.minio_storage.MinioStorage object at 0x111205f50>

TypeError: Minio.put_object() missing 1 required positional argument: 'length'
ERROR    2023-06-20 21:25:53.495 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1045b0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1044bda80>
           └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1044bcfe0>
    └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11118f750>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>
    │    └ <function subprocess_started at 0x1066ecd60>
    └ <SpawnProcess name='SpawnProcess-11' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1111a4b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1066d7d80>
           │       │   └ <uvicorn.server.Server object at 0x1111a4b10>
           │       └ <function run at 0x10613d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x111199360>
           │      └ <function Runner.run at 0x1061b1940>
           └ <asyncio.runners.Runner object at 0x11118cb50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1061ab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x11118cb50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1061ab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1061b1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10613e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1111a6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1111e8bd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1111a6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111201c90>
          └ <fastapi.applications.FastAPI object at 0x1111e8bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1111dfba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111201d10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x111201c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x111201650>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111201d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1111e8d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x111201650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x110830680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111dfa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1112053d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1111df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x111201dd0>
                     └ <function get_request_handler.<locals>.app at 0x1111df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x110816b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x111205f50>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1111df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1111ea050>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x111167380>
                     └ <services.minio_storage.MinioStorage object at 0x111205f50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1110e2660>
                   │    └ <miniopy_async.api.Minio object at 0x111201b90>
                   └ <services.minio_storage.MinioStorage object at 0x111205f50>

TypeError: Minio.put_object() missing 1 required positional argument: 'length'
INFO     2023-06-20 21:27:22.296 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:27:22.299 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:27:22.400 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:27:22.401 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:27:22.401 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:27:22.402 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:27:22.402 request id: app - logging:callHandlers - Finished server process [34154]
INFO     2023-06-20 21:27:22.402 request id: app - logging:callHandlers - Finished server process [34154]
INFO     2023-06-20 21:27:22.813 request id: app - logging:callHandlers - Started server process [34360]
INFO     2023-06-20 21:27:22.814 request id: app - logging:callHandlers - Started server process [34360]
INFO     2023-06-20 21:27:22.814 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:27:22.814 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:27:22.814 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:27:22.815 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:27:27.515 request id: app - logging:callHandlers - 127.0.0.1:54414 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:27:27.517 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1043e8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1042f5a80>
           └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1042f4fe0>
    └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10758f410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>
    │    └ <function subprocess_started at 0x1052b8d60>
    └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1075a47d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1052a7d80>
           │       │   └ <uvicorn.server.Server object at 0x1075a47d0>
           │       └ <function run at 0x104e0d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x107599360>
           │      └ <function Runner.run at 0x104e81940>
           └ <asyncio.runners.Runner object at 0x1066b6d50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104e7b560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1066b6d50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104e7b4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104e81300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104e0e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10758ff50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105f354d0>
          └ <fastapi.applications.FastAPI object at 0x10758ff50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1075df920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107700e10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105f354d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107700750>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107700e10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1075e8a10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107700750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106058680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1075df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107703310>
                     └ <function get_request_handler.<locals>.app at 0x1075df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10603eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x107700610>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1075df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1075e9cd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x107567380>
                     └ <services.minio_storage.MinioStorage object at 0x107700610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1074e2660>
                   │    └ <miniopy_async.api.Minio object at 0x1074ebb50>
                   └ <services.minio_storage.MinioStorage object at 0x107700610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ 35

AttributeError: 'int' object has no attribute 'read'
ERROR    2023-06-20 21:27:27.536 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1043e8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1042f5a80>
           └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1042f4fe0>
    └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10758f410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>
    │    └ <function subprocess_started at 0x1052b8d60>
    └ <SpawnProcess name='SpawnProcess-12' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1075a47d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1052a7d80>
           │       │   └ <uvicorn.server.Server object at 0x1075a47d0>
           │       └ <function run at 0x104e0d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x107599360>
           │      └ <function Runner.run at 0x104e81940>
           └ <asyncio.runners.Runner object at 0x1066b6d50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x104e7b560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1066b6d50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104e7b4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104e81300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104e0e2a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10758ff50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075a5ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105f354d0>
          └ <fastapi.applications.FastAPI object at 0x10758ff50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1075df920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107700e10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105f354d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107700750>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107700e10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1075e8a10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107700750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106058680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1077007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1075df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107703310>
                     └ <function get_request_handler.<locals>.app at 0x1075df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10603eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x107700610>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1075df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1075e9cd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x107567380>
                     └ <services.minio_storage.MinioStorage object at 0x107700610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1074e2660>
                   │    └ <miniopy_async.api.Minio object at 0x1074ebb50>
                   └ <services.minio_storage.MinioStorage object at 0x107700610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ 35

AttributeError: 'int' object has no attribute 'read'
INFO     2023-06-20 21:28:29.998 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:28:29.999 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:28:30.100 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:28:30.101 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:28:30.105 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:28:30.106 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:28:30.109 request id: app - logging:callHandlers - Finished server process [34360]
INFO     2023-06-20 21:28:30.109 request id: app - logging:callHandlers - Finished server process [34360]
INFO     2023-06-20 21:28:30.510 request id: app - logging:callHandlers - Started server process [34470]
INFO     2023-06-20 21:28:30.510 request id: app - logging:callHandlers - Started server process [34470]
INFO     2023-06-20 21:28:30.511 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:28:30.511 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:28:30.511 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:28:30.511 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:28:34.173 request id: app - logging:callHandlers - 127.0.0.1:54465 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:28:34.175 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104e3cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104d49a80>
           └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d48fe0>
    └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11000d950>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>
    │    └ <function subprocess_started at 0x10671cd60>
    └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1100a4a50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10670bd80>
           │       │   └ <uvicorn.server.Server object at 0x1100a4a50>
           │       └ <function run at 0x1062719e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x110099360>
           │      └ <function Runner.run at 0x1062e5940>
           └ <asyncio.runners.Runner object at 0x11008cd50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1062df560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x11008cd50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1062df4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1062e5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1062722a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1100a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1100e8bd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1100a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110101e90>
          └ <fastapi.applications.FastAPI object at 0x1100e8bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1100df880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110100bd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110101e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1101015d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110100bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1100e8d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1101015d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107494680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1100df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110103d90>
                     └ <function get_request_handler.<locals>.app at 0x1100df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10747ab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x11008d710>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1100df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1100e9e10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x110067380>
                     └ <services.minio_storage.MinioStorage object at 0x11008d710>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107ee2660>
                   │    └ <miniopy_async.api.Minio object at 0x1100eb750>
                   └ <services.minio_storage.MinioStorage object at 0x11008d710>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ 35

AttributeError: 'int' object has no attribute 'read'
ERROR    2023-06-20 21:28:34.186 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104e3cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104d49a80>
           └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d48fe0>
    └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11000d950>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>
    │    └ <function subprocess_started at 0x10671cd60>
    └ <SpawnProcess name='SpawnProcess-13' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1100a4a50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10670bd80>
           │       │   └ <uvicorn.server.Server object at 0x1100a4a50>
           │       └ <function run at 0x1062719e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x110099360>
           │      └ <function Runner.run at 0x1062e5940>
           └ <asyncio.runners.Runner object at 0x11008cd50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1062df560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x11008cd50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1062df4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1062e5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1062722a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1100a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1100e8bd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1100a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110101e90>
          └ <fastapi.applications.FastAPI object at 0x1100e8bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1100df880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110100bd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110101e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1101015d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110100bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1100e8d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1101015d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107494680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1100dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101007d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1100df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110103d90>
                     └ <function get_request_handler.<locals>.app at 0x1100df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10747ab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x11008d710>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1100df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1100e9e10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x110067380>
                     └ <services.minio_storage.MinioStorage object at 0x11008d710>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107ee2660>
                   │    └ <miniopy_async.api.Minio object at 0x1100eb750>
                   └ <services.minio_storage.MinioStorage object at 0x11008d710>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ 35

AttributeError: 'int' object has no attribute 'read'
INFO     2023-06-20 21:29:37.701 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:29:37.702 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:29:37.803 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:29:37.803 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:29:37.804 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:29:37.805 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:29:37.805 request id: app - logging:callHandlers - Finished server process [34470]
INFO     2023-06-20 21:29:37.805 request id: app - logging:callHandlers - Finished server process [34470]
INFO     2023-06-20 21:29:38.204 request id: app - logging:callHandlers - Started server process [34576]
INFO     2023-06-20 21:29:38.204 request id: app - logging:callHandlers - Started server process [34576]
INFO     2023-06-20 21:29:38.204 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:29:38.204 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:29:38.204 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:29:38.205 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:29:42.725 request id: app - logging:callHandlers - 127.0.0.1:54495 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:29:42.725 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1052f8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x105205a80>
           └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105204fe0>
    └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1082d3610>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>
    │    └ <function subprocess_started at 0x1061c8d60>
    └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1082e89d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061b7d80>
           │       │   └ <uvicorn.server.Server object at 0x1082e89d0>
           │       └ <function run at 0x105d1d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1082dd360>
           │      └ <function Runner.run at 0x105d91940>
           └ <asyncio.runners.Runner object at 0x1075fe690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105d8b560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075fe690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105d8b4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105d91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105d1e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1082ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10832cb10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1082ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108240690>
          └ <fastapi.applications.FastAPI object at 0x10832cb10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108323880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108345950>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108240690>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108345910>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108345950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10832ccd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108345910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106e64680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1083234c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108347e50>
                     └ <function get_request_handler.<locals>.app at 0x108323560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106e4ab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x10832f7d0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x108323420>
                 └ <fastapi.dependencies.models.Dependant object at 0x10832de90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1082ab380>
                     └ <services.minio_storage.MinioStorage object at 0x10832f7d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.fput_object(
                   │    │      └ <function Minio.fput_object at 0x108225e40>
                   │    └ <miniopy_async.api.Minio object at 0x10832f750>
                   └ <services.minio_storage.MinioStorage object at 0x10832f7d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 1371, in fput_object
    file_size = os.stat(file_path).st_size
                │  │    └ <tempfile.SpooledTemporaryFile object at 0x108339420>
                │  └ <built-in function stat>
                └ <module 'os' (frozen)>

TypeError: stat: path should be string, bytes, os.PathLike or integer, not SpooledTemporaryFile
ERROR    2023-06-20 21:29:42.736 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1052f8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x105205a80>
           └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105204fe0>
    └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1082d3610>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>
    │    └ <function subprocess_started at 0x1061c8d60>
    └ <SpawnProcess name='SpawnProcess-14' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1082e89d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061b7d80>
           │       │   └ <uvicorn.server.Server object at 0x1082e89d0>
           │       └ <function run at 0x105d1d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1082dd360>
           │      └ <function Runner.run at 0x105d91940>
           └ <asyncio.runners.Runner object at 0x1075fe690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105d8b560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075fe690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105d8b4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105d91300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105d1e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x108385ed0>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1082ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10832cb10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1082ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108240690>
          └ <fastapi.applications.FastAPI object at 0x10832cb10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108323880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108345950>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108240690>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108345910>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108345950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10832ccd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108345910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106e64680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108323b00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108345450>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1083234c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108347e50>
                     └ <function get_request_handler.<locals>.app at 0x108323560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106e4ab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x10832f7d0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x108323420>
                 └ <fastapi.dependencies.models.Dependant object at 0x10832de90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1082ab380>
                     └ <services.minio_storage.MinioStorage object at 0x10832f7d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.fput_object(
                   │    │      └ <function Minio.fput_object at 0x108225e40>
                   │    └ <miniopy_async.api.Minio object at 0x10832f750>
                   └ <services.minio_storage.MinioStorage object at 0x10832f7d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 1371, in fput_object
    file_size = os.stat(file_path).st_size
                │  │    └ <tempfile.SpooledTemporaryFile object at 0x108339420>
                │  └ <built-in function stat>
                └ <module 'os' (frozen)>

TypeError: stat: path should be string, bytes, os.PathLike or integer, not SpooledTemporaryFile
INFO     2023-06-20 21:30:10.097 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:30:10.097 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:30:10.199 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:30:10.199 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:30:10.200 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:30:10.200 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:30:10.200 request id: app - logging:callHandlers - Finished server process [34576]
INFO     2023-06-20 21:30:10.200 request id: app - logging:callHandlers - Finished server process [34576]
INFO     2023-06-20 21:30:10.594 request id: app - logging:callHandlers - Started server process [34639]
INFO     2023-06-20 21:30:10.594 request id: app - logging:callHandlers - Started server process [34639]
INFO     2023-06-20 21:30:10.594 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:30:10.594 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:30:10.594 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:30:10.595 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:30:12.064 request id: app - logging:callHandlers - 127.0.0.1:54508 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:30:12.066 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x101290ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10119da80>
           └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10119cfe0>
    └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10388f550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>
    │    └ <function subprocess_started at 0x102160d60>
    └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1038a48d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10214fd80>
           │       │   └ <uvicorn.server.Server object at 0x1038a48d0>
           │       └ <function run at 0x101cb59e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103899360>
           │      └ <function Runner.run at 0x101d29940>
           └ <asyncio.runners.Runner object at 0x10388ca50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101d23560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10388ca50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101d234c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101d29300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101cb62a0>
    └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1038a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10388ff50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1038a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103900ed0>
          └ <fastapi.applications.FastAPI object at 0x10388ff50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1038df9c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103901310>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103900ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039012d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103901310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1038e8c90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039012d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102dfc680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1038df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x103903750>
                     └ <function get_request_handler.<locals>.app at 0x1038df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102de2b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x10392f650>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1038df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1038e9f10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x103867380>
                     └ <services.minio_storage.MinioStorage object at 0x10392f650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.fput_object(
                   │    │      └ <function Minio.fput_object at 0x1037e1e40>
                   │    └ <miniopy_async.api.Minio object at 0x1022a0e90>
                   └ <services.minio_storage.MinioStorage object at 0x10392f650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 1371, in fput_object
    file_size = os.stat(file_path).st_size
                │  │    └ <starlette.datastructures.UploadFile object at 0x103904e90>
                │  └ <built-in function stat>
                └ <module 'os' (frozen)>

TypeError: stat: path should be string, bytes, os.PathLike or integer, not UploadFile
ERROR    2023-06-20 21:30:12.088 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x101290ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10119da80>
           └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10119cfe0>
    └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10388f550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>
    │    └ <function subprocess_started at 0x102160d60>
    └ <SpawnProcess name='SpawnProcess-15' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1038a48d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10214fd80>
           │       │   └ <uvicorn.server.Server object at 0x1038a48d0>
           │       └ <function run at 0x101cb59e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103899360>
           │      └ <function Runner.run at 0x101d29940>
           └ <asyncio.runners.Runner object at 0x10388ca50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101d23560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10388ca50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101d234c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101d29300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101cb62a0>
    └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10393de40>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1038a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10388ff50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1038a6190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103900ed0>
          └ <fastapi.applications.FastAPI object at 0x10388ff50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1038df9c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103901310>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103900ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039012d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103901310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1038e8c90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039012d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102dfc680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1038dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103901150>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1038df4c0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x103903750>
                     └ <function get_request_handler.<locals>.app at 0x1038df560>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102de2b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x10392f650>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1038df420>
                 └ <fastapi.dependencies.models.Dependant object at 0x1038e9f10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 65, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x103867380>
                     └ <services.minio_storage.MinioStorage object at 0x10392f650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.fput_object(
                   │    │      └ <function Minio.fput_object at 0x1037e1e40>
                   │    └ <miniopy_async.api.Minio object at 0x1022a0e90>
                   └ <services.minio_storage.MinioStorage object at 0x10392f650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 1371, in fput_object
    file_size = os.stat(file_path).st_size
                │  │    └ <starlette.datastructures.UploadFile object at 0x103904e90>
                │  └ <built-in function stat>
                └ <module 'os' (frozen)>

TypeError: stat: path should be string, bytes, os.PathLike or integer, not UploadFile
INFO     2023-06-20 21:30:17.165 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:30:17.165 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:30:17.267 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:30:17.267 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:30:17.268 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:30:17.268 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:30:17.268 request id: app - logging:callHandlers - Finished server process [34639]
INFO     2023-06-20 21:30:17.268 request id: app - logging:callHandlers - Finished server process [34639]
INFO     2023-06-20 21:30:17.608 request id: app - logging:callHandlers - Started server process [34660]
INFO     2023-06-20 21:30:17.608 request id: app - logging:callHandlers - Started server process [34660]
INFO     2023-06-20 21:30:17.608 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:30:17.608 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:30:17.609 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:30:17.609 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:31:58.291 request id: app - logging:callHandlers - 127.0.0.1:54569 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:31:58.292 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ad4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1049e1a80>
           └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1049e0fe0>
    └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1083ab5d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>
    │    └ <function subprocess_started at 0x1059a4d60>
    └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1083c0950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105993d80>
           │       │   └ <uvicorn.server.Server object at 0x1083c0950>
           │       └ <function run at 0x1054f99e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1083b5360>
           │      └ <function Runner.run at 0x10556d940>
           └ <asyncio.runners.Runner object at 0x1083a8990>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105567560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1083a8990>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055674c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10556d300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1054fa2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1083c2150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1083abf50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1083c2150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108421ad0>
          └ <fastapi.applications.FastAPI object at 0x1083abf50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1083fb9c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108421b90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108421ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1083fbb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108421bd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108421b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x108420790>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108421000>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108421000>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1083fbc40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10841d510>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106500e00>
          └ <starlette.datastructures.UploadFile object at 0x10841d510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x105a174c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x108411300>
          │                 └ <starlette.datastructures.UploadFile object at 0x10841d510>
          └ <function run_in_threadpool at 0x106444180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108411300>>
                 │     │         └ <function run_sync at 0x106446f20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x106446700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108411300>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x10849df80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x108411300>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:31:58.308 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ad4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1049e1a80>
           └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1049e0fe0>
    └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1083ab5d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>
    │    └ <function subprocess_started at 0x1059a4d60>
    └ <SpawnProcess name='SpawnProcess-16' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1083c0950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105993d80>
           │       │   └ <uvicorn.server.Server object at 0x1083c0950>
           │       └ <function run at 0x1054f99e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1083b5360>
           │      └ <function Runner.run at 0x10556d940>
           └ <asyncio.runners.Runner object at 0x1083a8990>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105567560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1083a8990>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055674c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10556d300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1054fa2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1083c2150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1083abf50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1083c2150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108421ad0>
          └ <fastapi.applications.FastAPI object at 0x1083abf50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1083fb9c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108421b90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108421ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1083fbb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108423c90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108421bd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108421b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x108420790>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108421000>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x108421000>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x1083fbc40>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10841d510>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x106500e00>
          └ <starlette.datastructures.UploadFile object at 0x10841d510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x105a174c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x108411300>
          │                 └ <starlette.datastructures.UploadFile object at 0x10841d510>
          └ <function run_in_threadpool at 0x106444180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108411300>>
                 │     │         └ <function run_sync at 0x106446f20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x106446700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x108411300>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x10849df80>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x108411300>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:33:26.998 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:33:27.001 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:33:27.103 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:33:27.103 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:33:27.104 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:33:27.105 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:33:27.105 request id: app - logging:callHandlers - Finished server process [34660]
INFO     2023-06-20 21:33:27.105 request id: app - logging:callHandlers - Finished server process [34660]
INFO     2023-06-20 21:33:27.534 request id: app - logging:callHandlers - Started server process [34956]
INFO     2023-06-20 21:33:27.534 request id: app - logging:callHandlers - Started server process [34956]
INFO     2023-06-20 21:33:27.534 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:33:27.534 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:33:27.535 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:33:27.535 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:33:56.004 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:33:56.005 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:33:56.106 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:33:56.107 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:33:56.107 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:33:56.107 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:33:56.108 request id: app - logging:callHandlers - Finished server process [34956]
INFO     2023-06-20 21:33:56.108 request id: app - logging:callHandlers - Finished server process [34956]
INFO     2023-06-20 21:33:56.440 request id: app - logging:callHandlers - Started server process [35005]
INFO     2023-06-20 21:33:56.440 request id: app - logging:callHandlers - Started server process [35005]
INFO     2023-06-20 21:33:56.440 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:33:56.440 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:33:56.440 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:33:56.441 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:33:58.666 request id: app - logging:callHandlers - 127.0.0.1:54621 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:33:58.830 request id: app - logging:callHandlers - 127.0.0.1:54621 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:34:08.509 request id: app - logging:callHandlers - 127.0.0.1:54622 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:34:08.510 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104f1cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104e29a80>
           └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104e28fe0>
    └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1075d3610>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>
    │    └ <function subprocess_started at 0x105df0d60>
    └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1075e89d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ddbd80>
           │       │   └ <uvicorn.server.Server object at 0x1075e89d0>
           │       └ <function run at 0x1059419e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1075dd690>
           │      └ <function Runner.run at 0x1059b1940>
           └ <asyncio.runners.Runner object at 0x1075d0810>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1059af560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075d0810>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1059af4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1059b1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1059422a0>
    └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075ea250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1075d3ed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075ea250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107645ed0>
          └ <fastapi.applications.FastAPI object at 0x1075d3ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107627c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107645e90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107645ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107645e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107645e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1076309d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107645e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106a88680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1076277e0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107644cd0>
                     └ <function get_request_handler.<locals>.app at 0x107627880>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106a6eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1076472d0>, 'file': b'#https://contest.yandex.ru/contest/22781/r...
                 │         └ <function upload_file at 0x1076276a0>
                 └ <fastapi.dependencies.models.Dependant object at 0x107632f10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 67, in upload_file
    file=file, bucket=settings.bucket_name, url=f'{file.filename}'
         │            │        └ 'files'
         │            └ Settings(project_name='movies', project_description='movies', minio_access_key='kiUVFYmpQVnT1y7AzBod', minio_secret_key='H8t3...
         └ b'#https://contest.yandex.ru/contest/22781/run-report/88324703/\n\n"""\n\xd0\x92 \xd1\x81\xd0\xbe\xd0\xbe\xd1\x82\xd0\xb2\xd0...

AttributeError: 'bytes' object has no attribute 'filename'
ERROR    2023-06-20 21:34:08.525 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104f1cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104e29a80>
           └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104e28fe0>
    └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1075d3610>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>
    │    └ <function subprocess_started at 0x105df0d60>
    └ <SpawnProcess name='SpawnProcess-18' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1075e89d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105ddbd80>
           │       │   └ <uvicorn.server.Server object at 0x1075e89d0>
           │       └ <function run at 0x1059419e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1075dd690>
           │      └ <function Runner.run at 0x1059b1940>
           └ <asyncio.runners.Runner object at 0x1075d0810>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1059af560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1075d0810>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1059af4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1059b1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1059422a0>
    └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... 0x1076472d0>>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075ea250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1075d3ed0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1075ea250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107645ed0>
          └ <fastapi.applications.FastAPI object at 0x1075d3ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107627c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107645e90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107645ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107645e50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107645e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1076309d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107645e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106a88680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076279c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10764cad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1076277e0>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107644cd0>
                     └ <function get_request_handler.<locals>.app at 0x107627880>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106a6eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1076472d0>, 'file': b'#https://contest.yandex.ru/contest/22781/r...
                 │         └ <function upload_file at 0x1076276a0>
                 └ <fastapi.dependencies.models.Dependant object at 0x107632f10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 67, in upload_file
    file=file, bucket=settings.bucket_name, url=f'{file.filename}'
         │            │        └ 'files'
         │            └ Settings(project_name='movies', project_description='movies', minio_access_key='kiUVFYmpQVnT1y7AzBod', minio_secret_key='H8t3...
         └ b'#https://contest.yandex.ru/contest/22781/run-report/88324703/\n\n"""\n\xd0\x92 \xd1\x81\xd0\xbe\xd0\xbe\xd1\x82\xd0\xb2\xd0...

AttributeError: 'bytes' object has no attribute 'filename'
INFO     2023-06-20 21:34:38.159 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:34:38.160 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:34:38.261 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:34:38.261 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:34:38.262 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:34:38.263 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:34:38.263 request id: app - logging:callHandlers - Finished server process [35005]
INFO     2023-06-20 21:34:38.263 request id: app - logging:callHandlers - Finished server process [35005]
INFO     2023-06-20 21:34:38.594 request id: app - logging:callHandlers - Started server process [35091]
INFO     2023-06-20 21:34:38.594 request id: app - logging:callHandlers - Started server process [35091]
INFO     2023-06-20 21:34:38.594 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:34:38.594 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:34:38.595 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:34:38.595 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:34:41.746 request id: app - logging:callHandlers - 127.0.0.1:54641 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:34:41.887 request id: app - logging:callHandlers - 127.0.0.1:54641 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:34:47.878 request id: app - logging:callHandlers - 127.0.0.1:54642 - "POST / HTTP/1.1" 200
ERROR    2023-06-20 21:34:47.880 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e28ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d35a80>
           └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d34fe0>
    └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1053bbad0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>
    │    └ <function subprocess_started at 0x103cfcd60>
    └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1053d0e90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x103ce7d80>
           │       │   └ <uvicorn.server.Server object at 0x1053d0e90>
           │       └ <function run at 0x10384d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1053c5690>
           │      └ <function Runner.run at 0x1038bd940>
           └ <asyncio.runners.Runner object at 0x1053b8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1038bb560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1053b8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1038bb4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1038bd300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10384e2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053d8710>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10413c850>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053d8710>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1053d2210>
          └ <fastapi.applications.FastAPI object at 0x10413c850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10540fa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10542d750>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1053d2210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10540ff60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10542d790>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10542d750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105439a50>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105438f80>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105438f80>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x105440040>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10543d210>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x104854e00>
          └ <starlette.datastructures.UploadFile object at 0x10543d210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x103d6b4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1054276a0>
          │                 └ <starlette.datastructures.UploadFile object at 0x10543d210>
          └ <function run_in_threadpool at 0x104798180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1054276a0>>
                 │     │         └ <function run_sync at 0x10479af20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10479a700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1054276a0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x10542d540>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1054276a0>

OSError: [Errno 9] Bad file descriptor
ERROR    2023-06-20 21:34:47.896 request id: app - logging:callHandlers - Exception in ASGI application

OSError: [Errno 9] Bad file descriptor


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e28ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d35a80>
           └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d34fe0>
    └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1053bbad0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>
    │    └ <function subprocess_started at 0x103cfcd60>
    └ <SpawnProcess name='SpawnProcess-19' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1053d0e90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x103ce7d80>
           │       │   └ <uvicorn.server.Server object at 0x1053d0e90>
           │       └ <function run at 0x10384d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1053c5690>
           │      └ <function Runner.run at 0x1038bd940>
           └ <asyncio.runners.Runner object at 0x1053b8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1038bb560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1053b8d90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1038bb4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1038bd300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10384e2a0>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finis... descriptor')>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053d8710>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10413c850>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1053d8710>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1053d2210>
          └ <fastapi.applications.FastAPI object at 0x10413c850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10540fa60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10542d750>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1053d2210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10540ff60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10543ac50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10542d790>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10542d750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 14, in __call__
    async with AsyncExitStack() as stack:
               │                   └ <contextlib.AsyncExitStack object at 0x105439a50>
               └ <class 'contextlib.AsyncExitStack'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 733, in __aexit__
    raise exc_details[1]
          └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105438f80>)

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 716, in __aexit__
    cb_suppress = await cb(*exc_details)
                        │   └ (<class 'OSError'>, OSError(9, 'Bad file descriptor'), <traceback object at 0x105438f80>)
                        └ <function AsyncExitStack._create_async_cb_wrapper.<locals>._exit_wrapper at 0x105440040>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/contextlib.py", line 621, in _exit_wrapper
    await callback(*args, **kwds)
          │         │       └ {}
          │         └ ()
          └ <bound method FormData.close of FormData([('file', <starlette.datastructures.UploadFile object at 0x10543d210>)])>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 506, in close
    await value.close()
          │     └ <function UploadFile.close at 0x104854e00>
          └ <starlette.datastructures.UploadFile object at 0x10543d210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/datastructures.py", line 484, in close
    await run_in_threadpool(self.file.close)
          │                 │    │    └ <function SpooledTemporaryFile.close at 0x103d6b4c0>
          │                 │    └ <tempfile.SpooledTemporaryFile object at 0x1054276a0>
          │                 └ <starlette.datastructures.UploadFile object at 0x10543d210>
          └ <function run_in_threadpool at 0x104798180>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/concurrency.py", line 41, in run_in_threadpool
    return await anyio.to_thread.run_sync(func, *args)
                 │     │         │        │      └ ()
                 │     │         │        └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1054276a0>>
                 │     │         └ <function run_sync at 0x10479af20>
                 │     └ <module 'anyio.to_thread' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/a...
                 └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/to_thread.py", line 33, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
                 └ <function get_asynclib at 0x10479a700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 877, in run_sync_in_worker_thread
    return await future
                 └ <Future finished exception=OSError(9, 'Bad file descriptor')>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 807, in run
    result = context.run(func, *args)
             │       │   │      └ ()
             │       │   └ <bound method SpooledTemporaryFile.close of <tempfile.SpooledTemporaryFile object at 0x1054276a0>>
             │       └ <method 'run' of '_contextvars.Context' objects>
             └ <_contextvars.Context object at 0x10542d540>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tempfile.py", line 741, in close
    self._file.close()
    │    │     └ <method 'close' of '_io.BufferedRandom' objects>
    │    └ <_io.BufferedRandom name=35>
    └ <tempfile.SpooledTemporaryFile object at 0x1054276a0>

OSError: [Errno 9] Bad file descriptor
INFO     2023-06-20 21:40:13.183 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:40:13.184 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:40:13.286 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:40:13.286 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:40:13.287 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:40:13.287 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:40:13.288 request id: app - logging:callHandlers - Finished server process [35091]
INFO     2023-06-20 21:40:13.288 request id: app - logging:callHandlers - Finished server process [35091]
INFO     2023-06-20 21:40:13.652 request id: app - logging:callHandlers - Started server process [35611]
INFO     2023-06-20 21:40:13.653 request id: app - logging:callHandlers - Started server process [35611]
INFO     2023-06-20 21:40:13.653 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:40:13.653 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:40:13.653 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:40:13.654 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:29.447 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:45:29.449 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:45:29.552 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:45:29.552 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:45:29.553 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:45:29.553 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:45:29.553 request id: app - logging:callHandlers - Finished server process [35611]
INFO     2023-06-20 21:45:29.553 request id: app - logging:callHandlers - Finished server process [35611]
INFO     2023-06-20 21:45:29.895 request id: app - logging:callHandlers - Started server process [36113]
INFO     2023-06-20 21:45:29.895 request id: app - logging:callHandlers - Started server process [36113]
INFO     2023-06-20 21:45:29.896 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:45:29.896 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:45:29.897 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:29.897 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:36.072 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:45:36.073 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:45:36.174 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:45:36.175 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:45:36.176 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:45:36.177 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:45:36.177 request id: app - logging:callHandlers - Finished server process [36113]
INFO     2023-06-20 21:45:36.177 request id: app - logging:callHandlers - Finished server process [36113]
INFO     2023-06-20 21:45:48.275 request id: app - logging:callHandlers - Started server process [36150]
INFO     2023-06-20 21:45:48.275 request id: app - logging:callHandlers - Started server process [36150]
INFO     2023-06-20 21:45:48.275 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:45:48.275 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:45:48.275 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:48.276 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:52.622 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:45:52.624 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:45:52.725 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:45:52.726 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:45:52.726 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:45:52.726 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:45:52.727 request id: app - logging:callHandlers - Finished server process [36150]
INFO     2023-06-20 21:45:52.727 request id: app - logging:callHandlers - Finished server process [36150]
INFO     2023-06-20 21:45:53.008 request id: app - logging:callHandlers - Started server process [36160]
INFO     2023-06-20 21:45:53.008 request id: app - logging:callHandlers - Started server process [36160]
INFO     2023-06-20 21:45:53.009 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:45:53.010 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:45:53.011 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:53.011 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:45:58.581 request id: app - logging:callHandlers - 127.0.0.1:55239 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:45:58.731 request id: app - logging:callHandlers - 127.0.0.1:55239 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:46:05.408 request id: app - logging:callHandlers - 127.0.0.1:55240 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:46:05.409 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100c68ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100b75a80>
           └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100b74fe0>
    └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103c8f7d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>
    │    └ <function subprocess_started at 0x1024f4d60>
    └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ca4b50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1024dfd80>
           │       │   └ <uvicorn.server.Server object at 0x103ca4b50>
           │       └ <function run at 0x1020459e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103c99580>
           │      └ <function Runner.run at 0x1020b5940>
           └ <asyncio.runners.Runner object at 0x103c8c950>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1020b3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x103c8c950>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1020b34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1020b5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1020462a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ca6250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103ce8c50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ca6250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1026047d0>
          └ <fastapi.applications.FastAPI object at 0x103ce8c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x103cdfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106301b50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1026047d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106301b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106301b50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103ce8e10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106301b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x103104680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x103cdf740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1063028d0>
                     └ <function get_request_handler.<locals>.app at 0x103cdf7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1030eab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1063039d0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x103cdf600>
                 └ <fastapi.dependencies.models.Dependant object at 0x103cea210>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x103c67380>
                     └ <services.minio_storage.MinioStorage object at 0x1063039d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x103a36660>
                   │    └ <miniopy_async.api.Minio object at 0x1028aefd0>
                   └ <services.minio_storage.MinioStorage object at 0x1063039d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ 35

AttributeError: 'int' object has no attribute 'read'
ERROR    2023-06-20 21:46:05.426 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100c68ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100b75a80>
           └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100b74fe0>
    └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103c8f7d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>
    │    └ <function subprocess_started at 0x1024f4d60>
    └ <SpawnProcess name='SpawnProcess-25' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ca4b50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1024dfd80>
           │       │   └ <uvicorn.server.Server object at 0x103ca4b50>
           │       └ <function run at 0x1020459e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103c99580>
           │      └ <function Runner.run at 0x1020b5940>
           └ <asyncio.runners.Runner object at 0x103c8c950>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1020b3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x103c8c950>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1020b34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1020b5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1020462a0>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ca6250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103ce8c50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ca6250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1026047d0>
          └ <fastapi.applications.FastAPI object at 0x103ce8c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x103cdfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106301b50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1026047d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106301b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106301b50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103ce8e10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106301b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x103104680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103cdfec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106308890>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x103cdf740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1063028d0>
                     └ <function get_request_handler.<locals>.app at 0x103cdf7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1030eab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1063039d0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x103cdf600>
                 └ <fastapi.dependencies.models.Dependant object at 0x103cea210>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x103c67380>
                     └ <services.minio_storage.MinioStorage object at 0x1063039d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x103a36660>
                   │    └ <miniopy_async.api.Minio object at 0x1028aefd0>
                   └ <services.minio_storage.MinioStorage object at 0x1063039d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ 35

AttributeError: 'int' object has no attribute 'read'
INFO     2023-06-20 21:47:22.858 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:47:22.859 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:47:22.961 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:47:22.961 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:47:22.971 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:47:22.972 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:47:22.972 request id: app - logging:callHandlers - Finished server process [36160]
INFO     2023-06-20 21:47:22.973 request id: app - logging:callHandlers - Finished server process [36160]
INFO     2023-06-20 21:47:23.390 request id: app - logging:callHandlers - Started server process [36325]
INFO     2023-06-20 21:47:23.390 request id: app - logging:callHandlers - Started server process [36325]
INFO     2023-06-20 21:47:23.390 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:47:23.390 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:47:23.391 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:47:23.391 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:47:28.521 request id: app - logging:callHandlers - 127.0.0.1:55292 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:47:28.522 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104764ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104671a80>
           └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104670fe0>
    └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11898f550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>
    │    └ <function subprocess_started at 0x1061bcd60>
    └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11890e2d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061abd80>
           │       │   └ <uvicorn.server.Server object at 0x11890e2d0>
           │       └ <function run at 0x1055bd9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x118999580>
           │      └ <function Runner.run at 0x105631940>
           └ <asyncio.runners.Runner object at 0x106168d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10562b560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x106168d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10562b4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105631300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055be2a0>
    └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1189a6d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1189e8ad0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1189a6d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x118a02110>
          └ <fastapi.applications.FastAPI object at 0x1189e8ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1189954e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x118a00ed0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x118a02110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x118a00610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x118a00ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1189e8c90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x118a00610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1074e4680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1189df740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x118a0c550>
                     └ <function get_request_handler.<locals>.app at 0x1189df7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1074cab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x118a02410>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1189df600>
                 └ <fastapi.dependencies.models.Dependant object at 0x1189ea0d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x118967380>
                     └ <services.minio_storage.MinioStorage object at 0x118a02410>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107fe2660>
                   │    └ <miniopy_async.api.Minio object at 0x106420750>
                   └ <services.minio_storage.MinioStorage object at 0x118a02410>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'# Generated by the gRPC Python protocol compiler plugin. DO NOT EDIT!\n"""Client and server classes corresponding to protob...

AttributeError: 'bytes' object has no attribute 'read'
ERROR    2023-06-20 21:47:28.541 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104764ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104671a80>
           └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104670fe0>
    └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11898f550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>
    │    └ <function subprocess_started at 0x1061bcd60>
    └ <SpawnProcess name='SpawnProcess-26' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11890e2d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061abd80>
           │       │   └ <uvicorn.server.Server object at 0x11890e2d0>
           │       └ <function run at 0x1055bd9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x118999580>
           │      └ <function Runner.run at 0x105631940>
           └ <asyncio.runners.Runner object at 0x106168d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10562b560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x106168d10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10562b4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105631300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1055be2a0>
    └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x118a3e050>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1189a6d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1189e8ad0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1189a6d10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x118a02110>
          └ <fastapi.applications.FastAPI object at 0x1189e8ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1189954e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x118a00ed0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x118a02110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x118a00610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x118a00ed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1189e8c90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x118a00610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1074e4680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1189dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x118a00f10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1189df740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x118a0c550>
                     └ <function get_request_handler.<locals>.app at 0x1189df7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1074cab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x118a02410>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1189df600>
                 └ <fastapi.dependencies.models.Dependant object at 0x1189ea0d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x118967380>
                     └ <services.minio_storage.MinioStorage object at 0x118a02410>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 21, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107fe2660>
                   │    └ <miniopy_async.api.Minio object at 0x106420750>
                   └ <services.minio_storage.MinioStorage object at 0x118a02410>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'# Generated by the gRPC Python protocol compiler plugin. DO NOT EDIT!\n"""Client and server classes corresponding to protob...

AttributeError: 'bytes' object has no attribute 'read'
INFO     2023-06-20 21:47:50.609 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:47:50.615 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:47:50.717 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:47:50.718 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:47:50.720 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:47:50.721 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:47:50.721 request id: app - logging:callHandlers - Finished server process [36325]
INFO     2023-06-20 21:47:50.722 request id: app - logging:callHandlers - Finished server process [36325]
INFO     2023-06-20 21:47:51.128 request id: app - logging:callHandlers - Started server process [36386]
INFO     2023-06-20 21:47:51.129 request id: app - logging:callHandlers - Started server process [36386]
INFO     2023-06-20 21:47:51.129 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:47:51.129 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:47:51.129 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:47:51.130 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:48:18.469 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:48:18.470 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:48:18.571 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:48:18.571 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:48:18.572 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:48:18.572 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:48:18.572 request id: app - logging:callHandlers - Finished server process [36386]
INFO     2023-06-20 21:48:18.572 request id: app - logging:callHandlers - Finished server process [36386]
INFO     2023-06-20 21:48:18.929 request id: app - logging:callHandlers - Started server process [36427]
INFO     2023-06-20 21:48:18.929 request id: app - logging:callHandlers - Started server process [36427]
INFO     2023-06-20 21:48:18.929 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:48:18.930 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:48:18.930 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:48:18.930 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:48:35.911 request id: app - logging:callHandlers - 127.0.0.1:55314 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:48:36.067 request id: app - logging:callHandlers - 127.0.0.1:55314 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:48:43.133 request id: app - logging:callHandlers - 127.0.0.1:55315 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:48:43.134 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x105058ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f65a80>
           └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f64fe0>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1074ef590>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    └ <function subprocess_started at 0x105f2cd60>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107504950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105f17d80>
           │       │   └ <uvicorn.server.Server object at 0x107504950>
           │       └ <function run at 0x105a7d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1074f9580>
           │      └ <function Runner.run at 0x105aed940>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105aeb560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105aeb4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105aed300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a7e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1074ef550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
          └ <fastapi.applications.FastAPI object at 0x1074ef550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10753fb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107548c50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106bc4680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10753f740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107565290>
                     └ <function get_request_handler.<locals>.app at 0x10753f7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106baab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x107563bd0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x10753f600>
                 └ <fastapi.dependencies.models.Dependant object at 0x107549fd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1074c7380>
                     └ <services.minio_storage.MinioStorage object at 0x107563bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 22, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107442660>
                   │    └ <miniopy_async.api.Minio object at 0x106076250>
                   └ <services.minio_storage.MinioStorage object at 0x107563bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'{\n  "$schema": "http://json-schema.org/schema#",\n  "title": "JSON schema for User data",\n  "type": "object",\n  "require...

AttributeError: 'bytes' object has no attribute 'read'
ERROR    2023-06-20 21:48:43.158 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x105058ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f65a80>
           └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f64fe0>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1074ef590>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    └ <function subprocess_started at 0x105f2cd60>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107504950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105f17d80>
           │       │   └ <uvicorn.server.Server object at 0x107504950>
           │       └ <function run at 0x105a7d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1074f9580>
           │      └ <function Runner.run at 0x105aed940>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105aeb560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105aeb4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105aed300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a7e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1075aa170>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1074ef550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
          └ <fastapi.applications.FastAPI object at 0x1074ef550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10753fb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107548c50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106bc4680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10753fec0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107565810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10753f740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107565290>
                     └ <function get_request_handler.<locals>.app at 0x10753f7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106baab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x107563bd0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x10753f600>
                 └ <fastapi.dependencies.models.Dependant object at 0x107549fd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1074c7380>
                     └ <services.minio_storage.MinioStorage object at 0x107563bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 22, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107442660>
                   │    └ <miniopy_async.api.Minio object at 0x106076250>
                   └ <services.minio_storage.MinioStorage object at 0x107563bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'{\n  "$schema": "http://json-schema.org/schema#",\n  "title": "JSON schema for User data",\n  "type": "object",\n  "require...

AttributeError: 'bytes' object has no attribute 'read'
INFO     2023-06-20 21:49:23.515 request id: app - logging:callHandlers - 127.0.0.1:55402 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:49:23.516 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x105058ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f65a80>
           └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f64fe0>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1074ef590>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    └ <function subprocess_started at 0x105f2cd60>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107504950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105f17d80>
           │       │   └ <uvicorn.server.Server object at 0x107504950>
           │       └ <function run at 0x105a7d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1074f9580>
           │      └ <function Runner.run at 0x105aed940>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105aeb560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105aeb4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105aed300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a7e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1074ef550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
          └ <fastapi.applications.FastAPI object at 0x1074ef550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10753ff60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107548c50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106bc4680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10753f740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1101a0850>
                     └ <function get_request_handler.<locals>.app at 0x10753f7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106baab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1101a26d0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x10753f600>
                 └ <fastapi.dependencies.models.Dependant object at 0x107549fd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1074c7380>
                     └ <services.minio_storage.MinioStorage object at 0x1101a26d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 22, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107442660>
                   │    └ <miniopy_async.api.Minio object at 0x106076250>
                   └ <services.minio_storage.MinioStorage object at 0x1101a26d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'{\n  "$schema": "http://json-schema.org/schema#",\n  "title": "JSON schema for User data",\n  "type": "object",\n  "require...

AttributeError: 'bytes' object has no attribute 'read'
ERROR    2023-06-20 21:49:23.527 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x105058ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f65a80>
           └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f64fe0>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1074ef590>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>
    │    └ <function subprocess_started at 0x105f2cd60>
    └ <SpawnProcess name='SpawnProcess-28' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x107504950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105f17d80>
           │       │   └ <uvicorn.server.Server object at 0x107504950>
           │       └ <function run at 0x105a7d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1074f9580>
           │      └ <function Runner.run at 0x105aed940>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105aeb560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104e86710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105aeb4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105aed300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105a7e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1075ab820>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1074ef550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x107506150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
          └ <fastapi.applications.FastAPI object at 0x1074ef550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10753ff60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10605c7d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107560590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107548c50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075623d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106bc4680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075be0c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1101a0550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10753f740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1101a0850>
                     └ <function get_request_handler.<locals>.app at 0x10753f7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106baab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x1101a26d0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x10753f600>
                 └ <fastapi.dependencies.models.Dependant object at 0x107549fd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x1074c7380>
                     └ <services.minio_storage.MinioStorage object at 0x1101a26d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 22, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x107442660>
                   │    └ <miniopy_async.api.Minio object at 0x106076250>
                   └ <services.minio_storage.MinioStorage object at 0x1101a26d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'{\n  "$schema": "http://json-schema.org/schema#",\n  "title": "JSON schema for User data",\n  "type": "object",\n  "require...

AttributeError: 'bytes' object has no attribute 'read'
INFO     2023-06-20 21:50:14.027 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:50:14.028 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:50:14.130 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:50:14.130 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:50:14.131 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:50:14.131 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:50:14.131 request id: app - logging:callHandlers - Finished server process [36427]
INFO     2023-06-20 21:50:14.131 request id: app - logging:callHandlers - Finished server process [36427]
INFO     2023-06-20 21:50:14.557 request id: app - logging:callHandlers - Started server process [36623]
INFO     2023-06-20 21:50:14.557 request id: app - logging:callHandlers - Started server process [36623]
INFO     2023-06-20 21:50:14.557 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:50:14.557 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:50:14.558 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:50:14.558 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:50:17.942 request id: app - logging:callHandlers - 127.0.0.1:55456 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 21:50:18.068 request id: app - logging:callHandlers - 127.0.0.1:55456 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 21:50:24.444 request id: app - logging:callHandlers - 127.0.0.1:55457 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:50:24.445 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1045f4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104501a80>
           └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104500fe0>
    └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1098932d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>
    │    └ <function subprocess_started at 0x106eb4d60>
    └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1098a4690>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x106ea3d80>
           │       │   └ <uvicorn.server.Server object at 0x1098a4690>
           │       └ <function run at 0x106c3d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x109899580>
           │      └ <function Runner.run at 0x106cb1940>
           └ <asyncio.runners.Runner object at 0x109890490>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x106cab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109890490>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x106cab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x106cb1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106c3e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1098a5e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109893f90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1098a5e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109a007d0>
          └ <fastapi.applications.FastAPI object at 0x109893f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1098dfba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109a00850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109a007d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109a00890>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109a00850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1098ec950>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109a00890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x108e64680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1098df740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x109a00550>
                     └ <function get_request_handler.<locals>.app at 0x1098df7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x108e4ab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x109891d10>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1098df600>
                 └ <fastapi.dependencies.models.Dependant object at 0x1098edd10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x109867380>
                     └ <services.minio_storage.MinioStorage object at 0x109891d10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 24, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1097e2660>
                   │    └ <miniopy_async.api.Minio object at 0x1098efcd0>
                   └ <services.minio_storage.MinioStorage object at 0x109891d10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'IyBodHRwczovL2NvbnRlc3QueWFuZGV4LnJ1L2NvbnRlc3QvMjI0NTAvcnVuLXJlcG9ydC84ODAxMjM0Mi8KbiA9IGludChpbnB1dCgpKQphcnJheSA9IGxpc3Q...

AttributeError: 'bytes' object has no attribute 'read'
ERROR    2023-06-20 21:50:24.456 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1045f4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104501a80>
           └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104500fe0>
    └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1098932d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>
    │    └ <function subprocess_started at 0x106eb4d60>
    └ <SpawnProcess name='SpawnProcess-29' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1098a4690>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x106ea3d80>
           │       │   └ <uvicorn.server.Server object at 0x1098a4690>
           │       └ <function run at 0x106c3d9e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x109899580>
           │      └ <function Runner.run at 0x106cb1940>
           └ <asyncio.runners.Runner object at 0x109890490>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x106cab560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x109890490>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x106cab4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x106cb1300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106c3e2a0>
    └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x109a46200>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1098a5e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109893f90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1098a5e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109a007d0>
          └ <fastapi.applications.FastAPI object at 0x109893f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1098dfba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109a00850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109a007d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109a00890>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109a00850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1098ec950>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109a00890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x108e64680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1098dfce0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109a04bd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1098df740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x109a00550>
                     └ <function get_request_handler.<locals>.app at 0x1098df7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x108e4ab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x109891d10>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1098df600>
                 └ <fastapi.dependencies.models.Dependant object at 0x1098edd10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x109867380>
                     └ <services.minio_storage.MinioStorage object at 0x109891d10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 24, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1097e2660>
                   │    └ <miniopy_async.api.Minio object at 0x1098efcd0>
                   └ <services.minio_storage.MinioStorage object at 0x109891d10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'IyBodHRwczovL2NvbnRlc3QueWFuZGV4LnJ1L2NvbnRlc3QvMjI0NTAvcnVuLXJlcG9ydC84ODAxMjM0Mi8KbiA9IGludChpbnB1dCgpKQphcnJheSA9IGxpc3Q...

AttributeError: 'bytes' object has no attribute 'read'
INFO     2023-06-20 21:50:53.222 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:50:53.223 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:50:53.324 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:50:53.325 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:50:53.325 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:50:53.326 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:50:53.326 request id: app - logging:callHandlers - Finished server process [36623]
INFO     2023-06-20 21:50:53.326 request id: app - logging:callHandlers - Finished server process [36623]
INFO     2023-06-20 21:50:53.677 request id: app - logging:callHandlers - Started server process [36705]
INFO     2023-06-20 21:50:53.678 request id: app - logging:callHandlers - Started server process [36705]
INFO     2023-06-20 21:50:53.678 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:50:53.678 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:50:53.678 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:50:53.678 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:50:55.922 request id: app - logging:callHandlers - 127.0.0.1:55503 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:50:55.923 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104c8cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104b99a80>
           └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104b98fe0>
    └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11168fa10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>
    │    └ <function subprocess_started at 0x105b60d60>
    └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1116a4d90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105b4bd80>
           │       │   └ <uvicorn.server.Server object at 0x1116a4d90>
           │       └ <function run at 0x1056b19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x111699580>
           │      └ <function Runner.run at 0x105721940>
           └ <asyncio.runners.Runner object at 0x11168cd90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10571f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x11168cd90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10571f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105721300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1056b22a0>
    └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1110c6c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1116e8f50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1110c6c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1116a6210>
          └ <fastapi.applications.FastAPI object at 0x1116e8f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1116dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111800ad0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1116a6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1118008d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111800ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1116e9110>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1118008d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x110b48680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1116df740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x11180c450>
                     └ <function get_request_handler.<locals>.app at 0x1116df7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x110b2eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x111802cd0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1116df600>
                 └ <fastapi.dependencies.models.Dependant object at 0x1116ea450>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x111667380>
                     └ <services.minio_storage.MinioStorage object at 0x111802cd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 23, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1115e2660>
                   │    └ <miniopy_async.api.Minio object at 0x1068bafd0>
                   └ <services.minio_storage.MinioStorage object at 0x111802cd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'# https://contest.yandex.ru/contest/22450/run-report/88012342/\nn = int(input())\narray = list(map(int, input().split()))\n...

AttributeError: 'bytes' object has no attribute 'read'
ERROR    2023-06-20 21:50:55.945 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104c8cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104b99a80>
           └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104b98fe0>
    └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11168fa10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>
    │    └ <function subprocess_started at 0x105b60d60>
    └ <SpawnProcess name='SpawnProcess-30' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1116a4d90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105b4bd80>
           │       │   └ <uvicorn.server.Server object at 0x1116a4d90>
           │       └ <function run at 0x1056b19e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x111699580>
           │      └ <function Runner.run at 0x105721940>
           └ <asyncio.runners.Runner object at 0x11168cd90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10571f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x11168cd90>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10571f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105721300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1056b22a0>
    └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x11183a020>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1110c6c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1116e8f50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1110c6c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1116a6210>
          └ <fastapi.applications.FastAPI object at 0x1116e8f50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1116dfb00>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111800ad0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1116a6210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1118008d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111800ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1116e9110>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1118008d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x110b48680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1116dfc40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111803390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x1116df740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x11180c450>
                     └ <function get_request_handler.<locals>.app at 0x1116df7e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x110b2eb60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x111802cd0>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x1116df600>
                 └ <fastapi.dependencies.models.Dependant object at 0x1116ea450>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x111667380>
                     └ <services.minio_storage.MinioStorage object at 0x111802cd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 23, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x1115e2660>
                   │    └ <miniopy_async.api.Minio object at 0x1068bafd0>
                   └ <services.minio_storage.MinioStorage object at 0x111802cd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'# https://contest.yandex.ru/contest/22450/run-report/88012342/\nn = int(input())\narray = list(map(int, input().split()))\n...

AttributeError: 'bytes' object has no attribute 'read'
INFO     2023-06-20 21:51:05.720 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:51:05.720 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:51:05.822 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:51:05.822 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:51:05.823 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:51:05.823 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:51:05.823 request id: app - logging:callHandlers - Finished server process [36705]
INFO     2023-06-20 21:51:05.823 request id: app - logging:callHandlers - Finished server process [36705]
INFO     2023-06-20 21:51:06.183 request id: app - logging:callHandlers - Started server process [36741]
INFO     2023-06-20 21:51:06.183 request id: app - logging:callHandlers - Started server process [36741]
INFO     2023-06-20 21:51:06.183 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:51:06.183 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:51:06.184 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:51:06.184 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:13.501 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:52:13.502 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:52:13.603 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:52:13.604 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:52:13.607 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:52:13.607 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:52:13.608 request id: app - logging:callHandlers - Finished server process [36741]
INFO     2023-06-20 21:52:13.609 request id: app - logging:callHandlers - Finished server process [36741]
INFO     2023-06-20 21:52:13.951 request id: app - logging:callHandlers - Started server process [36866]
INFO     2023-06-20 21:52:13.951 request id: app - logging:callHandlers - Started server process [36866]
INFO     2023-06-20 21:52:13.951 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:52:13.951 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:52:13.951 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:13.952 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:16.684 request id: app - logging:callHandlers - 127.0.0.1:55527 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:52:16.685 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104e20ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104d2da80>
           └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d2cfe0>
    └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1072b7590>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>
    │    └ <function subprocess_started at 0x105cf4d60>
    └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1072cc950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105cdfd80>
           │       │   └ <uvicorn.server.Server object at 0x1072cc950>
           │       └ <function run at 0x1058459e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1072c1580>
           │      └ <function Runner.run at 0x1058b5940>
           └ <asyncio.runners.Runner object at 0x104c4e710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1058b3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104c4e710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1058b34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1058b5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1058462a0>
    └ <Handle <TaskStepMethWrapper object at 0x107366050>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x107366050>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x107366050>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x107366050>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1072ce150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1072b7550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1072ce150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105e247d0>
          └ <fastapi.applications.FastAPI object at 0x1072b7550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1072a7a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10732a0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105e247d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10732a190>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10732a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107310c50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10732a190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x10698c680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107307740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1073340d0>
                     └ <function get_request_handler.<locals>.app at 0x1073077e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106972b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x10732aa50>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x107307600>
                 └ <fastapi.dependencies.models.Dependant object at 0x107311fd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x10728f380>
                     └ <services.minio_storage.MinioStorage object at 0x10732aa50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 23, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x10720a660>
                   │    └ <miniopy_async.api.Minio object at 0x105e3e250>
                   └ <services.minio_storage.MinioStorage object at 0x10732aa50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ <coroutine object UploadFile.read at 0x107317060>

AttributeError: 'coroutine' object has no attribute 'read'
ERROR    2023-06-20 21:52:16.700 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104e20ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104d2da80>
           └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d2cfe0>
    └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1072b7590>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>
    │    └ <function subprocess_started at 0x105cf4d60>
    └ <SpawnProcess name='SpawnProcess-32' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1072cc950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105cdfd80>
           │       │   └ <uvicorn.server.Server object at 0x1072cc950>
           │       └ <function run at 0x1058459e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1072c1580>
           │      └ <function Runner.run at 0x1058b5940>
           └ <asyncio.runners.Runner object at 0x104c4e710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1058b3560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104c4e710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1058b34c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1058b5300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1058462a0>
    └ <Handle <TaskStepMethWrapper object at 0x107366050>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x107366050>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x107366050>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x107366050>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1072ce150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1072b7550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1072ce150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105e247d0>
          └ <fastapi.applications.FastAPI object at 0x1072b7550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1072a7a60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10732a0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105e247d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10732a190>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10732a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107310c50>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10732a190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x10698c680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107307c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107328ed0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107307740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1073340d0>
                     └ <function get_request_handler.<locals>.app at 0x1073077e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106972b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x10732aa50>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x107307600>
                 └ <fastapi.dependencies.models.Dependant object at 0x107311fd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x10728f380>
                     └ <services.minio_storage.MinioStorage object at 0x10732aa50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 23, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x10720a660>
                   │    └ <miniopy_async.api.Minio object at 0x105e3e250>
                   └ <services.minio_storage.MinioStorage object at 0x10732aa50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ <coroutine object UploadFile.read at 0x107317060>

AttributeError: 'coroutine' object has no attribute 'read'
INFO     2023-06-20 21:52:24.424 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:52:24.424 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:52:24.526 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:52:24.526 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:52:24.527 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:52:24.527 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:52:24.528 request id: app - logging:callHandlers - Finished server process [36866]
INFO     2023-06-20 21:52:24.528 request id: app - logging:callHandlers - Finished server process [36866]
INFO     2023-06-20 21:52:24.958 request id: app - logging:callHandlers - Started server process [36893]
INFO     2023-06-20 21:52:24.958 request id: app - logging:callHandlers - Started server process [36893]
INFO     2023-06-20 21:52:24.959 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:52:24.959 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:52:24.959 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:24.959 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:27.103 request id: app - logging:callHandlers - 127.0.0.1:55532 - "POST / HTTP/1.1" 500
ERROR    2023-06-20 21:52:27.105 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1030ecae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102ff9a80>
           └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102ff8fe0>
    └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108cc7710>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>
    │    └ <function subprocess_started at 0x104bc0d60>
    └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108cdcad0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x104babd80>
           │       │   └ <uvicorn.server.Server object at 0x108cdcad0>
           │       └ <function run at 0x103b119e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108cd1580>
           │      └ <function Runner.run at 0x103b81940>
           └ <asyncio.runners.Runner object at 0x104b68f10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103b7f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104b68f10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103b7f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103b81300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103b122a0>
    └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108cded90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108d20b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108cded90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104cf07d0>
          └ <fastapi.applications.FastAPI object at 0x108d20b50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108ccd4e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108f00a10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104cf07d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108f00b10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108f00a10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108d20d10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108f00b10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107430680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x108d17740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108f04410>
                     └ <function get_request_handler.<locals>.app at 0x108d177e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107416b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x108f02390>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x108d17600>
                 └ <fastapi.dependencies.models.Dependant object at 0x108d22090>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x108c9f380>
                     └ <services.minio_storage.MinioStorage object at 0x108f02390>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 23, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x108c1a660>
                   │    └ <miniopy_async.api.Minio object at 0x107652250>
                   └ <services.minio_storage.MinioStorage object at 0x108f02390>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'# https://contest.yandex.ru/contest/22450/run-report/88012342/\nn = int(input())\narray = list(map(int, input().split()))\n...

AttributeError: 'bytes' object has no attribute 'read'
ERROR    2023-06-20 21:52:27.115 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1030ecae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102ff9a80>
           └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102ff8fe0>
    └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108cc7710>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>
    │    └ <function subprocess_started at 0x104bc0d60>
    └ <SpawnProcess name='SpawnProcess-33' parent=31321 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108cdcad0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x104babd80>
           │       │   └ <uvicorn.server.Server object at 0x108cdcad0>
           │       └ <function run at 0x103b119e0>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x108cd1580>
           │      └ <function Runner.run at 0x103b81940>
           └ <asyncio.runners.Runner object at 0x104b68f10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x103b7f560>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104b68f10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103b7f4c0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103b81300>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103b122a0>
    └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x108f3e0e0>()>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108cded90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108d20b50>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108cded90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104cf07d0>
          └ <fastapi.applications.FastAPI object at 0x108d20b50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x108ccd4e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108f00a10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104cf07d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108f00b10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108f00a10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108d20d10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108f00b10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107430680>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x108d17c40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x108f02610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x108d17740>
          └ APIRoute(path='/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x108f04410>
                     └ <function get_request_handler.<locals>.app at 0x108d177e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107416b60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'service': <services.minio_storage.MinioStorage object at 0x108f02390>, 'file': <starlette.datastructures.UploadFile object ...
                 │         └ <function upload_file at 0x108d17600>
                 └ <fastapi.dependencies.models.Dependant object at 0x108d22090>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/main.py", line 66, in upload_file
    document = await service.save(
                     │       └ <function MinioStorage.save at 0x108c9f380>
                     └ <services.minio_storage.MinioStorage object at 0x108f02390>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 23, in save
    result = await self.client.put_object(
                   │    │      └ <function Minio.put_object at 0x108c1a660>
                   │    └ <miniopy_async.api.Minio object at 0x107652250>
                   └ <services.minio_storage.MinioStorage object at 0x108f02390>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/miniopy_async/api.py", line 2293, in put_object
    if not callable(getattr(data, "read")):
                            └ b'# https://contest.yandex.ru/contest/22450/run-report/88012342/\nn = int(input())\narray = list(map(int, input().split()))\n...

AttributeError: 'bytes' object has no attribute 'read'
INFO     2023-06-20 21:52:39.239 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:52:39.240 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:52:39.344 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:52:39.345 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:52:39.349 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:52:39.349 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:52:39.350 request id: app - logging:callHandlers - Finished server process [36893]
INFO     2023-06-20 21:52:39.350 request id: app - logging:callHandlers - Finished server process [36893]
INFO     2023-06-20 21:52:39.828 request id: app - logging:callHandlers - Started server process [36921]
INFO     2023-06-20 21:52:39.828 request id: app - logging:callHandlers - Started server process [36921]
INFO     2023-06-20 21:52:39.829 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:52:39.829 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:52:39.829 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:39.829 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:52:41.971 request id: app - logging:callHandlers - 127.0.0.1:55539 - "POST / HTTP/1.1" 200
INFO     2023-06-20 21:52:58.685 request id: app - logging:callHandlers - 127.0.0.1:55577 - "POST / HTTP/1.1" 200
INFO     2023-06-20 21:53:37.845 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:53:37.846 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:53:37.948 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:53:37.948 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:53:37.949 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:53:37.949 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:53:37.950 request id: app - logging:callHandlers - Finished server process [36921]
INFO     2023-06-20 21:53:37.950 request id: app - logging:callHandlers - Finished server process [36921]
INFO     2023-06-20 21:53:38.343 request id: app - logging:callHandlers - Started server process [37020]
INFO     2023-06-20 21:53:38.343 request id: app - logging:callHandlers - Started server process [37020]
INFO     2023-06-20 21:53:38.343 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:53:38.343 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:53:38.344 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:53:38.344 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:53:41.783 request id: app - logging:callHandlers - 127.0.0.1:55620 - "POST / HTTP/1.1" 200
INFO     2023-06-20 21:55:50.651 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:55:50.657 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:55:50.763 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:55:50.764 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:55:50.765 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:55:50.765 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:55:50.765 request id: app - logging:callHandlers - Finished server process [37020]
INFO     2023-06-20 21:55:50.765 request id: app - logging:callHandlers - Finished server process [37020]
INFO     2023-06-20 21:55:51.096 request id: app - logging:callHandlers - Started server process [37232]
INFO     2023-06-20 21:55:51.096 request id: app - logging:callHandlers - Started server process [37232]
INFO     2023-06-20 21:55:51.096 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:55:51.096 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:55:51.096 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:55:51.097 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:56:08.366 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:56:08.367 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 21:56:08.468 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:56:08.469 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 21:56:08.469 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:56:08.470 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 21:56:08.470 request id: app - logging:callHandlers - Finished server process [37232]
INFO     2023-06-20 21:56:08.470 request id: app - logging:callHandlers - Finished server process [37232]
INFO     2023-06-20 21:56:08.824 request id: app - logging:callHandlers - Started server process [37265]
INFO     2023-06-20 21:56:08.824 request id: app - logging:callHandlers - Started server process [37265]
INFO     2023-06-20 21:56:08.825 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:56:08.825 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 21:56:08.825 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:56:08.825 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 21:56:12.175 request id: app - logging:callHandlers - 127.0.0.1:55699 - "POST / HTTP/1.1" 200
INFO     2023-06-20 22:02:35.767 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 22:02:35.768 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-20 22:02:35.869 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 22:02:35.870 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-20 22:02:35.870 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 22:02:35.870 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-20 22:02:35.871 request id: app - logging:callHandlers - Finished server process [37265]
INFO     2023-06-20 22:02:35.871 request id: app - logging:callHandlers - Finished server process [37265]
INFO     2023-06-20 22:02:36.355 request id: app - logging:callHandlers - Started server process [37936]
INFO     2023-06-20 22:02:36.356 request id: app - logging:callHandlers - Started server process [37936]
INFO     2023-06-20 22:02:36.356 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 22:02:36.356 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-20 22:02:36.356 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 22:02:36.356 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-20 22:02:41.325 request id: app - logging:callHandlers - 127.0.0.1:55892 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-20 22:02:41.476 request id: app - logging:callHandlers - 127.0.0.1:55892 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-20 22:02:57.516 request id: app - logging:callHandlers - 127.0.0.1:55893 - "POST / HTTP/1.1" 200
INFO     2023-06-21 10:34:46.835 request id: app - logging:callHandlers - Started server process [7460]
INFO     2023-06-21 10:34:46.835 request id: app - logging:callHandlers - Started server process [7460]
INFO     2023-06-21 10:34:46.835 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:34:46.836 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:34:46.836 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:34:46.836 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:34:48.967 request id: app - logging:callHandlers - 127.0.0.1:55624 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 10:34:49.131 request id: app - logging:callHandlers - 127.0.0.1:55624 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 10:35:21.679 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:35:21.680 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:35:21.781 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:35:21.782 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:35:21.783 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:35:21.783 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:35:21.783 request id: app - logging:callHandlers - Finished server process [7460]
INFO     2023-06-21 10:35:21.783 request id: app - logging:callHandlers - Finished server process [7460]
INFO     2023-06-21 10:35:22.157 request id: app - logging:callHandlers - Started server process [7517]
INFO     2023-06-21 10:35:22.158 request id: app - logging:callHandlers - Started server process [7517]
INFO     2023-06-21 10:35:22.158 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:35:22.158 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:35:22.158 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:35:22.158 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:35:23.681 request id: app - logging:callHandlers - 127.0.0.1:55631 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 10:35:23.889 request id: app - logging:callHandlers - 127.0.0.1:55631 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 10:35:38.539 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:35:38.540 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:35:38.641 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:35:38.641 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:35:38.642 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:35:38.642 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:35:38.642 request id: app - logging:callHandlers - Finished server process [7517]
INFO     2023-06-21 10:35:38.642 request id: app - logging:callHandlers - Finished server process [7517]
INFO     2023-06-21 10:35:39.036 request id: app - logging:callHandlers - Started server process [7559]
INFO     2023-06-21 10:35:39.037 request id: app - logging:callHandlers - Started server process [7559]
INFO     2023-06-21 10:35:39.037 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:35:39.037 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:35:39.037 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:35:39.038 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:35:41.866 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:35:41.866 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:35:41.968 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:35:41.968 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:35:41.968 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:35:41.969 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:35:41.969 request id: app - logging:callHandlers - Finished server process [7559]
INFO     2023-06-21 10:35:41.969 request id: app - logging:callHandlers - Finished server process [7559]
INFO     2023-06-21 10:35:42.244 request id: app - logging:callHandlers - Started server process [7575]
INFO     2023-06-21 10:35:42.244 request id: app - logging:callHandlers - Started server process [7575]
INFO     2023-06-21 10:35:42.244 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:35:42.244 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:35:42.245 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:35:42.245 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:35:43.085 request id: app - logging:callHandlers - 127.0.0.1:55638 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 10:35:43.212 request id: app - logging:callHandlers - 127.0.0.1:55638 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 10:36:09.517 request id: app - logging:callHandlers - 127.0.0.1:55639 - "POST /api/v1/ HTTP/1.1" 200
INFO     2023-06-21 10:37:18.097 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:37:18.099 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:37:18.201 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:37:18.202 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:37:18.203 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:37:18.203 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:37:18.204 request id: app - logging:callHandlers - Finished server process [7575]
INFO     2023-06-21 10:37:18.205 request id: app - logging:callHandlers - Finished server process [7575]
INFO     2023-06-21 10:37:23.079 request id: app - logging:callHandlers - Started server process [7892]
INFO     2023-06-21 10:37:23.079 request id: app - logging:callHandlers - Started server process [7892]
INFO     2023-06-21 10:37:23.079 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:37:23.079 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:37:23.080 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:37:23.080 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:47:25.237 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:47:25.238 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:47:25.339 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:47:25.339 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:47:25.340 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:47:25.340 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:47:25.340 request id: app - logging:callHandlers - Finished server process [7892]
INFO     2023-06-21 10:47:25.340 request id: app - logging:callHandlers - Finished server process [7892]
INFO     2023-06-21 10:47:25.800 request id: app - logging:callHandlers - Started server process [8947]
INFO     2023-06-21 10:47:25.800 request id: app - logging:callHandlers - Started server process [8947]
INFO     2023-06-21 10:47:25.800 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:47:25.800 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:47:25.801 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:47:25.801 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:47:35.823 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:47:35.823 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:47:35.925 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:47:35.925 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:47:35.926 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:47:35.926 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:47:35.926 request id: app - logging:callHandlers - Finished server process [8947]
INFO     2023-06-21 10:47:35.926 request id: app - logging:callHandlers - Finished server process [8947]
INFO     2023-06-21 10:47:42.787 request id: app - logging:callHandlers - Started server process [9029]
INFO     2023-06-21 10:47:42.788 request id: app - logging:callHandlers - Started server process [9029]
INFO     2023-06-21 10:47:42.788 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:47:42.788 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:47:42.789 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:47:42.789 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:48:26.966 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:48:26.967 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 10:48:27.068 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:48:27.068 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 10:48:27.069 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:48:27.069 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 10:48:27.069 request id: app - logging:callHandlers - Finished server process [9029]
INFO     2023-06-21 10:48:27.069 request id: app - logging:callHandlers - Finished server process [9029]
INFO     2023-06-21 10:48:27.478 request id: app - logging:callHandlers - Started server process [9107]
INFO     2023-06-21 10:48:27.478 request id: app - logging:callHandlers - Started server process [9107]
INFO     2023-06-21 10:48:27.478 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:48:27.479 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 10:48:27.479 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 10:48:27.479 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:03:00.139 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:03:00.140 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:03:00.242 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:03:00.242 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:03:00.248 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:03:00.249 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:03:00.249 request id: app - logging:callHandlers - Finished server process [9107]
INFO     2023-06-21 11:03:00.249 request id: app - logging:callHandlers - Finished server process [9107]
INFO     2023-06-21 11:05:47.462 request id: app - logging:callHandlers - Started server process [10974]
INFO     2023-06-21 11:05:47.462 request id: app - logging:callHandlers - Started server process [10974]
INFO     2023-06-21 11:05:47.462 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:05:47.463 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:05:47.561 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:05:47.561 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:05:47.568 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:05:47.568 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:05:47.572 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:05:47.572 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:05:47.575 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:05:47.578 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:05:47.578 request id: app - logging:callHandlers - [generated in 0.00040s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:05:47.587 request id: app - logging:callHandlers - 
CREATE TABLE files (
	id UUID NOT NULL, 
	path_in_storage VARCHAR(255) NOT NULL, 
	filename VARCHAR(255) NOT NULL, 
	short_name VARCHAR(255) NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (path_in_storage), 
	UNIQUE (short_name)
)


INFO     2023-06-21 11:05:47.588 request id: app - logging:callHandlers - [no key 0.00031s] ()
INFO     2023-06-21 11:05:47.606 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:05:47.609 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:05:47.609 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:06:13.001 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:06:13.002 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:06:13.104 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:06:13.104 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:06:13.105 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:06:13.105 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:06:13.106 request id: app - logging:callHandlers - Finished server process [10974]
INFO     2023-06-21 11:06:13.106 request id: app - logging:callHandlers - Finished server process [10974]
INFO     2023-06-21 11:06:35.913 request id: app - logging:callHandlers - Started server process [11111]
INFO     2023-06-21 11:06:35.913 request id: app - logging:callHandlers - Started server process [11111]
INFO     2023-06-21 11:06:35.913 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:06:35.913 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:06:35.972 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:06:35.972 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:06:35.976 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:06:35.976 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:06:35.979 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:06:35.979 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:06:35.982 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:06:35.985 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:06:35.985 request id: app - logging:callHandlers - [generated in 0.00032s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:06:36.158 request id: app - logging:callHandlers - 
CREATE TABLE files (
	id UUID NOT NULL, 
	path_in_storage VARCHAR(255) NOT NULL, 
	filename VARCHAR(255) NOT NULL, 
	short_name VARCHAR(255) NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (path_in_storage), 
	UNIQUE (short_name)
)


INFO     2023-06-21 11:06:36.159 request id: app - logging:callHandlers - [no key 0.15618s] ()
INFO     2023-06-21 11:06:36.267 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:06:36.272 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:06:36.272 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:07:23.793 request id: app - logging:callHandlers - 127.0.0.1:56807 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 11:07:23.955 request id: app - logging:callHandlers - 127.0.0.1:56807 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 11:07:32.339 request id: app - logging:callHandlers - 127.0.0.1:56808 - "POST /api/v1/ HTTP/1.1" 500
ERROR    2023-06-21 11:07:32.340 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104908ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104815a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104814fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10a390a10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>
    │    └ <function subprocess_started at 0x1061c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10a391d90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061abe20>
           │       │   └ <uvicorn.server.Server object at 0x10a391d90>
           │       └ <function run at 0x105445a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x10a36e570>
           │      └ <function Runner.run at 0x1054b99e0>
           └ <asyncio.runners.Runner object at 0x10a28c0d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1054b3600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10a28c0d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1054b3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1054b93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105446340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10a393fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10a3f1550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10a393fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10a3fa650>
          └ <fastapi.applications.FastAPI object at 0x10a3f1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10a7234c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10a3f9250>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10a3fa650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10a3fae90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10a3f9250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10a3f1610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10a3fae90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106d98720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10a3edda0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10a74ff50>
                     └ <function get_request_handler.<locals>.app at 0x10a3ede40>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106d7ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'manager': <services.manager.FileManager object at 0x10a3fb110>, 'db': <sqlalchemy.orm.session.AsyncSession object at 0x109f...
                 │         └ <function upload_file at 0x10a2f2b60>
                 └ <fastapi.dependencies.models.Dependant object at 0x10a3f2b10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 25, in upload_file
    document = await manager.save(file=file)
                     │       │         └ <starlette.datastructures.UploadFile object at 0x10a3f8790>
                     │       └ <function FileManager.save at 0x10a2f2f20>
                     └ <services.manager.FileManager object at 0x10a3fb110>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 15, in save
    _ = await self.storage.save(file, settings.bucket, url=f'{file.filename}')
              │    │       │    │     └ Settings(debug_mode=True, project_name='movies', project_description='movies', minio_access_key='kiUVFYmpQVnT1y7AzBod', minio...
              │    │       │    └ <starlette.datastructures.UploadFile object at 0x10a3f8790>
              │    │       └ <function MinioStorage.save at 0x10a2f31a0>
              │    └ <services.minio_storage.MinioStorage object at 0x10a301490>
              └ <services.manager.FileManager object at 0x10a3fb110>

AttributeError: 'Settings' object has no attribute 'bucket'
ERROR    2023-06-21 11:07:32.355 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104908ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104815a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104814fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10a390a10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>
    │    └ <function subprocess_started at 0x1061c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=11105 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10a391d90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1061abe20>
           │       │   └ <uvicorn.server.Server object at 0x10a391d90>
           │       └ <function run at 0x105445a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x10a36e570>
           │      └ <function Runner.run at 0x1054b99e0>
           └ <asyncio.runners.Runner object at 0x10a28c0d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1054b3600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10a28c0d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1054b3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1054b93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105446340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10a393fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10a3f1550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10a393fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10a3fa650>
          └ <fastapi.applications.FastAPI object at 0x10a3f1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10a7234c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10a3f9250>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10a3fa650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10a3fae90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10a3f9250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10a3f1610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10a3fae90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106d98720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10a7237e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10a74e090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10a3edda0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10a74ff50>
                     └ <function get_request_handler.<locals>.app at 0x10a3ede40>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106d7ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'manager': <services.manager.FileManager object at 0x10a3fb110>, 'db': <sqlalchemy.orm.session.AsyncSession object at 0x109f...
                 │         └ <function upload_file at 0x10a2f2b60>
                 └ <fastapi.dependencies.models.Dependant object at 0x10a3f2b10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 25, in upload_file
    document = await manager.save(file=file)
                     │       │         └ <starlette.datastructures.UploadFile object at 0x10a3f8790>
                     │       └ <function FileManager.save at 0x10a2f2f20>
                     └ <services.manager.FileManager object at 0x10a3fb110>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 15, in save
    _ = await self.storage.save(file, settings.bucket, url=f'{file.filename}')
              │    │       │    │     └ Settings(debug_mode=True, project_name='movies', project_description='movies', minio_access_key='kiUVFYmpQVnT1y7AzBod', minio...
              │    │       │    └ <starlette.datastructures.UploadFile object at 0x10a3f8790>
              │    │       └ <function MinioStorage.save at 0x10a2f31a0>
              │    └ <services.minio_storage.MinioStorage object at 0x10a301490>
              └ <services.manager.FileManager object at 0x10a3fb110>

AttributeError: 'Settings' object has no attribute 'bucket'
INFO     2023-06-21 11:07:58.045 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:07:58.047 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:07:58.149 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:07:58.149 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:07:58.150 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:07:58.150 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:07:58.150 request id: app - logging:callHandlers - Finished server process [11111]
INFO     2023-06-21 11:07:58.150 request id: app - logging:callHandlers - Finished server process [11111]
INFO     2023-06-21 11:07:58.753 request id: app - logging:callHandlers - Started server process [11259]
INFO     2023-06-21 11:07:58.753 request id: app - logging:callHandlers - Started server process [11259]
INFO     2023-06-21 11:07:58.753 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:07:58.753 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:07:58.814 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:07:58.815 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:07:58.818 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:07:58.819 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:07:58.821 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:07:58.821 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:07:58.824 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:07:58.826 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:07:58.826 request id: app - logging:callHandlers - [generated in 0.00024s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:07:58.830 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:07:58.831 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:07:58.832 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:08:02.307 request id: app - logging:callHandlers - 127.0.0.1:56822 - "POST /api/v1/ HTTP/1.1" 500
INFO     2023-06-21 11:09:13.827 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:09:13.828 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:09:13.929 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:09:13.930 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:09:13.931 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:09:13.931 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:09:13.931 request id: app - logging:callHandlers - Finished server process [11259]
INFO     2023-06-21 11:09:13.931 request id: app - logging:callHandlers - Finished server process [11259]
INFO     2023-06-21 11:09:15.864 request id: app - logging:callHandlers - Started server process [11428]
INFO     2023-06-21 11:09:15.865 request id: app - logging:callHandlers - Started server process [11428]
INFO     2023-06-21 11:09:15.865 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:09:15.865 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:09:15.923 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:09:15.924 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:09:15.927 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:09:15.927 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:09:15.930 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:09:15.931 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:09:15.933 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:09:15.935 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:09:15.935 request id: app - logging:callHandlers - [generated in 0.00025s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:09:15.950 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:09:15.952 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:09:15.952 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:09:30.510 request id: app - logging:callHandlers - 127.0.0.1:56893 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 11:09:30.690 request id: app - logging:callHandlers - 127.0.0.1:56893 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 11:09:38.480 request id: app - logging:callHandlers - 127.0.0.1:56894 - "POST /api/v1/ HTTP/1.1" 500
ERROR    2023-06-21 11:09:38.482 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104e2cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104d39a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d38fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10aacd110>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>
    │    └ <function subprocess_started at 0x105d00e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10aace450>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105cebe20>
           │       │   └ <uvicorn.server.Server object at 0x10aace450>
           │       └ <function run at 0x105851a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x10aaaa570>
           │      └ <function Runner.run at 0x1058c59e0>
           └ <asyncio.runners.Runner object at 0x10aa3d910>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1058bf600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10aa3d910>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1058bf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1058c53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105852340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aacefd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10ab29c10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aacefd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10ab368d0>
          └ <fastapi.applications.FastAPI object at 0x10ab29c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10ad23380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10ab36910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10ab368d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10ab369d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10ab36910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10ab29d10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10ab369d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107530720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10ab2dda0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10ad4ec50>
                     └ <function get_request_handler.<locals>.app at 0x10ab2de40>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 259, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x1075128e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 145, in serialize_response
    raise ValidationError(errors, field.type_)
          │               │       │     └ <member 'type_' of 'ModelField' objects>
          │               │       └ ModelField(name='Response_upload_file_api_v1__post', type=FileResponse, required=True)
          │               └ [ErrorWrapper(exc=ValidationError(model='FileResponse', errors=[{'loc': ('id',), 'msg': 'field required', 'type': 'value_erro...
          └ <class 'pydantic.error_wrappers.ValidationError'>

pydantic.error_wrappers.ValidationError: 5 validation errors for FileResponse
response -> id
  field required (type=value_error.missing)
response -> path_in_storage
  field required (type=value_error.missing)
response -> filename
  field required (type=value_error.missing)
response -> short_name
  field required (type=value_error.missing)
response -> created_at
  field required (type=value_error.missing)
ERROR    2023-06-21 11:09:38.498 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104e2cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104d39a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d38fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10aacd110>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>
    │    └ <function subprocess_started at 0x105d00e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=11419 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10aace450>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x105cebe20>
           │       │   └ <uvicorn.server.Server object at 0x10aace450>
           │       └ <function run at 0x105851a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x10aaaa570>
           │      └ <function Runner.run at 0x1058c59e0>
           └ <asyncio.runners.Runner object at 0x10aa3d910>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1058bf600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10aa3d910>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1058bf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1058c53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105852340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aacefd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10ab29c10>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aacefd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10ab368d0>
          └ <fastapi.applications.FastAPI object at 0x10ab29c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10ad23380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10ab36910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10ab368d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10ab369d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10ab36910>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10ab29d10>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10ab369d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107530720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10ad23600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10ad4e010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10ab2dda0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10ad4ec50>
                     └ <function get_request_handler.<locals>.app at 0x10ab2de40>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 259, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x1075128e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 145, in serialize_response
    raise ValidationError(errors, field.type_)
          │               │       │     └ <member 'type_' of 'ModelField' objects>
          │               │       └ ModelField(name='Response_upload_file_api_v1__post', type=FileResponse, required=True)
          │               └ [ErrorWrapper(exc=ValidationError(model='FileResponse', errors=[{'loc': ('id',), 'msg': 'field required', 'type': 'value_erro...
          └ <class 'pydantic.error_wrappers.ValidationError'>

pydantic.error_wrappers.ValidationError: 5 validation errors for FileResponse
response -> id
  field required (type=value_error.missing)
response -> path_in_storage
  field required (type=value_error.missing)
response -> filename
  field required (type=value_error.missing)
response -> short_name
  field required (type=value_error.missing)
response -> created_at
  field required (type=value_error.missing)
INFO     2023-06-21 11:17:25.514 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:17:25.515 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:17:25.616 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:17:25.616 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:17:25.617 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:17:25.617 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:17:25.618 request id: app - logging:callHandlers - Finished server process [11428]
INFO     2023-06-21 11:17:25.618 request id: app - logging:callHandlers - Finished server process [11428]
INFO     2023-06-21 11:17:26.520 request id: app - logging:callHandlers - Started server process [12238]
INFO     2023-06-21 11:17:26.520 request id: app - logging:callHandlers - Started server process [12238]
INFO     2023-06-21 11:17:26.520 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:17:26.521 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:17:26.611 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:17:26.611 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:17:26.633 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:17:26.634 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:17:26.641 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:17:26.641 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:17:26.724 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:17:26.726 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:17:26.736 request id: app - logging:callHandlers - [generated in 0.00036s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:17:26.765 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:17:26.766 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:17:26.766 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:20:59.419 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:20:59.420 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:20:59.522 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:20:59.523 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:20:59.524 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:20:59.524 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:20:59.524 request id: app - logging:callHandlers - Finished server process [12238]
INFO     2023-06-21 11:20:59.525 request id: app - logging:callHandlers - Finished server process [12238]
INFO     2023-06-21 11:21:00.430 request id: app - logging:callHandlers - Started server process [12595]
INFO     2023-06-21 11:21:00.431 request id: app - logging:callHandlers - Started server process [12595]
INFO     2023-06-21 11:21:00.431 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:21:00.431 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:21:00.467 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:21:00.467 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:21:00.471 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:21:00.471 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:21:00.484 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:21:00.484 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:21:00.487 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:21:00.489 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:21:00.489 request id: app - logging:callHandlers - [generated in 0.00037s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:21:00.502 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:21:00.503 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:21:00.503 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:25:53.975 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:25:53.981 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:25:54.084 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:25:54.085 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:25:54.086 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:25:54.087 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:25:54.087 request id: app - logging:callHandlers - Finished server process [12595]
INFO     2023-06-21 11:25:54.088 request id: app - logging:callHandlers - Finished server process [12595]
INFO     2023-06-21 11:25:55.110 request id: app - logging:callHandlers - Started server process [13079]
INFO     2023-06-21 11:25:55.110 request id: app - logging:callHandlers - Started server process [13079]
INFO     2023-06-21 11:25:55.111 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:25:55.111 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:25:55.478 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:25:55.478 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:25:55.501 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:25:55.501 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:25:55.512 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:25:55.513 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:25:55.527 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:25:55.530 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:25:55.531 request id: app - logging:callHandlers - [generated in 0.00036s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:25:55.545 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:25:55.550 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:25:55.550 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:26:00.829 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:26:00.834 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 11:26:00.834 request id: app - logging:callHandlers - [generated in 0.00108s] (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'T5XBgZa2oPDtTKuNMkHMXK', datetime.datetime(2023, 6, 21, 8, 26, 0, 833842))
INFO     2023-06-21 11:26:00.866 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:26:00.868 request id: app - logging:callHandlers - 127.0.0.1:57306 - "POST /api/v1/ HTTP/1.1" 500
ERROR    2023-06-21 11:26:00.868 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 504, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                      │                └ <function AsyncAdapt_asyncpg_connection._prepare at 0x1069d0900>
                                      └ <AdaptedConnection <asyncpg.connection.Connection object at 0x106cbf4c0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 754, in _prepare
    prepared_stmt = await self._connection.prepare(
                          │    └ <member '_connection' of 'AdaptedConnection' objects>
                          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x106cbf4c0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/connection.py", line 565, in prepare
    return await self._prepare(
                 │    └ <function Connection._prepare at 0x106ad2ac0>
                 └ <asyncpg.connection.Connection object at 0x106cbf4c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/connection.py", line 583, in _prepare
    stmt = await self._get_statement(
                 │    └ <function Connection._get_statement at 0x106ad27a0>
                 └ <asyncpg.connection.Connection object at 0x106cbf4c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/connection.py", line 397, in _get_statement
    statement = await self._protocol.prepare(
                      │    └ <member '_protocol' of 'Connection' objects>
                      └ <asyncpg.connection.Connection object at 0x106cbf4c0>
  File "asyncpg/protocol/protocol.pyx", line 168, in prepare
    return await waiter

asyncpg.exceptions.UndefinedColumnError: column "size" of relation "files" does not exist


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x10615fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1067e0350>
    └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1069cfc40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x106e6c700>
           └ <_AsyncIoGreenlet object at 0x106ed0300 (otid=0x1058c33c0) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x106cff5e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1069cfa60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedColumnError('column "size" of relation "files" does not exist')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedColumnError('column "size" of relation "files" does not exist')
          └ ProgrammingError('<class \'asyncpg.exceptions.UndefinedColumnError\'>: column "size" of relation "files" does not exist')

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedColumnError'>: column "size" of relation "files" does not exist


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1009f0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1006fda80>
           └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1006fcfe0>
    └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106a8e550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>
    │    └ <function subprocess_started at 0x1030d8e00>
    └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106caf850>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1030c3e20>
           │       │   └ <uvicorn.server.Server object at 0x106caf850>
           │       └ <function run at 0x102c29a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x106c92ce0>
           │      └ <function Runner.run at 0x102c9d9e0>
           └ <asyncio.runners.Runner object at 0x1067b9590>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102c97600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1067b9590>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102c97560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102c9d3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c2a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106cb0e10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106e433d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106cb0e10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e5b190>
          └ <fastapi.applications.FastAPI object at 0x106e433d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106e52de0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106e5b850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e5b190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105849790>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106e5b850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106e434d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105849790>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x105030720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106e50720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106e84e90>
                     └ <function get_request_handler.<locals>.app at 0x106e507c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x105012c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'manager': <services.manager.FileManager object at 0x106e86e50>, 'db': <sqlalchemy.orm.session.AsyncSession object at 0x106e...
                 │         └ <function upload_file at 0x1060ecd60>
                 └ <fastapi.dependencies.models.Dependant object at 0x106e58810>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 25, in upload_file
    document = await manager.save(db, file=file)
                     │       │    │        └ <starlette.datastructures.UploadFile object at 0x106e86510>
                     │       │    └ <sqlalchemy.orm.session.AsyncSession object at 0x106e67bd0>
                     │       └ <function FileManager.save at 0x106c09760>
                     └ <services.manager.FileManager object at 0x106e86e50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 29, in save
    await db.commit()
          │  └ <function AsyncSession.commit at 0x10677b9c0>
          └ <sqlalchemy.orm.session.AsyncSession object at 0x106e67bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py", line 933, in commit
    await greenlet_spawn(self.sync_session.commit)
          │              │    │            └ <function Session.commit at 0x10649f2e0>
          │              │    └ <sqlalchemy.orm.session.Session object at 0x106e64610>
          │              └ <sqlalchemy.orm.session.AsyncSession object at 0x106e67bd0>
          └ <function greenlet_spawn at 0x10591df80>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x106ed0300 (otid=0x1058c33c0) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1899, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x10649e480>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
  File "<string>", line 2, in commit
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
                └ <function SessionTransaction.commit at 0x10649e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1218, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x10649e160>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
  File "<string>", line 2, in _prepare_impl
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
                └ <function SessionTransaction._prepare_impl at 0x10649e0c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1193, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x1064a6020>
    │    └ <sqlalchemy.orm.session.Session object at 0x106e64610>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4142, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x1064a6200>
    └ <sqlalchemy.orm.session.Session object at 0x106e64610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4277, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x106e74940>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class \'asyncpg.exceptions.UndefinedColumnError\...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4238, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x10647ad40>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x106ed18d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x106ed18d0>
    │   └ <function SaveUpdateAll.execute at 0x10647b880>
    └ SaveUpdateAll(Mapper[FileDbModel(files)])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x1063d2ca0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site...
    │    └ <module 'sqlalchemy.util.preloaded' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-...
    └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x106471d00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x1060d4b80>
             └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x106e84650>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x1060d4ea0>
           └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x1060d5080>
          └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x1060d5120>
           └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x1060d53a0>
    └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError('<class \'asyncpg.exceptions.UndefinedColumnError\'>: column "size" of relation "files" does not exist')
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError'>, ProgrammingError('<class \'async...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class \'asyncpg.exceptions.UndefinedColumnError\...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x10615fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1067e0350>
    └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1069cfc40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x106e6c700>
           └ <_AsyncIoGreenlet object at 0x106ed0300 (otid=0x1058c33c0) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x106cff5e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1069cfa60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedColumnError('column "size" of relation "files" does not exist')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedColumnError('column "size" of relation "files" does not exist')
          └ ProgrammingError('<class \'asyncpg.exceptions.UndefinedColumnError\'>: column "size" of relation "files" does not exist')

sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column "size" of relation "files" does not exist
[SQL: INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'T5XBgZa2oPDtTKuNMkHMXK', datetime.datetime(2023, 6, 21, 8, 26, 0, 833842))]
(Background on this error at: https://sqlalche.me/e/20/f405)
ERROR    2023-06-21 11:26:00.894 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 504, in _prepare_and_execute
    prepared_stmt, attributes = await adapt_connection._prepare(
                                      │                └ <function AsyncAdapt_asyncpg_connection._prepare at 0x1069d0900>
                                      └ <AdaptedConnection <asyncpg.connection.Connection object at 0x106cbf4c0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 754, in _prepare
    prepared_stmt = await self._connection.prepare(
                          │    └ <member '_connection' of 'AdaptedConnection' objects>
                          └ <AdaptedConnection <asyncpg.connection.Connection object at 0x106cbf4c0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/connection.py", line 565, in prepare
    return await self._prepare(
                 │    └ <function Connection._prepare at 0x106ad2ac0>
                 └ <asyncpg.connection.Connection object at 0x106cbf4c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/connection.py", line 583, in _prepare
    stmt = await self._get_statement(
                 │    └ <function Connection._get_statement at 0x106ad27a0>
                 └ <asyncpg.connection.Connection object at 0x106cbf4c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/connection.py", line 397, in _get_statement
    statement = await self._protocol.prepare(
                      │    └ <member '_protocol' of 'Connection' objects>
                      └ <asyncpg.connection.Connection object at 0x106cbf4c0>
  File "asyncpg/protocol/protocol.pyx", line 168, in prepare
    return await waiter

asyncpg.exceptions.UndefinedColumnError: column "size" of relation "files" does not exist


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x10615fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1067e0350>
    └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1069cfc40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x106e6c700>
           └ <_AsyncIoGreenlet object at 0x106ed0300 (otid=0x1058c33c0) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x106cff5e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1069cfa60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedColumnError('column "size" of relation "files" does not exist')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedColumnError('column "size" of relation "files" does not exist')
          └ ProgrammingError('<class \'asyncpg.exceptions.UndefinedColumnError\'>: column "size" of relation "files" does not exist')

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError: <class 'asyncpg.exceptions.UndefinedColumnError'>: column "size" of relation "files" does not exist


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1009f0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1006fda80>
           └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1006fcfe0>
    └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106a8e550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>
    │    └ <function subprocess_started at 0x1030d8e00>
    └ <SpawnProcess name='SpawnProcess-4' parent=11419 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106caf850>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1030c3e20>
           │       │   └ <uvicorn.server.Server object at 0x106caf850>
           │       └ <function run at 0x102c29a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x106c92ce0>
           │      └ <function Runner.run at 0x102c9d9e0>
           └ <asyncio.runners.Runner object at 0x1067b9590>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x102c97600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1067b9590>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102c97560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102c9d3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102c2a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106cb0e10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106e433d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x106cb0e10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e5b190>
          └ <fastapi.applications.FastAPI object at 0x106e433d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106e52de0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106e5b850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106e5b190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105849790>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x106e5b850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106e434d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105849790>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x105030720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106e53380>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106e842d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106e50720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106e84e90>
                     └ <function get_request_handler.<locals>.app at 0x106e507c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x105012c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'manager': <services.manager.FileManager object at 0x106e86e50>, 'db': <sqlalchemy.orm.session.AsyncSession object at 0x106e...
                 │         └ <function upload_file at 0x1060ecd60>
                 └ <fastapi.dependencies.models.Dependant object at 0x106e58810>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 25, in upload_file
    document = await manager.save(db, file=file)
                     │       │    │        └ <starlette.datastructures.UploadFile object at 0x106e86510>
                     │       │    └ <sqlalchemy.orm.session.AsyncSession object at 0x106e67bd0>
                     │       └ <function FileManager.save at 0x106c09760>
                     └ <services.manager.FileManager object at 0x106e86e50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 29, in save
    await db.commit()
          │  └ <function AsyncSession.commit at 0x10677b9c0>
          └ <sqlalchemy.orm.session.AsyncSession object at 0x106e67bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py", line 933, in commit
    await greenlet_spawn(self.sync_session.commit)
          │              │    │            └ <function Session.commit at 0x10649f2e0>
          │              │    └ <sqlalchemy.orm.session.Session object at 0x106e64610>
          │              └ <sqlalchemy.orm.session.AsyncSession object at 0x106e67bd0>
          └ <function greenlet_spawn at 0x10591df80>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x106ed0300 (otid=0x1058c33c0) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1899, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x10649e480>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
  File "<string>", line 2, in commit
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
                └ <function SessionTransaction.commit at 0x10649e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1218, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x10649e160>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
  File "<string>", line 2, in _prepare_impl
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
                └ <function SessionTransaction._prepare_impl at 0x10649e0c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1193, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x1064a6020>
    │    └ <sqlalchemy.orm.session.Session object at 0x106e64610>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x106ea7700>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4142, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x1064a6200>
    └ <sqlalchemy.orm.session.Session object at 0x106e64610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4277, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x106e74940>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class \'asyncpg.exceptions.UndefinedColumnError\...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4238, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x10647ad40>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x106ed18d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x106ed18d0>
    │   └ <function SaveUpdateAll.execute at 0x10647b880>
    └ SaveUpdateAll(Mapper[FileDbModel(files)])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x1063d2ca0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site...
    │    └ <module 'sqlalchemy.util.preloaded' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-...
    └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x106471d00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x1060d4b80>
             └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x106e84650>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x1060d4ea0>
           └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x1060d5080>
          └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x1060d5120>
           └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x1060d53a0>
    └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ ProgrammingError('<class \'asyncpg.exceptions.UndefinedColumnError\'>: column "size" of relation "files" does not exist')
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.ProgrammingError'>, ProgrammingError('<class \'async...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ ProgrammingError('(sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class \'asyncpg.exceptions.UndefinedColumnError\...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x10615fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1067e0350>
    └ <sqlalchemy.engine.base.Connection object at 0x106ecb510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1069cfc40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x106e6c700>
           └ <_AsyncIoGreenlet object at 0x106ed0300 (otid=0x1058c33c0) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x106cff5e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1069cfa60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ UndefinedColumnError('column "size" of relation "files" does not exist')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x106e9e4a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ UndefinedColumnError('column "size" of relation "files" does not exist')
          └ ProgrammingError('<class \'asyncpg.exceptions.UndefinedColumnError\'>: column "size" of relation "files" does not exist')

sqlalchemy.exc.ProgrammingError: (sqlalchemy.dialects.postgresql.asyncpg.ProgrammingError) <class 'asyncpg.exceptions.UndefinedColumnError'>: column "size" of relation "files" does not exist
[SQL: INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('8aa718b8-0c89-4384-959f-aafaa97fa9b5'), 'T5XBgZa2oPDtTKuNMkHMXK/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'T5XBgZa2oPDtTKuNMkHMXK', datetime.datetime(2023, 6, 21, 8, 26, 0, 833842))]
(Background on this error at: https://sqlalche.me/e/20/f405)
INFO     2023-06-21 11:26:10.189 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:26:10.189 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:26:10.291 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:26:10.291 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:26:10.291 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:26:10.292 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:26:10.292 request id: app - logging:callHandlers - Finished server process [13079]
INFO     2023-06-21 11:26:10.292 request id: app - logging:callHandlers - Finished server process [13079]
INFO     2023-06-21 11:26:18.061 request id: app - logging:callHandlers - Started server process [13139]
INFO     2023-06-21 11:26:18.061 request id: app - logging:callHandlers - Started server process [13139]
INFO     2023-06-21 11:26:18.061 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:26:18.061 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:26:18.116 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:26:18.117 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:18.122 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:26:18.122 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:18.125 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:26:18.125 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:18.127 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:26:18.130 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:26:18.130 request id: app - logging:callHandlers - [generated in 0.00029s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:26:18.134 request id: app - logging:callHandlers - 
CREATE TABLE files (
	id UUID NOT NULL, 
	path_in_storage VARCHAR(255) NOT NULL, 
	filename VARCHAR(255) NOT NULL, 
	size INTEGER NOT NULL, 
	file_type VARCHAR(10) NOT NULL, 
	short_name VARCHAR(24) NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (path_in_storage), 
	UNIQUE (short_name)
)


INFO     2023-06-21 11:26:18.134 request id: app - logging:callHandlers - [no key 0.00024s] ()
INFO     2023-06-21 11:26:18.147 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:26:18.149 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:26:18.149 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:26:23.621 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:26:23.625 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 11:26:23.626 request id: app - logging:callHandlers - [generated in 0.00235s] (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'R3X8KnXQNH483A35zd6726', datetime.datetime(2023, 6, 21, 8, 26, 23, 624079))
INFO     2023-06-21 11:26:23.636 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:26:23.640 request id: app - logging:callHandlers - 127.0.0.1:57328 - "POST /api/v1/ HTTP/1.1" 500
ERROR    2023-06-21 11:26:23.640 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 528, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │    │             │             └ <function PreparedStatement.fetch at 0x110ad0720>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x110e61e90>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x110e61e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x110e61e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x110da1ff0>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x110ecf420>
  File "asyncpg/protocol/protocol.pyx", line 201, in bind_execute
    return await waiter

asyncpg.exceptions.StringDataRightTruncationError: value too long for type character varying(10)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x11015fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1107dc210>
    └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1108d3c40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x110e7d240>
           └ <_AsyncIoGreenlet object at 0x110ebcc80 (otid=0x107297360) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x110e4b850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1108d3a60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ StringDataRightTruncationError('value too long for type character varying(10)')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ StringDataRightTruncationError('value too long for type character varying(10)')
          └ Error("<class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)")

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102744ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102651a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102650fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x110dfa390>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>
    │    └ <function subprocess_started at 0x1048c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x110dfb710>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1048abe20>
           │       │   └ <uvicorn.server.Server object at 0x110dfb710>
           │       └ <function run at 0x103169a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x110ddece0>
           │      └ <function Runner.run at 0x1031dd9e0>
           └ <asyncio.runners.Runner object at 0x104869410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1031d7600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104869410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1031d7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1031dd3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10316a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110dfdbd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110e53390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110dfdbd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110e74310>
          └ <fastapi.applications.FastAPI object at 0x110e53390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x110e5d080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110d51c50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110e74310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110e74350>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110d51c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110e53450>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110e74350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1066f8720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x110e5c7c0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110ea1910>
                     └ <function get_request_handler.<locals>.app at 0x110e5c860>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1066dac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'manager': <services.manager.FileManager object at 0x110ea7bd0>, 'db': <sqlalchemy.orm.session.AsyncSession object at 0x110e...
                 │         └ <function upload_file at 0x110af2b60>
                 └ <fastapi.dependencies.models.Dependant object at 0x110e68850>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 25, in upload_file
    document = await manager.save(db, file=file)
                     │       │    │        └ <starlette.datastructures.UploadFile object at 0x110ea4510>
                     │       │    └ <sqlalchemy.orm.session.AsyncSession object at 0x110e84590>
                     │       └ <function FileManager.save at 0x110d4d6c0>
                     └ <services.manager.FileManager object at 0x110ea7bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 29, in save
    await db.commit()
          │  └ <function AsyncSession.commit at 0x11077b9c0>
          └ <sqlalchemy.orm.session.AsyncSession object at 0x110e84590>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py", line 933, in commit
    await greenlet_spawn(self.sync_session.commit)
          │              │    │            └ <function Session.commit at 0x11069f2e0>
          │              │    └ <sqlalchemy.orm.session.Session object at 0x110ea7b50>
          │              └ <sqlalchemy.orm.session.AsyncSession object at 0x110e84590>
          └ <function greenlet_spawn at 0x1072f1f80>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x110ebcc80 (otid=0x107297360) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1899, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x11069e480>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
  File "<string>", line 2, in commit
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
                └ <function SessionTransaction.commit at 0x11069e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1218, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x11069e160>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
  File "<string>", line 2, in _prepare_impl
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
                └ <function SessionTransaction._prepare_impl at 0x11069e0c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1193, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x1106ae020>
    │    └ <sqlalchemy.orm.session.Session object at 0x110ea7b50>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4142, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x1106ae200>
    └ <sqlalchemy.orm.session.Session object at 0x110ea7b50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4277, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x110e6bac0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4238, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x11067ad40>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x110d6a350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x110d6a350>
    │   └ <function SaveUpdateAll.execute at 0x11067b880>
    └ SaveUpdateAll(Mapper[FileDbModel(files)])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x1105d2ca0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site...
    │    └ <module 'sqlalchemy.util.preloaded' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-...
    └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x110671d00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x1100d4b80>
             └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x110ee1510>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x1100d4ea0>
           └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x1100d5080>
          └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x1100d5120>
           └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x1100d53a0>
    └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)")
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.StringDat...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x11015fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1107dc210>
    └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1108d3c40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x110e7d240>
           └ <_AsyncIoGreenlet object at 0x110ebcc80 (otid=0x107297360) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x110e4b850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1108d3a60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ StringDataRightTruncationError('value too long for type character varying(10)')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ StringDataRightTruncationError('value too long for type character varying(10)')
          └ Error("<class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)")

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)
[SQL: INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'R3X8KnXQNH483A35zd6726', datetime.datetime(2023, 6, 21, 8, 26, 23, 624079))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
ERROR    2023-06-21 11:26:23.660 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 528, in _prepare_and_execute
    self._rows = await prepared_stmt.fetch(*parameters)
    │    │             │             │      └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │    │             │             └ <function PreparedStatement.fetch at 0x110ad0720>
    │    │             └ <asyncpg.prepared_stmt.PreparedStatement object at 0x110e61e90>
    │    └ <member '_rows' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py", line 176, in fetch
    data = await self.__bind_execute(args, 0, timeout)
                 │                   │        └ None
                 │                   └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
                 └ <asyncpg.prepared_stmt.PreparedStatement object at 0x110e61e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py", line 241, in __bind_execute
    data, status, _ = await self.__do_execute(
                            └ <asyncpg.prepared_stmt.PreparedStatement object at 0x110e61e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/asyncpg/prepared_stmt.py", line 230, in __do_execute
    return await executor(protocol)
                 │        └ <asyncpg.protocol.protocol.Protocol object at 0x110da1ff0>
                 └ <function PreparedStatement.__bind_execute.<locals>.<lambda> at 0x110ecf420>
  File "asyncpg/protocol/protocol.pyx", line 201, in bind_execute
    return await waiter

asyncpg.exceptions.StringDataRightTruncationError: value too long for type character varying(10)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x11015fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1107dc210>
    └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1108d3c40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x110e7d240>
           └ <_AsyncIoGreenlet object at 0x110ebcc80 (otid=0x107297360) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x110e4b850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1108d3a60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ StringDataRightTruncationError('value too long for type character varying(10)')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ StringDataRightTruncationError('value too long for type character varying(10)')
          └ Error("<class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)")

sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error: <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)


The above exception was the direct cause of the following exception:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102744ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102651a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102650fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x110dfa390>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>
    │    └ <function subprocess_started at 0x1048c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=13137 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x110dfb710>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1048abe20>
           │       │   └ <uvicorn.server.Server object at 0x110dfb710>
           │       └ <function run at 0x103169a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x110ddece0>
           │      └ <function Runner.run at 0x1031dd9e0>
           └ <asyncio.runners.Runner object at 0x104869410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1031d7600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x104869410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1031d7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1031dd3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10316a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110dfdbd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110e53390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110dfdbd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110e74310>
          └ <fastapi.applications.FastAPI object at 0x110e53390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x110e5d080>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110d51c50>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110e74310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110e74350>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110d51c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110e53450>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110e74350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1066f8720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110e5f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110ea32d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x110e5c7c0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110ea1910>
                     └ <function get_request_handler.<locals>.app at 0x110e5c860>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1066dac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'manager': <services.manager.FileManager object at 0x110ea7bd0>, 'db': <sqlalchemy.orm.session.AsyncSession object at 0x110e...
                 │         └ <function upload_file at 0x110af2b60>
                 └ <fastapi.dependencies.models.Dependant object at 0x110e68850>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 25, in upload_file
    document = await manager.save(db, file=file)
                     │       │    │        └ <starlette.datastructures.UploadFile object at 0x110ea4510>
                     │       │    └ <sqlalchemy.orm.session.AsyncSession object at 0x110e84590>
                     │       └ <function FileManager.save at 0x110d4d6c0>
                     └ <services.manager.FileManager object at 0x110ea7bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 29, in save
    await db.commit()
          │  └ <function AsyncSession.commit at 0x11077b9c0>
          └ <sqlalchemy.orm.session.AsyncSession object at 0x110e84590>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/ext/asyncio/session.py", line 933, in commit
    await greenlet_spawn(self.sync_session.commit)
          │              │    │            └ <function Session.commit at 0x11069f2e0>
          │              │    └ <sqlalchemy.orm.session.Session object at 0x110ea7b50>
          │              └ <sqlalchemy.orm.session.AsyncSession object at 0x110e84590>
          └ <function greenlet_spawn at 0x1072f1f80>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             │       │      └ None
             │       └ <method 'switch' of 'greenlet.greenlet' objects>
             └ <_AsyncIoGreenlet object at 0x110ebcc80 (otid=0x107297360) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1899, in commit
    trans.commit(_to_root=True)
    │     └ <function SessionTransaction.commit at 0x11069e480>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
  File "<string>", line 2, in commit
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {'_to_root': True}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
                └ <function SessionTransaction.commit at 0x11069e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1218, in commit
    self._prepare_impl()
    │    └ <function SessionTransaction._prepare_impl at 0x11069e160>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
  File "<string>", line 2, in _prepare_impl
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/state_changes.py", line 136, in _go
    ret_value = fn(self, *arg, **kw)
                │  │      │      └ {}
                │  │      └ ()
                │  └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
                └ <function SessionTransaction._prepare_impl at 0x11069e0c0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 1193, in _prepare_impl
    self.session.flush()
    │    │       └ <function Session.flush at 0x1106ae020>
    │    └ <sqlalchemy.orm.session.Session object at 0x110ea7b50>
    └ <sqlalchemy.orm.session.SessionTransaction object at 0x11085a2b0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4142, in flush
    self._flush(objects)
    │    │      └ None
    │    └ <function Session._flush at 0x1106ae200>
    └ <sqlalchemy.orm.session.Session object at 0x110ea7b50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4277, in _flush
    with util.safe_reraise():
         │    └ <class 'sqlalchemy.util.langhelpers.safe_reraise'>
         └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py", line 147, in __exit__
    raise exc_value.with_traceback(exc_tb)
          │         │              └ <traceback object at 0x110e6bac0>
          │         └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/session.py", line 4238, in _flush
    flush_context.execute()
    │             └ <function UOWTransaction.execute at 0x11067ad40>
    └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x110d6a350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
    │   │       └ <sqlalchemy.orm.unitofwork.UOWTransaction object at 0x110d6a350>
    │   └ <function SaveUpdateAll.execute at 0x11067b880>
    └ SaveUpdateAll(Mapper[FileDbModel(files)])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
    │    │         │               └ <function save_obj at 0x1105d2ca0>
    │    │         └ <module 'sqlalchemy.orm.persistence' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site...
    │    └ <module 'sqlalchemy.util.preloaded' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-...
    └ <module 'sqlalchemy.util' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/s...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
    └ <function _emit_insert_statements at 0x110671d00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/orm/persistence.py", line 1226, in _emit_insert_statements
    result = connection.execute(
             │          └ <function Connection.execute at 0x1100d4b80>
             └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1412, in execute
    return meth(
           └ <bound method ClauseElement._execute_on_connection of <sqlalchemy.sql.dml.Insert object at 0x110ee1510>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/sql/elements.py", line 483, in _execute_on_connection
    return connection._execute_clauseelement(
           │          └ <function Connection._execute_clauseelement at 0x1100d4ea0>
           └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1635, in _execute_clauseelement
    ret = self._execute_context(
          │    └ <function Connection._execute_context at 0x1100d5080>
          └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1844, in _execute_context
    return self._exec_single_context(
           │    └ <function Connection._exec_single_context at 0x1100d5120>
           └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1984, in _exec_single_context
    self._handle_dbapi_exception(
    │    └ <function Connection._handle_dbapi_exception at 0x1100d53a0>
    └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 2339, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
          │                    │              │                 └ Error("<class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)")
          │                    │              └ (<class 'sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_dbapi.Error'>, Error("<class 'asyncpg.exceptions.StringDat...
          │                    └ <method 'with_traceback' of 'BaseException' objects>
          └ DBAPIError("(sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/base.py", line 1965, in _exec_single_context
    self.dialect.do_execute(
    │    │       └ <function DefaultDialect.do_execute at 0x11015fa60>
    │    └ <sqlalchemy.dialects.postgresql.asyncpg.PGDialect_asyncpg object at 0x1107dc210>
    └ <sqlalchemy.engine.base.Connection object at 0x110ee1ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/engine/default.py", line 921, in do_execute
    cursor.execute(statement, parameters)
    │      │       │          └ (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Phot...
    │      │       └ 'INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3...
    │      └ <function AsyncAdapt_asyncpg_cursor.execute at 0x1108d3c40>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 561, in execute
    self._adapt_connection.await_(
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           │                     └ <coroutine object AsyncAdapt_asyncpg_cursor._prepare_and_execute at 0x110e7d240>
           └ <_AsyncIoGreenlet object at 0x110ebcc80 (otid=0x107297360) dead>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/util/_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
                  └ <coroutine object Transaction.rollback at 0x110e4b850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 540, in _prepare_and_execute
    self._handle_exception(error)
    │    └ <function AsyncAdapt_asyncpg_cursor._handle_exception at 0x1108d3a60>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 491, in _handle_exception
    self._adapt_connection._handle_exception(error)
    │    │                                   └ StringDataRightTruncationError('value too long for type character varying(10)')
    │    └ <member '_adapt_connection' of 'AsyncAdapt_asyncpg_cursor' objects>
    └ <sqlalchemy.dialects.postgresql.asyncpg.AsyncAdapt_asyncpg_cursor object at 0x110eaab60>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/sqlalchemy/dialects/postgresql/asyncpg.py", line 778, in _handle_exception
    raise translated_error from error
          │                     └ StringDataRightTruncationError('value too long for type character varying(10)')
          └ Error("<class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)")

sqlalchemy.exc.DBAPIError: (sqlalchemy.dialects.postgresql.asyncpg.Error) <class 'asyncpg.exceptions.StringDataRightTruncationError'>: value too long for type character varying(10)
[SQL: INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)]
[parameters: (UUID('c8882448-ee7e-4b19-984d-76bc314e80ba'), 'R3X8KnXQNH483A35zd6726/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'R3X8KnXQNH483A35zd6726', datetime.datetime(2023, 6, 21, 8, 26, 23, 624079))]
(Background on this error at: https://sqlalche.me/e/20/dbapi)
INFO     2023-06-21 11:26:46.426 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:26:46.427 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:26:46.528 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:26:46.529 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:26:46.529 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:26:46.530 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:26:46.530 request id: app - logging:callHandlers - Finished server process [13139]
INFO     2023-06-21 11:26:46.530 request id: app - logging:callHandlers - Finished server process [13139]
INFO     2023-06-21 11:26:47.159 request id: app - logging:callHandlers - Started server process [13188]
INFO     2023-06-21 11:26:47.159 request id: app - logging:callHandlers - Started server process [13188]
INFO     2023-06-21 11:26:47.159 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:26:47.159 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:26:47.213 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:26:47.213 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:47.216 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:26:47.217 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:47.220 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:26:47.220 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:47.223 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:26:47.225 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:26:47.226 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:26:47.230 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:26:47.231 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:26:47.231 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:26:54.319 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:26:54.321 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:26:54.422 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:26:54.423 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:26:54.424 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:26:54.424 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:26:54.424 request id: app - logging:callHandlers - Finished server process [13188]
INFO     2023-06-21 11:26:54.425 request id: app - logging:callHandlers - Finished server process [13188]
INFO     2023-06-21 11:26:56.239 request id: app - logging:callHandlers - Started server process [13216]
INFO     2023-06-21 11:26:56.239 request id: app - logging:callHandlers - Started server process [13216]
INFO     2023-06-21 11:26:56.240 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:26:56.240 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:26:56.304 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:26:56.304 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:56.307 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:26:56.308 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:56.310 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:26:56.311 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:26:56.312 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:26:56.315 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:26:56.315 request id: app - logging:callHandlers - [generated in 0.00026s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:26:56.319 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:26:56.320 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:26:56.320 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:27:00.877 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:27:00.878 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:27:00.980 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:27:00.980 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:27:00.981 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:27:00.981 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:27:00.981 request id: app - logging:callHandlers - Finished server process [13216]
INFO     2023-06-21 11:27:00.981 request id: app - logging:callHandlers - Finished server process [13216]
INFO     2023-06-21 11:27:09.221 request id: app - logging:callHandlers - Started server process [13244]
INFO     2023-06-21 11:27:09.221 request id: app - logging:callHandlers - Started server process [13244]
INFO     2023-06-21 11:27:09.222 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:27:09.222 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:27:09.277 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:27:09.277 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:27:09.281 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:27:09.282 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:27:09.285 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:27:09.285 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:27:09.287 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:27:09.289 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:27:09.289 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:27:09.292 request id: app - logging:callHandlers - 
CREATE TABLE files (
	id UUID NOT NULL, 
	path_in_storage VARCHAR(255) NOT NULL, 
	filename VARCHAR(255) NOT NULL, 
	size INTEGER NOT NULL, 
	file_type VARCHAR(100) NOT NULL, 
	short_name VARCHAR(24) NOT NULL, 
	created_at TIMESTAMP WITHOUT TIME ZONE, 
	PRIMARY KEY (id), 
	UNIQUE (path_in_storage), 
	UNIQUE (short_name)
)


INFO     2023-06-21 11:27:09.293 request id: app - logging:callHandlers - [no key 0.00025s] ()
INFO     2023-06-21 11:27:09.304 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:27:09.306 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:27:09.307 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:27:16.190 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:27:16.191 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 11:27:16.192 request id: app - logging:callHandlers - [generated in 0.00075s] (UUID('dd437eab-5d49-48dd-a846-171ca04ad362'), 'SHKdGPcg4Fwaro93qwyozr/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'SHKdGPcg4Fwaro93qwyozr', datetime.datetime(2023, 6, 21, 8, 27, 16, 191661))
INFO     2023-06-21 11:27:16.214 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:27:16.225 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:27:16.227 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.id = $1::UUID
INFO     2023-06-21 11:27:16.227 request id: app - logging:callHandlers - [generated in 0.00060s] (UUID('dd437eab-5d49-48dd-a846-171ca04ad362'),)
INFO     2023-06-21 11:27:16.233 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:27:16.235 request id: app - logging:callHandlers - 127.0.0.1:57356 - "POST /api/v1/ HTTP/1.1" 500
ERROR    2023-06-21 11:27:16.235 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1052d8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1051e5a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1051e4fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x110bea650>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>
    │    └ <function subprocess_started at 0x1061ace00>
    └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x110beb950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x106197e20>
           │       │   └ <uvicorn.server.Server object at 0x110beb950>
           │       └ <function run at 0x105cfda80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x110bcece0>
           │      └ <function Runner.run at 0x105d719e0>
           └ <asyncio.runners.Runner object at 0x1108ad4d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105d6b600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1108ad4d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105d6b560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105d713a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105cfe340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110becf10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110c43390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110becf10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110c5b890>
          └ <fastapi.applications.FastAPI object at 0x110c43390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x110c4f600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110b59550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110c5b890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110c5b810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110b59550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110c43490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110c5b810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106e44720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x110c4c7c0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110c5b790>
                     └ <function get_request_handler.<locals>.app at 0x110c4c860>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 259, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x106e268e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 145, in serialize_response
    raise ValidationError(errors, field.type_)
          │               │       │     └ <member 'type_' of 'ModelField' objects>
          │               │       └ ModelField(name='Response_upload_file_api_v1__post', type=FileResponse, required=True)
          │               └ [ErrorWrapper(exc=ValidationError(model='FileResponse', errors=[{'loc': ('type',), 'msg': 'field required', 'type': 'value_er...
          └ <class 'pydantic.error_wrappers.ValidationError'>

pydantic.error_wrappers.ValidationError: 1 validation error for FileResponse
response -> type
  field required (type=value_error.missing)
ERROR    2023-06-21 11:27:16.245 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1052d8ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1051e5a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1051e4fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x110bea650>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>
    │    └ <function subprocess_started at 0x1061ace00>
    └ <SpawnProcess name='SpawnProcess-1' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x110beb950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x106197e20>
           │       │   └ <uvicorn.server.Server object at 0x110beb950>
           │       └ <function run at 0x105cfda80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x110bcece0>
           │      └ <function Runner.run at 0x105d719e0>
           └ <asyncio.runners.Runner object at 0x1108ad4d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105d6b600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1108ad4d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105d6b560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105d713a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105cfe340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110becf10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110c43390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110becf10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110c5b890>
          └ <fastapi.applications.FastAPI object at 0x110c43390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x110c4f600>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110b59550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110c5b890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110c5b810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x110b59550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110c43490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110c5b810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106e44720>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x110c4f6a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110c86610>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x110c4c7c0>
          └ APIRoute(path='/api/v1/', name='upload_file', methods=['POST'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110c5b790>
                     └ <function get_request_handler.<locals>.app at 0x110c4c860>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 259, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x106e268e0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 145, in serialize_response
    raise ValidationError(errors, field.type_)
          │               │       │     └ <member 'type_' of 'ModelField' objects>
          │               │       └ ModelField(name='Response_upload_file_api_v1__post', type=FileResponse, required=True)
          │               └ [ErrorWrapper(exc=ValidationError(model='FileResponse', errors=[{'loc': ('type',), 'msg': 'field required', 'type': 'value_er...
          └ <class 'pydantic.error_wrappers.ValidationError'>

pydantic.error_wrappers.ValidationError: 1 validation error for FileResponse
response -> type
  field required (type=value_error.missing)
INFO     2023-06-21 11:27:54.664 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:27:54.665 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:27:54.766 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:27:54.767 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:27:54.767 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:27:54.768 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:27:54.768 request id: app - logging:callHandlers - Finished server process [13244]
INFO     2023-06-21 11:27:54.768 request id: app - logging:callHandlers - Finished server process [13244]
INFO     2023-06-21 11:27:55.404 request id: app - logging:callHandlers - Started server process [13320]
INFO     2023-06-21 11:27:55.405 request id: app - logging:callHandlers - Started server process [13320]
INFO     2023-06-21 11:27:55.405 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:27:55.405 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:27:55.483 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:27:55.483 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:27:55.486 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:27:55.487 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:27:55.490 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:27:55.490 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:27:55.493 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:27:55.495 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:27:55.495 request id: app - logging:callHandlers - [generated in 0.00031s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:27:55.501 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:27:55.502 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:27:55.503 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:27:59.712 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:27:59.718 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 11:27:59.719 request id: app - logging:callHandlers - [generated in 0.00081s] (UUID('b33aeb63-e3de-40eb-b1c5-3921464a1692'), 'kJPhHDbUiUh62MAcaBDZ8o/Adobe Photoshop 2023 v24.4.1.dmg.torrent', 'Adobe Photoshop 2023 v24.4.1.dmg.torrent', 40768, 'application/x-bittorrent', 'kJPhHDbUiUh62MAcaBDZ8o', datetime.datetime(2023, 6, 21, 8, 27, 59, 718482))
INFO     2023-06-21 11:27:59.749 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:27:59.755 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:27:59.758 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.id = $1::UUID
INFO     2023-06-21 11:27:59.759 request id: app - logging:callHandlers - [generated in 0.00073s] (UUID('b33aeb63-e3de-40eb-b1c5-3921464a1692'),)
INFO     2023-06-21 11:27:59.764 request id: app - logging:callHandlers - 127.0.0.1:57396 - "POST /api/v1/ HTTP/1.1" 200
INFO     2023-06-21 11:27:59.765 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:30:35.656 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:30:35.657 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:30:35.759 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:30:35.759 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:30:35.760 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:30:35.760 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:30:35.760 request id: app - logging:callHandlers - Finished server process [13320]
INFO     2023-06-21 11:30:35.760 request id: app - logging:callHandlers - Finished server process [13320]
INFO     2023-06-21 11:30:36.436 request id: app - logging:callHandlers - Started server process [13565]
INFO     2023-06-21 11:30:36.436 request id: app - logging:callHandlers - Started server process [13565]
INFO     2023-06-21 11:30:36.436 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:30:36.436 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:30:36.501 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:30:36.501 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:30:36.504 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:30:36.504 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:30:36.507 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:30:36.507 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:30:36.510 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:30:36.512 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:30:36.512 request id: app - logging:callHandlers - [generated in 0.00030s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:30:36.518 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:30:36.519 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:30:36.519 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:35:25.525 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:35:25.526 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:35:25.627 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:35:25.628 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:35:25.647 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:35:25.647 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:35:25.647 request id: app - logging:callHandlers - Finished server process [13565]
INFO     2023-06-21 11:35:25.648 request id: app - logging:callHandlers - Finished server process [13565]
INFO     2023-06-21 11:35:26.414 request id: app - logging:callHandlers - Started server process [14044]
INFO     2023-06-21 11:35:26.415 request id: app - logging:callHandlers - Started server process [14044]
INFO     2023-06-21 11:35:26.415 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:35:26.415 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:35:26.491 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:35:26.492 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:35:26.521 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:35:26.521 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:35:26.541 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:35:26.542 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:35:26.557 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:35:26.561 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:35:26.561 request id: app - logging:callHandlers - [generated in 0.00063s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:35:26.576 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:35:26.580 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:35:26.580 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:45:42.603 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:45:42.604 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:45:42.705 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:45:42.706 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:45:42.707 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:45:42.707 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:45:42.707 request id: app - logging:callHandlers - Finished server process [14044]
INFO     2023-06-21 11:45:42.707 request id: app - logging:callHandlers - Finished server process [14044]
INFO     2023-06-21 11:45:57.590 request id: app - logging:callHandlers - Started server process [15213]
INFO     2023-06-21 11:45:57.590 request id: app - logging:callHandlers - Started server process [15213]
INFO     2023-06-21 11:45:57.590 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:45:57.590 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:45:57.676 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:45:57.676 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:45:57.679 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:45:57.679 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:45:57.682 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:45:57.683 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:45:57.685 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:45:57.687 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:45:57.687 request id: app - logging:callHandlers - [generated in 0.00025s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:45:57.692 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:45:57.693 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:45:57.693 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:46:01.876 request id: app - logging:callHandlers - 127.0.0.1:58221 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 11:46:02.047 request id: app - logging:callHandlers - 127.0.0.1:58221 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 11:46:20.172 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:46:20.176 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:46:20.177 request id: app - logging:callHandlers - [generated in 0.00066s] ('T5XBgZa2oPDtTKuNMkHMXK',)
INFO     2023-06-21 11:46:20.206 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:46:20.208 request id: app - logging:callHandlers - 127.0.0.1:58222 - "GET /api/v1/download/T5XBgZa2oPDtTKuNMkHMXK HTTP/1.1" 404
INFO     2023-06-21 11:46:50.363 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:46:50.364 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:46:50.365 request id: app - logging:callHandlers - [cached since 30.19s ago] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:46:50.379 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:46:50.382 request id: app - logging:callHandlers - 127.0.0.1:58272 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 500
ERROR    2023-06-21 11:46:50.383 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104a1cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104929a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104928fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1228ec5d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>
    │    └ <function subprocess_started at 0x1072dce00>
    └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1228ed950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1072c7e20>
           │       │   └ <uvicorn.server.Server object at 0x1228ed950>
           │       └ <function run at 0x105541a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1228d3010>
           │      └ <function Runner.run at 0x1055b59e0>
           └ <asyncio.runners.Runner object at 0x107285410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055af600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x107285410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055af560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1055b53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105542340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1228efe90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x12294d350>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1228efe90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1229677d0>
          └ <fastapi.applications.FastAPI object at 0x12294d350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1229c3560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x122966c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1229677d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x122965fd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x122966c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x12294d410>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x122965fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x120ab8720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x122950ea0>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1229d45d0>
                     └ <function get_request_handler.<locals>.app at 0x122950e00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x120a9ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1229d4c50>, 'manager': <services.manager.FileManager object at 0x1228...
                 │         └ <function get_file at 0x12283e480>
                 └ <fastapi.dependencies.models.Dependant object at 0x122964810>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1229d4c50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x12283e020>
                 └ <services.manager.FileManager object at 0x12285a050>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 44, in get_file_by_short_uuid_full_download
    bucket=settings.ext_storage_documents_bucket_name, path=file.path_in_storage
           │                                                │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x12283d3a0>
           │                                                └ <unprintable FileDbModel object>
           └ Settings(debug_mode=True, project_name='movies', project_description='movies', minio_access_key='V80gfGSdqtFMJ7LWtgWc', minio...

AttributeError: 'Settings' object has no attribute 'ext_storage_documents_bucket_name'
ERROR    2023-06-21 11:46:50.403 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104a1cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104929a80>
           └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104928fe0>
    └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1228ec5d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>
    │    └ <function subprocess_started at 0x1072dce00>
    └ <SpawnProcess name='SpawnProcess-6' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1228ed950>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1072c7e20>
           │       │   └ <uvicorn.server.Server object at 0x1228ed950>
           │       └ <function run at 0x105541a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1228d3010>
           │      └ <function Runner.run at 0x1055b59e0>
           └ <asyncio.runners.Runner object at 0x107285410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1055af600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x107285410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1055af560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1055b53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105542340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1228efe90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x12294d350>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1228efe90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1229677d0>
          └ <fastapi.applications.FastAPI object at 0x12294d350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1229c3560>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x122966c10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1229677d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x122965fd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x122966c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x12294d410>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x122965fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x120ab8720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1229c3880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1229c67d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x122950ea0>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1229d45d0>
                     └ <function get_request_handler.<locals>.app at 0x122950e00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x120a9ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1229d4c50>, 'manager': <services.manager.FileManager object at 0x1228...
                 │         └ <function get_file at 0x12283e480>
                 └ <fastapi.dependencies.models.Dependant object at 0x122964810>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1229d4c50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x12283e020>
                 └ <services.manager.FileManager object at 0x12285a050>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 44, in get_file_by_short_uuid_full_download
    bucket=settings.ext_storage_documents_bucket_name, path=file.path_in_storage
           │                                                │    └ <sqlalchemy.orm.attributes.InstrumentedAttribute object at 0x12283d3a0>
           │                                                └ <unprintable FileDbModel object>
           └ Settings(debug_mode=True, project_name='movies', project_description='movies', minio_access_key='V80gfGSdqtFMJ7LWtgWc', minio...

AttributeError: 'Settings' object has no attribute 'ext_storage_documents_bucket_name'
INFO     2023-06-21 11:47:08.026 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:47:08.027 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:47:08.128 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:47:08.129 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:47:08.130 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:47:08.130 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:47:08.130 request id: app - logging:callHandlers - Finished server process [15213]
INFO     2023-06-21 11:47:08.130 request id: app - logging:callHandlers - Finished server process [15213]
INFO     2023-06-21 11:47:08.728 request id: app - logging:callHandlers - Started server process [15331]
INFO     2023-06-21 11:47:08.729 request id: app - logging:callHandlers - Started server process [15331]
INFO     2023-06-21 11:47:08.729 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:47:08.729 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:47:08.785 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:47:08.785 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:47:08.787 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:47:08.788 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:47:08.790 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:47:08.790 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:47:08.792 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:47:08.794 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:47:08.794 request id: app - logging:callHandlers - [generated in 0.00033s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:47:08.799 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:47:08.800 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:47:08.800 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:47:11.049 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:47:11.051 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:47:11.051 request id: app - logging:callHandlers - [generated in 0.00030s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:47:11.063 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:47:11.065 request id: app - logging:callHandlers - 127.0.0.1:58275 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 500
INFO     2023-06-21 11:48:18.162 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:48:18.163 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:48:18.265 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:48:18.265 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:48:18.266 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:48:18.266 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:48:18.267 request id: app - logging:callHandlers - Finished server process [15331]
INFO     2023-06-21 11:48:18.267 request id: app - logging:callHandlers - Finished server process [15331]
INFO     2023-06-21 11:48:19.010 request id: app - logging:callHandlers - Started server process [15459]
INFO     2023-06-21 11:48:19.010 request id: app - logging:callHandlers - Started server process [15459]
INFO     2023-06-21 11:48:19.011 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:48:19.011 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:48:19.069 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:48:19.069 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:48:19.072 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:48:19.073 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:48:19.076 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:48:19.076 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:48:19.079 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:48:19.081 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:48:19.081 request id: app - logging:callHandlers - [generated in 0.00025s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:48:19.086 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:48:19.087 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:48:19.087 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:48:21.779 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:48:21.784 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:48:21.786 request id: app - logging:callHandlers - [generated in 0.00227s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:48:21.799 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:48:21.801 request id: app - logging:callHandlers - 127.0.0.1:58298 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 404
INFO     2023-06-21 11:48:58.985 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:48:58.988 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:48:58.989 request id: app - logging:callHandlers - [cached since 37.21s ago] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:48:59.017 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:48:59.019 request id: app - logging:callHandlers - 127.0.0.1:58304 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 404
INFO     2023-06-21 11:50:40.951 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:50:40.952 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:50:41.054 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:50:41.054 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:50:41.055 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:50:41.055 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:50:41.055 request id: app - logging:callHandlers - Finished server process [15459]
INFO     2023-06-21 11:50:41.055 request id: app - logging:callHandlers - Finished server process [15459]
INFO     2023-06-21 11:50:41.734 request id: app - logging:callHandlers - Started server process [15677]
INFO     2023-06-21 11:50:41.734 request id: app - logging:callHandlers - Started server process [15677]
INFO     2023-06-21 11:50:41.734 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:50:41.734 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:50:41.802 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:50:41.802 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:50:41.806 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:50:41.806 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:50:41.809 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:50:41.809 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:50:41.811 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:50:41.813 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:50:41.814 request id: app - logging:callHandlers - [generated in 0.00033s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:50:41.819 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:50:41.820 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:50:41.820 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:50:43.380 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:50:43.384 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:50:43.385 request id: app - logging:callHandlers - [generated in 0.00090s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:50:43.399 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:50:43.402 request id: app - logging:callHandlers - 127.0.0.1:58374 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 404
INFO     2023-06-21 11:55:21.093 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:55:21.094 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:55:21.195 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:55:21.195 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:55:21.196 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:55:21.196 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:55:21.197 request id: app - logging:callHandlers - Finished server process [15677]
INFO     2023-06-21 11:55:21.197 request id: app - logging:callHandlers - Finished server process [15677]
INFO     2023-06-21 11:55:21.983 request id: app - logging:callHandlers - Started server process [16121]
INFO     2023-06-21 11:55:21.984 request id: app - logging:callHandlers - Started server process [16121]
INFO     2023-06-21 11:55:21.984 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:55:21.984 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:55:22.116 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:55:22.116 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:55:22.123 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:55:22.123 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:55:22.131 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:55:22.132 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:55:22.134 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:55:22.136 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:55:22.136 request id: app - logging:callHandlers - [generated in 0.00031s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:55:22.141 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:55:22.142 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:55:22.142 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:55:25.949 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:55:25.953 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:55:25.953 request id: app - logging:callHandlers - [generated in 0.00054s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:55:25.983 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:55:25.995 request id: app - logging:callHandlers - 127.0.0.1:58473 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 500
ERROR    2023-06-21 11:55:25.995 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 35, in get_object_by_path
    result = await self.client.get_object(bucket, path)
                   │    │      │          │       └ 'kJPhHDbUiUh62MAcaBDZ8o/Adobe Photoshop 2023 v24.4.1.dmg.torrent'
                   │    │      │          └ 'files'
                   │    │      └ <function Minio.get_object at 0x1058e2020>
                   │    └ <miniopy_async.api.Minio object at 0x107563cd0>
                   └ <services.minio_storage.MinioStorage object at 0x107570410>

TypeError: Minio.get_object() missing 1 required positional argument: 'session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 39, in get_object_by_path
    raise HTTPException(detail='Error while getting the file', status_code=status.HTTP_404_NOT_FOUND)
          │                                                                │      └ 404
          │                                                                └ <module 'starlette.status' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/...
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100ff0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100de5a80>
           └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100de4fe0>
    └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1074eccd0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>
    │    └ <function subprocess_started at 0x101dc0e00>
    └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070a5fd0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101dabe20>
           │       │   └ <uvicorn.server.Server object at 0x1070a5fd0>
           │       └ <function run at 0x101a31a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1074d3010>
           │      └ <function Runner.run at 0x101aa59e0>
           └ <asyncio.runners.Runner object at 0x1074708d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101a9f600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1074708d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101a9f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101aa53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101a32340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1074ef490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10754d590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1074ef490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107462510>
          └ <fastapi.applications.FastAPI object at 0x10754d590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107557880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1016ec8d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107462510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075618d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1016ec8d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10754d690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075618d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x103d44720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107554d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1065cc390>
                     └ <function get_request_handler.<locals>.app at 0x107554cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x103d26c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x107462c50>, 'manager': <services.manager.FileManager object at 0x1074...
                 │         └ <function get_file at 0x10743e340>
                 └ <fastapi.dependencies.models.Dependant object at 0x107560b10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x107462c50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10743df80>
                 └ <services.manager.FileManager object at 0x107462290>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 43, in get_file_by_short_uuid_full_download
    result = await self.storage.get_object_by_path(
                   │    │       └ <function MinioStorage.get_object_by_path at 0x10743dd00>
                   │    └ <services.minio_storage.MinioStorage object at 0x107570410>
                   └ <services.manager.FileManager object at 0x107462290>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 41, in get_object_by_path
    result.close()

UnboundLocalError: cannot access local variable 'result' where it is not associated with a value
ERROR    2023-06-21 11:55:26.010 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 35, in get_object_by_path
    result = await self.client.get_object(bucket, path)
                   │    │      │          │       └ 'kJPhHDbUiUh62MAcaBDZ8o/Adobe Photoshop 2023 v24.4.1.dmg.torrent'
                   │    │      │          └ 'files'
                   │    │      └ <function Minio.get_object at 0x1058e2020>
                   │    └ <miniopy_async.api.Minio object at 0x107563cd0>
                   └ <services.minio_storage.MinioStorage object at 0x107570410>

TypeError: Minio.get_object() missing 1 required positional argument: 'session'


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 39, in get_object_by_path
    raise HTTPException(detail='Error while getting the file', status_code=status.HTTP_404_NOT_FOUND)
          │                                                                │      └ 404
          │                                                                └ <module 'starlette.status' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/...
          └ <class 'fastapi.exceptions.HTTPException'>

fastapi.exceptions.HTTPException


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100ff0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100de5a80>
           └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100de4fe0>
    └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1074eccd0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>
    │    └ <function subprocess_started at 0x101dc0e00>
    └ <SpawnProcess name='SpawnProcess-10' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070a5fd0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101dabe20>
           │       │   └ <uvicorn.server.Server object at 0x1070a5fd0>
           │       └ <function run at 0x101a31a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1074d3010>
           │      └ <function Runner.run at 0x101aa59e0>
           └ <asyncio.runners.Runner object at 0x1074708d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x101a9f600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1074708d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101a9f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101aa53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101a32340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1074ef490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10754d590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1074ef490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107462510>
          └ <fastapi.applications.FastAPI object at 0x10754d590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107557880>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1016ec8d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107462510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075618d0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1016ec8d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10754d690>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1075618d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x103d44720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1075579c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107583ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107554d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1065cc390>
                     └ <function get_request_handler.<locals>.app at 0x107554cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x103d26c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x107462c50>, 'manager': <services.manager.FileManager object at 0x1074...
                 │         └ <function get_file at 0x10743e340>
                 └ <fastapi.dependencies.models.Dependant object at 0x107560b10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x107462c50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10743df80>
                 └ <services.manager.FileManager object at 0x107462290>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 43, in get_file_by_short_uuid_full_download
    result = await self.storage.get_object_by_path(
                   │    │       └ <function MinioStorage.get_object_by_path at 0x10743dd00>
                   │    └ <services.minio_storage.MinioStorage object at 0x107570410>
                   └ <services.manager.FileManager object at 0x107462290>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/minio_storage.py", line 41, in get_object_by_path
    result.close()

UnboundLocalError: cannot access local variable 'result' where it is not associated with a value
INFO     2023-06-21 11:56:10.909 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:56:10.910 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:56:11.012 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:56:11.012 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:56:11.013 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:56:11.013 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:56:11.013 request id: app - logging:callHandlers - Finished server process [16121]
INFO     2023-06-21 11:56:11.014 request id: app - logging:callHandlers - Finished server process [16121]
INFO     2023-06-21 11:56:11.753 request id: app - logging:callHandlers - Started server process [16203]
INFO     2023-06-21 11:56:11.754 request id: app - logging:callHandlers - Started server process [16203]
INFO     2023-06-21 11:56:11.754 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:56:11.754 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:56:11.825 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:56:11.825 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:56:11.829 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:56:11.829 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:56:11.832 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:56:11.832 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:56:11.835 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:56:11.837 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:56:11.837 request id: app - logging:callHandlers - [generated in 0.00029s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:56:11.842 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:56:11.844 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:56:11.845 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:56:13.836 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:56:13.841 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:56:13.841 request id: app - logging:callHandlers - [generated in 0.00088s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:56:13.917 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:56:13.922 request id: app - logging:callHandlers - 127.0.0.1:58516 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 500
ERROR    2023-06-21 11:56:13.922 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1006acae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1005b9a80>
           └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1005b8fe0>
    └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1047ec050>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>
    │    └ <function subprocess_started at 0x101580e00>
    └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1047ed390>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10156be20>
           │       │   └ <uvicorn.server.Server object at 0x1047ed390>
           │       └ <function run at 0x1010d1a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1047cf010>
           │      └ <function Runner.run at 0x1011459e0>
           └ <asyncio.runners.Runner object at 0x10475e610>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10113f600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10475e610>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10113f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1011453a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010d2340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1047fcb50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104848cd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1047fcb50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104867490>
          └ <fastapi.applications.FastAPI object at 0x104848cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104853920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104866590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104867490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104866810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104866590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x104848dd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104866810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102b48720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x104850d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10488d310>
                     └ <function get_request_handler.<locals>.app at 0x104850cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102b2ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x10488d110>, 'manager': <services.manager.FileManager object at 0x1048...
                 │         └ <function get_file at 0x10473e340>
                 └ <fastapi.dependencies.models.Dependant object at 0x10484bf90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x10488d110>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10473df80>
                 └ <services.manager.FileManager object at 0x104866010>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x10306bba0>
                     │      └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>
                     └ <ClientResponse(http://localhost:9000/files/kJPhHDbUiUh62MAcaBDZ8o/Adobe%20Photoshop%202023%20v24.4.1.dmg.torrent) [200 OK]>
                       ...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 349, in read
    raise self._exception
          │    └ ClientConnectionError('Connection closed')
          └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>

aiohttp.client_exceptions.ClientConnectionError: Connection closed
ERROR    2023-06-21 11:56:13.934 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1006acae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1005b9a80>
           └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1005b8fe0>
    └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1047ec050>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>
    │    └ <function subprocess_started at 0x101580e00>
    └ <SpawnProcess name='SpawnProcess-11' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1047ed390>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10156be20>
           │       │   └ <uvicorn.server.Server object at 0x1047ed390>
           │       └ <function run at 0x1010d1a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x1047cf010>
           │      └ <function Runner.run at 0x1011459e0>
           └ <asyncio.runners.Runner object at 0x10475e610>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x10113f600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10475e610>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10113f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1011453a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1010d2340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1047fcb50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x104848cd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1047fcb50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104867490>
          └ <fastapi.applications.FastAPI object at 0x104848cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104853920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104866590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104867490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104866810>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x104866590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x104848dd0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104866810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102b48720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104867810>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x104850d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10488d310>
                     └ <function get_request_handler.<locals>.app at 0x104850cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102b2ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x10488d110>, 'manager': <services.manager.FileManager object at 0x1048...
                 │         └ <function get_file at 0x10473e340>
                 └ <fastapi.dependencies.models.Dependant object at 0x10484bf90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x10488d110>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10473df80>
                 └ <services.manager.FileManager object at 0x104866010>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x10306bba0>
                     │      └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>
                     └ <ClientResponse(http://localhost:9000/files/kJPhHDbUiUh62MAcaBDZ8o/Adobe%20Photoshop%202023%20v24.4.1.dmg.torrent) [200 OK]>
                       ...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 349, in read
    raise self._exception
          │    └ ClientConnectionError('Connection closed')
          └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>

aiohttp.client_exceptions.ClientConnectionError: Connection closed
INFO     2023-06-21 11:56:51.013 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:56:51.013 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:56:51.115 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:56:51.115 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:56:51.116 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:56:51.116 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:56:51.116 request id: app - logging:callHandlers - Finished server process [16203]
INFO     2023-06-21 11:56:51.116 request id: app - logging:callHandlers - Finished server process [16203]
INFO     2023-06-21 11:56:51.728 request id: app - logging:callHandlers - Started server process [16275]
INFO     2023-06-21 11:56:51.728 request id: app - logging:callHandlers - Started server process [16275]
INFO     2023-06-21 11:56:51.728 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:56:51.728 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:56:51.790 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:56:51.790 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:56:51.794 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:56:51.794 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:56:51.796 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:56:51.797 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:56:51.801 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:56:51.803 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:56:51.803 request id: app - logging:callHandlers - [generated in 0.00024s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:56:51.808 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:56:51.809 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:56:51.810 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:56:54.529 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:56:54.532 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:56:54.532 request id: app - logging:callHandlers - [generated in 0.00032s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:56:54.569 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:56:54.574 request id: app - logging:callHandlers - 127.0.0.1:58532 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 500
ERROR    2023-06-21 11:56:54.575 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1045fcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104509a80>
           └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104508fe0>
    └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1147b0610>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>
    │    └ <function subprocess_started at 0x106720e00>
    └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1147b1990>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10670be20>
           │       │   └ <uvicorn.server.Server object at 0x1147b1990>
           │       └ <function run at 0x106271a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x114797010>
           │      └ <function Runner.run at 0x1062e59e0>
           └ <asyncio.runners.Runner object at 0x1066c9410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1062df600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1066c9410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1062df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1062e53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106272340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11466b190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x11494d250>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11466b190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x114669210>
          └ <fastapi.applications.FastAPI object at 0x11494d250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x114953920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x114963650>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x114669210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x114963610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x114963650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x11494d350>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x114963610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107f30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x114950d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x114983cd0>
                     └ <function get_request_handler.<locals>.app at 0x114950cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107f12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x11479e890>, 'manager': <services.manager.FileManager object at 0x1149...
                 │         └ <function get_file at 0x114702340>
                 └ <fastapi.dependencies.models.Dependant object at 0x114960890>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x11479e890>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x114701f80>
                 └ <services.manager.FileManager object at 0x114971610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x111503ba0>
                     │      └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>
                     └ <ClientResponse(http://localhost:9000/files/kJPhHDbUiUh62MAcaBDZ8o/Adobe%20Photoshop%202023%20v24.4.1.dmg.torrent) [200 OK]>
                       ...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 349, in read
    raise self._exception
          │    └ ClientConnectionError('Connection closed')
          └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>

aiohttp.client_exceptions.ClientConnectionError: Connection closed
ERROR    2023-06-21 11:56:54.591 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1045fcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104509a80>
           └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104508fe0>
    └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1147b0610>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>
    │    └ <function subprocess_started at 0x106720e00>
    └ <SpawnProcess name='SpawnProcess-12' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1147b1990>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x10670be20>
           │       │   └ <uvicorn.server.Server object at 0x1147b1990>
           │       └ <function run at 0x106271a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x114797010>
           │      └ <function Runner.run at 0x1062e59e0>
           └ <asyncio.runners.Runner object at 0x1066c9410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1062df600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1066c9410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1062df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1062e53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106272340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11466b190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x11494d250>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11466b190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x114669210>
          └ <fastapi.applications.FastAPI object at 0x11494d250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x114953920>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x114963650>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x114669210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x114963610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x114963650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x11494d350>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x114963610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107f30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1149539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x114963f90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x114950d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x114983cd0>
                     └ <function get_request_handler.<locals>.app at 0x114950cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107f12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x11479e890>, 'manager': <services.manager.FileManager object at 0x1149...
                 │         └ <function get_file at 0x114702340>
                 └ <fastapi.dependencies.models.Dependant object at 0x114960890>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x11479e890>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x114701f80>
                 └ <services.manager.FileManager object at 0x114971610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x111503ba0>
                     │      └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>
                     └ <ClientResponse(http://localhost:9000/files/kJPhHDbUiUh62MAcaBDZ8o/Adobe%20Photoshop%202023%20v24.4.1.dmg.torrent) [200 OK]>
                       ...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 349, in read
    raise self._exception
          │    └ ClientConnectionError('Connection closed')
          └ <StreamReader 40768 bytes eof e=ClientConnectionError('Connection closed')>

aiohttp.client_exceptions.ClientConnectionError: Connection closed
INFO     2023-06-21 11:57:51.708 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:57:51.710 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:57:51.811 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:57:51.812 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:57:51.813 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:57:51.813 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:57:51.813 request id: app - logging:callHandlers - Finished server process [16275]
INFO     2023-06-21 11:57:51.813 request id: app - logging:callHandlers - Finished server process [16275]
INFO     2023-06-21 11:57:52.424 request id: app - logging:callHandlers - Started server process [16374]
INFO     2023-06-21 11:57:52.424 request id: app - logging:callHandlers - Started server process [16374]
INFO     2023-06-21 11:57:52.424 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:57:52.424 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:57:52.488 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:57:52.488 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:57:52.491 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:57:52.491 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:57:52.494 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:57:52.494 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:57:52.496 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:57:52.498 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:57:52.498 request id: app - logging:callHandlers - [generated in 0.00029s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:57:52.502 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:57:52.503 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:57:52.503 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:57:59.597 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:57:59.599 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:57:59.600 request id: app - logging:callHandlers - [generated in 0.00035s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:57:59.653 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 11:57:59.655 request id: app - logging:callHandlers - 127.0.0.1:58559 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 500
ERROR    2023-06-21 11:57:59.657 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100f18ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100e25a80>
           └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e24fe0>
    └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105ab0410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>
    │    └ <function subprocess_started at 0x101fc0e00>
    └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105ab1750>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101fabe20>
           │       │   └ <uvicorn.server.Server object at 0x105ab1750>
           │       └ <function run at 0x10193da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x105a97010>
           │      └ <function Runner.run at 0x1019b19e0>
           └ <asyncio.runners.Runner object at 0x10596b710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1019ab600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10596b710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1019ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1019b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10193e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105ab3cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c4d190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105ab3cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c63f90>
          └ <fastapi.applications.FastAPI object at 0x105c4d190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x105c53420>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c63fd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c63f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c63610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c63fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c4d250>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c63610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102e30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x105c50d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x105c8cc90>
                     └ <function get_request_handler.<locals>.app at 0x105c50cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102e12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1040a0290>, 'manager': <services.manager.FileManager object at 0x105c...
                 │         └ <function get_file at 0x105a02340>
                 └ <fastapi.dependencies.models.Dependant object at 0x105c60650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1040a0290>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x105a01f80>
                 └ <services.manager.FileManager object at 0x105c80ad0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 47, in get_file_by_short_uuid_full_download
    async with tempfile.NamedTemporaryFile(mode='w+b', suffix='.png', delete=False) as temp_file:
               │        └ <function NamedTemporaryFile at 0x102012840>
               └ <module 'tempfile' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tem...

TypeError: '_TemporaryFileWrapper' object does not support the asynchronous context manager protocol
ERROR    2023-06-21 11:57:59.667 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100f18ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100e25a80>
           └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e24fe0>
    └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105ab0410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>
    │    └ <function subprocess_started at 0x101fc0e00>
    └ <SpawnProcess name='SpawnProcess-13' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105ab1750>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x101fabe20>
           │       │   └ <uvicorn.server.Server object at 0x105ab1750>
           │       └ <function run at 0x10193da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x105a97010>
           │      └ <function Runner.run at 0x1019b19e0>
           └ <asyncio.runners.Runner object at 0x10596b710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x1019ab600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x10596b710>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1019ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1019b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10193e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105ab3cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c4d190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105ab3cd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c63f90>
          └ <fastapi.applications.FastAPI object at 0x105c4d190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x105c53420>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c63fd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c63f90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c63610>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c63fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c4d250>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c63610>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102e30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105c539c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105c813d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x105c50d60>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x105c8cc90>
                     └ <function get_request_handler.<locals>.app at 0x105c50cc0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102e12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1040a0290>, 'manager': <services.manager.FileManager object at 0x105c...
                 │         └ <function get_file at 0x105a02340>
                 └ <fastapi.dependencies.models.Dependant object at 0x105c60650>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1040a0290>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x105a01f80>
                 └ <services.manager.FileManager object at 0x105c80ad0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 47, in get_file_by_short_uuid_full_download
    async with tempfile.NamedTemporaryFile(mode='w+b', suffix='.png', delete=False) as temp_file:
               │        └ <function NamedTemporaryFile at 0x102012840>
               └ <module 'tempfile' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/tem...

TypeError: '_TemporaryFileWrapper' object does not support the asynchronous context manager protocol
INFO     2023-06-21 11:59:50.838 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:59:50.839 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 11:59:50.940 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:59:50.941 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 11:59:50.941 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:59:50.942 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 11:59:50.942 request id: app - logging:callHandlers - Finished server process [16374]
INFO     2023-06-21 11:59:50.942 request id: app - logging:callHandlers - Finished server process [16374]
INFO     2023-06-21 11:59:51.502 request id: app - logging:callHandlers - Started server process [16593]
INFO     2023-06-21 11:59:51.502 request id: app - logging:callHandlers - Started server process [16593]
INFO     2023-06-21 11:59:51.502 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:59:51.502 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 11:59:51.568 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 11:59:51.568 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:59:51.572 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 11:59:51.572 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:59:51.575 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 11:59:51.575 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 11:59:51.577 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:59:51.580 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 11:59:51.580 request id: app - logging:callHandlers - [generated in 0.00029s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 11:59:51.585 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 11:59:51.586 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:59:51.586 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 11:59:54.898 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 11:59:54.900 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 11:59:54.900 request id: app - logging:callHandlers - [generated in 0.00052s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 11:59:54.950 request id: app - logging:callHandlers - 127.0.0.1:58592 - "GET /api/v1/download/kJPhHDbUiUh62MAcaBDZ8o HTTP/1.1" 200
INFO     2023-06-21 11:59:54.952 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:00:32.043 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:00:32.044 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:00:32.146 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:00:32.149 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:00:32.160 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:00:32.160 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:00:32.161 request id: app - logging:callHandlers - Finished server process [16593]
INFO     2023-06-21 12:00:32.161 request id: app - logging:callHandlers - Finished server process [16593]
INFO     2023-06-21 12:00:32.740 request id: app - logging:callHandlers - Started server process [16663]
INFO     2023-06-21 12:00:32.740 request id: app - logging:callHandlers - Started server process [16663]
INFO     2023-06-21 12:00:32.740 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:00:32.740 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:00:32.808 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:00:32.809 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:00:32.812 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:00:32.812 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:00:32.815 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:00:32.815 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:00:32.817 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:00:32.819 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:00:32.819 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:00:32.823 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:00:32.824 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:00:32.824 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:00:37.172 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:00:37.172 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:00:37.273 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:00:37.274 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:00:37.274 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:00:37.275 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:00:37.275 request id: app - logging:callHandlers - Finished server process [16663]
INFO     2023-06-21 12:00:37.275 request id: app - logging:callHandlers - Finished server process [16663]
INFO     2023-06-21 12:00:37.803 request id: app - logging:callHandlers - Started server process [16681]
INFO     2023-06-21 12:00:37.803 request id: app - logging:callHandlers - Started server process [16681]
INFO     2023-06-21 12:00:37.803 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:00:37.803 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:00:37.857 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:00:37.857 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:00:37.861 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:00:37.861 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:00:37.864 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:00:37.864 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:00:37.866 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:00:37.868 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:00:37.869 request id: app - logging:callHandlers - [generated in 0.00030s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:00:37.881 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:00:37.882 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:00:37.882 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:00:39.609 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:00:39.610 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:00:39.611 request id: app - logging:callHandlers - [generated in 0.00027s] ('kJPhHDbUiUh62MAcaBDZ8o',)
INFO     2023-06-21 12:00:48.942 request id: app - logging:callHandlers - 127.0.0.1:58610 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:00:49.159 request id: app - logging:callHandlers - 127.0.0.1:58610 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:01:14.186 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:01:14.200 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 12:01:14.200 request id: app - logging:callHandlers - [generated in 0.00144s] (UUID('69960769-b90b-4ca9-9873-eb26a9e2a93a'), 'UGSEVtWqCLnG6JfiVVpWGi/Документ.jpg', 'Документ.jpg', 63612, 'image/jpeg', 'UGSEVtWqCLnG6JfiVVpWGi', datetime.datetime(2023, 6, 21, 9, 1, 14, 199935))
INFO     2023-06-21 12:01:14.206 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:01:14.209 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:01:14.210 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.id = $1::UUID
INFO     2023-06-21 12:01:14.211 request id: app - logging:callHandlers - [generated in 0.00034s] (UUID('69960769-b90b-4ca9-9873-eb26a9e2a93a'),)
INFO     2023-06-21 12:01:14.216 request id: app - logging:callHandlers - 127.0.0.1:58631 - "POST /api/v1/ HTTP/1.1" 200
INFO     2023-06-21 12:01:14.217 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:01:26.135 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:01:26.135 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:01:26.136 request id: app - logging:callHandlers - [cached since 46.53s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:01:32.938 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:01:32.939 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:01:33.039 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:01:33.040 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:01:47.233 request id: app - logging:callHandlers - Finished server process [16681]
INFO     2023-06-21 12:01:47.234 request id: app - logging:callHandlers - Finished server process [16681]
INFO     2023-06-21 12:01:47.236 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:01:47.238 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:01:47.241 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:01:47.241 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:01:47.250 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e24ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d31a80>
           └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d30fe0>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e1690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    └ <function subprocess_started at 0x103ef8e00>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e29d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103ee3e20>
           │       │   └ <uvicorn.server.Server object at 0x1070e29d0>
           │       └ <function run at 0x103c7da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1062b6a50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103cf18a0>
    └ <asyncio.runners.Runner object at 0x1062b6a50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103cf1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-6' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x103cd28e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103ceb600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103ceb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103cf13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103c7e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10727a0d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
          └ <fastapi.applications.FastAPI object at 0x10727a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1072b0f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10727a190>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104a34720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107282340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1072bd750>
                     └ <function get_request_handler.<locals>.app at 0x1072822a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104a16c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1072bcf90>, 'manager': <services.manager.FileManager object at 0x1062...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107291610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1072bcf90>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x1062cc450>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x105103ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/kJPhHDbUiUh62MAcaBDZ8o/Adobe%20Photoshop%202023%20v24.4.1.dmg.torrent) [200 OK]>
                       ...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x105103c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1051039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:01:47.266 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e24ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d31a80>
           └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d30fe0>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e1690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    └ <function subprocess_started at 0x103ef8e00>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e29d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103ee3e20>
           │       │   └ <uvicorn.server.Server object at 0x1070e29d0>
           │       └ <function run at 0x103c7da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1062b6a50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103cf18a0>
    └ <asyncio.runners.Runner object at 0x1062b6a50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103cf1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-6' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x103cd28e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103ceb600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103ceb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103cf13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103c7e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10727a0d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
          └ <fastapi.applications.FastAPI object at 0x10727a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1072b0f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10727a190>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104a34720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072b0fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107293a50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107282340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1072bd750>
                     └ <function get_request_handler.<locals>.app at 0x1072822a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104a16c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1072bcf90>, 'manager': <services.manager.FileManager object at 0x1062...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107291610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'kJPhHDbUiUh62MAcaBDZ8o'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1072bcf90>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x1062cc450>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x105103ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/kJPhHDbUiUh62MAcaBDZ8o/Adobe%20Photoshop%202023%20v24.4.1.dmg.torrent) [200 OK]>
                       ...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x105103c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1051039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:01:47.273 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e24ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d31a80>
           └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d30fe0>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e1690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    └ <function subprocess_started at 0x103ef8e00>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e29d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103ee3e20>
           │       │   └ <uvicorn.server.Server object at 0x1070e29d0>
           │       └ <function run at 0x103c7da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1062b6a50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103cf18a0>
    └ <asyncio.runners.Runner object at 0x1062b6a50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103cf1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-6' coro=<RequestResponseCycle.run_asgi() done, defined at /Users/romanvolodin/Desktop/YAP/Author/D...
    │    │                  │     └ <function gather at 0x103cd28e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103ceb600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103ceb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103cf13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103c7e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10727a0d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
          └ <fastapi.applications.FastAPI object at 0x10727a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1072f54e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10727a190>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104a34720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107282340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107335cd0>
                     └ <function get_request_handler.<locals>.app at 0x1072822a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104a16c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x107504b10>, 'manager': <services.manager.FileManager object at 0x1062...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107291610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x107504b10>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x1062cc450>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x105103ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x105103c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1051039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:01:47.280 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e24ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d31a80>
           └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d30fe0>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e1690>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>
    │    └ <function subprocess_started at 0x103ef8e00>
    └ <SpawnProcess name='SpawnProcess-16' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e29d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103ee3e20>
           │       │   └ <uvicorn.server.Server object at 0x1070e29d0>
           │       └ <function run at 0x103c7da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1062b6a50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103cf18a0>
    └ <asyncio.runners.Runner object at 0x1062b6a50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103cf1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-6' coro=<RequestResponseCycle.run_asgi() done, defined at /Users/romanvolodin/Desktop/YAP/Author/D...
    │    │                  │     └ <function gather at 0x103cd28e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103ceb600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103ceb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103cf13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103c7e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10727a0d0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
          └ <fastapi.applications.FastAPI object at 0x10727a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1072f54e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1072936d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107293bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10727a190>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107293c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104a34720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1072f4fe0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107322a10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107282340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x107335cd0>
                     └ <function get_request_handler.<locals>.app at 0x1072822a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104a16c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x107504b10>, 'manager': <services.manager.FileManager object at 0x1062...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107291610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x107504b10>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x1062cc450>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x105103ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x105103c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1051039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:01:47.285 request id: app - logging:callHandlers - 127.0.0.1:58638 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
INFO     2023-06-21 12:01:47.985 request id: app - logging:callHandlers - Started server process [16807]
INFO     2023-06-21 12:01:47.986 request id: app - logging:callHandlers - Started server process [16807]
INFO     2023-06-21 12:01:47.986 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:01:47.986 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:01:48.033 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:01:48.033 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:01:48.036 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:01:48.036 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:01:48.047 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:01:48.050 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:01:48.053 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:01:48.055 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:01:48.055 request id: app - logging:callHandlers - [generated in 0.00042s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:01:48.061 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:01:48.062 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:01:48.062 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:01:48.063 request id: app - logging:callHandlers - 127.0.0.1:58648 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:01:48.180 request id: app - logging:callHandlers - 127.0.0.1:58648 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:01:59.739 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:01:59.742 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:01:59.742 request id: app - logging:callHandlers - [generated in 0.00050s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:04:04.309 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:04:04.310 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:04:04.412 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:04:04.412 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:04:04.717 request id: app - logging:callHandlers - Finished server process [16807]
INFO     2023-06-21 12:04:04.717 request id: app - logging:callHandlers - Finished server process [16807]
ERROR    2023-06-21 12:04:04.725 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:04:04.725 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:04:04.726 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:04:04.738 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ed4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104de1a80>
           └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104de0fe0>
    └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108920bd0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>
    │    └ <function subprocess_started at 0x105da8e00>
    └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1084b1f10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x105d93e20>
           │       │   └ <uvicorn.server.Server object at 0x1084b1f10>
           │       └ <function run at 0x1058f9a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1088ed210>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x10596d8a0>
    └ <asyncio.runners.Runner object at 0x1088ed210>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x10596dbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x10594e8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x105967600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105967560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10596d3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1058fa340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108923510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108981590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108923510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108993d90>
          └ <fastapi.applications.FastAPI object at 0x108981590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1089b1120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108993750>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108993d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108993dd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108993750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108981650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108993dd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106a40720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10897a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1089be350>
                     └ <function get_request_handler.<locals>.app at 0x10897a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106a22c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x108885bd0>, 'manager': <services.manager.FileManager object at 0x1089...
                 │         └ <function get_file at 0x108867920>
                 └ <fastapi.dependencies.models.Dependant object at 0x108990bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x108885bd0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x108867420>
                 └ <services.manager.FileManager object at 0x1089a6a90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x107143ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x107143c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1071439c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:04:04.748 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ed4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104de1a80>
           └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104de0fe0>
    └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x108920bd0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>
    │    └ <function subprocess_started at 0x105da8e00>
    └ <SpawnProcess name='SpawnProcess-17' parent=13242 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1084b1f10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x105d93e20>
           │       │   └ <uvicorn.server.Server object at 0x1084b1f10>
           │       └ <function run at 0x1058f9a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1088ed210>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x10596d8a0>
    └ <asyncio.runners.Runner object at 0x1088ed210>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x10596dbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x10594e8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x105967600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105967560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x10596d3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1058fa340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108923510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108981590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108923510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108993d90>
          └ <fastapi.applications.FastAPI object at 0x108981590>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1089b1120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108993750>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108993d90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108993dd0>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108993750>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108981650>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108993dd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106a40720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1089b1300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1089bd850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10897a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1089be350>
                     └ <function get_request_handler.<locals>.app at 0x10897a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x106a22c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x108885bd0>, 'manager': <services.manager.FileManager object at 0x1089...
                 │         └ <function get_file at 0x108867920>
                 └ <fastapi.dependencies.models.Dependant object at 0x108990bd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x108885bd0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x108867420>
                 └ <services.manager.FileManager object at 0x1089a6a90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x107143ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x107143c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1071439c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:04:04.752 request id: app - logging:callHandlers - 127.0.0.1:58657 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
INFO     2023-06-21 12:04:07.421 request id: app - logging:callHandlers - Started server process [17063]
INFO     2023-06-21 12:04:07.421 request id: app - logging:callHandlers - Started server process [17063]
INFO     2023-06-21 12:04:07.421 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:04:07.421 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:04:07.468 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:04:07.468 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:04:07.472 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:04:07.472 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:04:07.475 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:04:07.475 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:04:07.477 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:04:07.479 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:04:07.479 request id: app - logging:callHandlers - [generated in 0.00024s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:04:07.484 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:04:07.485 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:04:07.485 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:04:13.101 request id: app - logging:callHandlers - 127.0.0.1:58709 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:04:13.269 request id: app - logging:callHandlers - 127.0.0.1:58709 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:04:18.356 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:04:18.359 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:04:18.359 request id: app - logging:callHandlers - [generated in 0.00051s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:06:56.952 request id: app - logging:callHandlers - 127.0.0.1:58821 - "GET /api/files/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 404
INFO     2023-06-21 12:07:04.283 request id: app - logging:callHandlers - 127.0.0.1:58822 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:07:04.431 request id: app - logging:callHandlers - 127.0.0.1:58822 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:07:15.382 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:07:15.383 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:07:15.383 request id: app - logging:callHandlers - [cached since 177s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:07:25.461 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:07:25.463 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:07:25.565 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:07:25.566 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:07:25.667 request id: app - logging:callHandlers - Finished server process [17063]
INFO     2023-06-21 12:07:25.667 request id: app - logging:callHandlers - Finished server process [17063]
INFO     2023-06-21 12:07:25.669 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:07:25.669 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:07:25.672 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:07:25.673 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:07:25.677 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102554ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102461a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102460fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1100a4110>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    └ <function subprocess_started at 0x103428e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11041d490>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103413e20>
           │       │   └ <uvicorn.server.Server object at 0x11041d490>
           │       └ <function run at 0x102f79a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1100a4e50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x102fed8a0>
    └ <asyncio.runners.Runner object at 0x1100a4e50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x102fedbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-9' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x102fce8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x102fe7600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102fe7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102fed3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102f7a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110484c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
          └ <fastapi.applications.FastAPI object at 0x110484c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1104f9940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110484d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104e30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x11047a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110526910>
                     └ <function get_request_handler.<locals>.app at 0x11047a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x110526b10>, 'manager': <services.manager.FileManager object at 0x1104...
                 │         └ <function get_file at 0x110367920>
                 └ <fastapi.dependencies.models.Dependant object at 0x110490110>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x110526b10>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x110367420>
                 └ <services.manager.FileManager object at 0x110491dd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x106d03ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x106d03c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x106d039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:07:25.691 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102554ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102461a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102460fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1100a4110>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    └ <function subprocess_started at 0x103428e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11041d490>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103413e20>
           │       │   └ <uvicorn.server.Server object at 0x11041d490>
           │       └ <function run at 0x102f79a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1100a4e50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x102fed8a0>
    └ <asyncio.runners.Runner object at 0x1100a4e50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x102fedbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-9' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x102fce8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x102fe7600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102fe7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102fed3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102f7a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110484c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
          └ <fastapi.applications.FastAPI object at 0x110484c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1104f9940>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110484d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104e30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104f9a80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110525950>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x11047a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x110526910>
                     └ <function get_request_handler.<locals>.app at 0x11047a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x110526b10>, 'manager': <services.manager.FileManager object at 0x1104...
                 │         └ <function get_file at 0x110367920>
                 └ <fastapi.dependencies.models.Dependant object at 0x110490110>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x110526b10>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x110367420>
                 └ <services.manager.FileManager object at 0x110491dd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x106d03ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x106d03c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x106d039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:07:25.696 request id: app - logging:callHandlers - 127.0.0.1:58824 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
ERROR    2023-06-21 12:07:25.697 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102554ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102461a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102460fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1100a4110>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    └ <function subprocess_started at 0x103428e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11041d490>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103413e20>
           │       │   └ <uvicorn.server.Server object at 0x11041d490>
           │       └ <function run at 0x102f79a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1100a4e50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x102fed8a0>
    └ <asyncio.runners.Runner object at 0x1100a4e50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x102fedbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-9' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x102fce8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x102fe7600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102fe7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102fed3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102f7a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110484c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
          └ <fastapi.applications.FastAPI object at 0x110484c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1103ffe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110484d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104e30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x11047a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1104c4c90>
                     └ <function get_request_handler.<locals>.app at 0x11047a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x110485490>, 'manager': <services.manager.FileManager object at 0x1104...
                 │         └ <function get_file at 0x110367920>
                 └ <fastapi.dependencies.models.Dependant object at 0x110490110>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x110485490>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x110367420>
                 └ <services.manager.FileManager object at 0x110491dd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x106d03ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x106d03c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x106d039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:07:25.702 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102554ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102461a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102460fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1100a4110>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>
    │    └ <function subprocess_started at 0x103428e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17059 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11041d490>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103413e20>
           │       │   └ <uvicorn.server.Server object at 0x11041d490>
           │       └ <function run at 0x102f79a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1100a4e50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x102fed8a0>
    └ <asyncio.runners.Runner object at 0x1100a4e50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x102fedbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-9' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x102fce8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x102fe7600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x102fe7560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x102fed3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x102f7a340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x110484c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11041eb90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
          └ <fastapi.applications.FastAPI object at 0x110484c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1103ffe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x110493990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x1104939d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x110484d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x110493a50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104e30720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1104b05e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1104c4750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x11047a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1104c4c90>
                     └ <function get_request_handler.<locals>.app at 0x11047a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e12c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x110485490>, 'manager': <services.manager.FileManager object at 0x1104...
                 │         └ <function get_file at 0x110367920>
                 └ <fastapi.dependencies.models.Dependant object at 0x110490110>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x110485490>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x110367420>
                 └ <services.manager.FileManager object at 0x110491dd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x106d03ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x106d03c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x106d039c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:07:37.293 request id: app - logging:callHandlers - Started server process [17456]
INFO     2023-06-21 12:07:37.293 request id: app - logging:callHandlers - Started server process [17456]
INFO     2023-06-21 12:07:37.293 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:07:37.294 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:07:37.364 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:07:37.364 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:07:37.367 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:07:37.367 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:07:37.370 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:07:37.370 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:07:37.379 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:07:37.382 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:07:37.382 request id: app - logging:callHandlers - [generated in 0.00067s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:07:37.394 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:07:37.396 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:07:37.396 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:07:41.265 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:07:41.267 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:07:41.267 request id: app - logging:callHandlers - [generated in 0.00046s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:07:41.307 request id: app - logging:callHandlers - 127.0.0.1:58846 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:07:41.312 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:08:06.568 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:08:06.570 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:08:06.571 request id: app - logging:callHandlers - [cached since 25.3s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:08:16.400 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:08:16.401 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:08:16.401 request id: app - logging:callHandlers - [cached since 35.13s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:08:30.181 request id: app - logging:callHandlers - 127.0.0.1:58875 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:08:30.360 request id: app - logging:callHandlers - 127.0.0.1:58875 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:08:38.368 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:08:38.369 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:08:38.369 request id: app - logging:callHandlers - [cached since 57.1s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:08:51.284 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:08:51.285 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:08:51.387 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:08:51.387 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:08:56.256 request id: app - logging:callHandlers - Finished server process [17456]
INFO     2023-06-21 12:08:56.257 request id: app - logging:callHandlers - Finished server process [17456]
INFO     2023-06-21 12:08:56.260 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:08:56.264 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:08:56.264 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:08:56.265 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:08:56.265 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:08:56.278 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100818ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100725a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100724fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103ee1410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    └ <function subprocess_started at 0x1016ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ee2790>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1016d7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ee2790>
           │       └ <function run at 0x10123da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1023bcf10>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1012b18a0>
    └ <asyncio.runners.Runner object at 0x1023bcf10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1012b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-13' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djan...
    │    │                  │     └ <function gather at 0x1012928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1012ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10123e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10407a110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
          └ <fastapi.applications.FastAPI object at 0x10407a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1040f1260>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10407a1d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102384720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10407e340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104139c10>
                     └ <function get_request_handler.<locals>.app at 0x10407e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102366c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x104138d50>, 'manager': <services.manager.FileManager object at 0x1040...
                 │         └ <function get_file at 0x103e2b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1040915d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x104138d50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x103e2b420>
                 └ <services.manager.FileManager object at 0x10409afd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1028c3ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1028c3c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1028c39c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:08:56.291 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100818ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100725a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100724fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103ee1410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    └ <function subprocess_started at 0x1016ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ee2790>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1016d7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ee2790>
           │       └ <function run at 0x10123da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1023bcf10>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1012b18a0>
    └ <asyncio.runners.Runner object at 0x1023bcf10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1012b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-13' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djan...
    │    │                  │     └ <function gather at 0x1012928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1012ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10123e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10407a110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
          └ <fastapi.applications.FastAPI object at 0x10407a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1040f1260>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10407a1d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102384720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1041388d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10407e340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104139c10>
                     └ <function get_request_handler.<locals>.app at 0x10407e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102366c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x104138d50>, 'manager': <services.manager.FileManager object at 0x1040...
                 │         └ <function get_file at 0x103e2b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1040915d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x104138d50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x103e2b420>
                 └ <services.manager.FileManager object at 0x10409afd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1028c3ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1028c3c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1028c39c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:08:56.298 request id: app - logging:callHandlers - 127.0.0.1:58878 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
ERROR    2023-06-21 12:08:56.299 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100818ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100725a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100724fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103ee1410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    └ <function subprocess_started at 0x1016ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ee2790>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1016d7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ee2790>
           │       └ <function run at 0x10123da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1023bcf10>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1012b18a0>
    └ <asyncio.runners.Runner object at 0x1023bcf10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1012b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-13' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djan...
    │    │                  │     └ <function gather at 0x1012928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1012ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10123e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10407a110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
          └ <fastapi.applications.FastAPI object at 0x10407a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1040ad120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10407a1d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102384720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10407e340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104119ed0>
                     └ <function get_request_handler.<locals>.app at 0x10407e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102366c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x104119750>, 'manager': <services.manager.FileManager object at 0x1040...
                 │         └ <function get_file at 0x103e2b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1040915d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x104119750>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x103e2b420>
                 └ <services.manager.FileManager object at 0x10409afd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1028c3ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1028c3c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1028c39c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:08:56.305 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100818ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100725a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100724fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103ee1410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    └ <function subprocess_started at 0x1016ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ee2790>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1016d7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ee2790>
           │       └ <function run at 0x10123da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1023bcf10>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1012b18a0>
    └ <asyncio.runners.Runner object at 0x1023bcf10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1012b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-13' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djan...
    │    │                  │     └ <function gather at 0x1012928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1012ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10123e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10407a110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
          └ <fastapi.applications.FastAPI object at 0x10407a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1040ad120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10407a1d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102384720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040e6980>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104119010>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10407e340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104119ed0>
                     └ <function get_request_handler.<locals>.app at 0x10407e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102366c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x104119750>, 'manager': <services.manager.FileManager object at 0x1040...
                 │         └ <function get_file at 0x103e2b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1040915d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x104119750>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x103e2b420>
                 └ <services.manager.FileManager object at 0x10409afd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1028c3ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1028c3c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1028c39c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:08:56.310 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100818ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100725a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100724fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103ee1410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    └ <function subprocess_started at 0x1016ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ee2790>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1016d7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ee2790>
           │       └ <function run at 0x10123da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1023bcf10>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1012b18a0>
    └ <asyncio.runners.Runner object at 0x1023bcf10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1012b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-13' coro=<RequestResponseCycle.run_asgi() done, defined at /Users/romanvolodin/Desktop/YAP/Author/...
    │    │                  │     └ <function gather at 0x1012928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1012ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10123e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10407a110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
          └ <fastapi.applications.FastAPI object at 0x10407a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1040f1bc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10407a1d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102384720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10407e340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104129a10>
                     └ <function get_request_handler.<locals>.app at 0x10407e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102366c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x104129dd0>, 'manager': <services.manager.FileManager object at 0x1040...
                 │         └ <function get_file at 0x103e2b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1040915d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x104129dd0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x103e2b420>
                 └ <services.manager.FileManager object at 0x10409afd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1028c3ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1028c3c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1028c39c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:08:56.321 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100818ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100725a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100724fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103ee1410>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>
    │    └ <function subprocess_started at 0x1016ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ee2790>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1016d7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ee2790>
           │       └ <function run at 0x10123da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1023bcf10>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1012b18a0>
    └ <asyncio.runners.Runner object at 0x1023bcf10>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1012b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-13' coro=<RequestResponseCycle.run_asgi() done, defined at /Users/romanvolodin/Desktop/YAP/Author/...
    │    │                  │     └ <function gather at 0x1012928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1012ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10123e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10407a110>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103ee3c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
          └ <fastapi.applications.FastAPI object at 0x10407a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1040f1bc0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x103eb2c10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x103eb1550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10407a1d0>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104092b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102384720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1040f1c60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104128850>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10407e340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104129a10>
                     └ <function get_request_handler.<locals>.app at 0x10407e2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102366c00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x104129dd0>, 'manager': <services.manager.FileManager object at 0x1040...
                 │         └ <function get_file at 0x103e2b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1040915d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x104129dd0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x103e2b420>
                 └ <services.manager.FileManager object at 0x10409afd0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1028c3ba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1028c3c40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1028c39c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:08:56.983 request id: app - logging:callHandlers - Started server process [17607]
INFO     2023-06-21 12:08:56.984 request id: app - logging:callHandlers - Started server process [17607]
INFO     2023-06-21 12:08:56.984 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:08:56.984 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:08:57.032 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:08:57.032 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:08:57.037 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:08:57.038 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:08:57.041 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:08:57.041 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:08:57.044 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:08:57.046 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:08:57.046 request id: app - logging:callHandlers - [generated in 0.00030s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:08:57.064 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:08:57.065 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:08:57.065 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:08:57.066 request id: app - logging:callHandlers - 127.0.0.1:58885 - "GET /favicon.ico HTTP/1.1" 404
INFO     2023-06-21 12:09:00.671 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:09:00.673 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:09:00.673 request id: app - logging:callHandlers - [generated in 0.00038s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:09:12.898 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:09:12.899 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:09:13.002 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:09:13.003 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:09:13.206 request id: app - logging:callHandlers - Finished server process [17607]
INFO     2023-06-21 12:09:13.206 request id: app - logging:callHandlers - Finished server process [17607]
INFO     2023-06-21 12:09:13.223 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:09:13.226 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:09:13.226 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:09:13.233 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10279cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1026a9a80>
           └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1026a8fe0>
    └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10761c890>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>
    │    └ <function subprocess_started at 0x103670e00>
    └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10761dc10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x10365be20>
           │       │   └ <uvicorn.server.Server object at 0x10761dc10>
           │       └ <function run at 0x1031c1a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x107547750>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1032358a0>
    └ <asyncio.runners.Runner object at 0x107547750>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103235bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-8' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x1032168e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x10322f600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10322f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1032353a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1031c2340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10761f090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x107681390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10761f090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107693f10>
          └ <fastapi.applications.FastAPI object at 0x107681390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1075ffe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107693450>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107693f10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107693650>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107693450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107681490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107693650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104418720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10767a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1076c65d0>
                     └ <function get_request_handler.<locals>.app at 0x10767a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1043fac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x10769ac50>, 'manager': <services.manager.FileManager object at 0x1076...
                 │         └ <function get_file at 0x107567920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1076908d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x10769ac50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x107567420>
                 └ <services.manager.FileManager object at 0x10761e0d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x10495fba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x10495fc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x10495f9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:09:13.246 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10279cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1026a9a80>
           └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1026a8fe0>
    └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10761c890>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>
    │    └ <function subprocess_started at 0x103670e00>
    └ <SpawnProcess name='SpawnProcess-2' parent=17452 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10761dc10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x10365be20>
           │       │   └ <uvicorn.server.Server object at 0x10761dc10>
           │       └ <function run at 0x1031c1a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x107547750>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1032358a0>
    └ <asyncio.runners.Runner object at 0x107547750>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103235bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-8' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x1032168e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x10322f600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10322f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1032353a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1031c2340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10761f090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x107681390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10761f090>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107693f10>
          └ <fastapi.applications.FastAPI object at 0x107681390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1075ffe20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107693450>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107693f10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107693650>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x107693450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x107681490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107693650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x104418720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1076ad1c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1076c4b50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10767a340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1076c65d0>
                     └ <function get_request_handler.<locals>.app at 0x10767a2a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1043fac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x10769ac50>, 'manager': <services.manager.FileManager object at 0x1076...
                 │         └ <function get_file at 0x107567920>
                 └ <fastapi.dependencies.models.Dependant object at 0x1076908d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x10769ac50>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x107567420>
                 └ <services.manager.FileManager object at 0x10761e0d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x10495fba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x10495fc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x10495f9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:09:13.251 request id: app - logging:callHandlers - 127.0.0.1:58885 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
INFO     2023-06-21 12:09:22.946 request id: app - logging:callHandlers - Started server process [17690]
INFO     2023-06-21 12:09:22.947 request id: app - logging:callHandlers - Started server process [17690]
INFO     2023-06-21 12:09:22.947 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:09:22.947 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:09:23.003 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:09:23.003 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:09:23.006 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:09:23.006 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:09:23.009 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:09:23.009 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:09:23.011 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:09:23.013 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:09:23.014 request id: app - logging:callHandlers - [generated in 0.00036s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:09:23.019 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:09:23.019 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:09:23.020 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:09:25.709 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:09:25.711 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:09:25.711 request id: app - logging:callHandlers - [generated in 0.00032s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:10:02.899 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:10:02.906 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 12:10:02.907 request id: app - logging:callHandlers - [generated in 0.00141s] (UUID('502d5ea1-bf69-4dc3-a2b7-5310e5dafeef'), '82und5WKF4BZ9Wb7nfa4mz/1.png', '1.png', 31050, 'image/png', '82und5WKF4BZ9Wb7nfa4mz', datetime.datetime(2023, 6, 21, 9, 10, 2, 906041))
INFO     2023-06-21 12:10:02.916 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:10:02.931 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:10:02.932 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.id = $1::UUID
INFO     2023-06-21 12:10:02.932 request id: app - logging:callHandlers - [generated in 0.00023s] (UUID('502d5ea1-bf69-4dc3-a2b7-5310e5dafeef'),)
INFO     2023-06-21 12:10:02.941 request id: app - logging:callHandlers - 127.0.0.1:58908 - "POST /api/v1/ HTTP/1.1" 200
INFO     2023-06-21 12:10:02.942 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:10:11.879 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:10:11.881 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:10:11.882 request id: app - logging:callHandlers - [cached since 46.17s ago] ('82und5WKF4BZ9Wb7nfa4mz',)
INFO     2023-06-21 12:10:11.929 request id: app - logging:callHandlers - 127.0.0.1:58902 - "GET /api/v1/download/82und5WKF4BZ9Wb7nfa4mz HTTP/1.1" 200
INFO     2023-06-21 12:10:11.931 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:10:16.391 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:10:16.392 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:10:16.392 request id: app - logging:callHandlers - [cached since 50.68s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:10:42.572 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:10:42.573 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:10:42.674 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:10:42.675 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:10:44.705 request id: app - logging:callHandlers - Waiting for background tasks to complete. (CTRL+C to force quit)
INFO     2023-06-21 12:10:44.705 request id: app - logging:callHandlers - Waiting for background tasks to complete. (CTRL+C to force quit)
INFO     2023-06-21 12:10:52.551 request id: app - logging:callHandlers - Finished server process [17690]
INFO     2023-06-21 12:10:52.552 request id: app - logging:callHandlers - Finished server process [17690]
INFO     2023-06-21 12:10:52.555 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:10:52.559 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:10:52.560 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:10:52.560 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:10:52.564 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x103140ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10304da80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10304cfe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e17d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    └ <function subprocess_started at 0x1048c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e2b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1048abe20>
           │       │   └ <uvicorn.server.Server object at 0x1070e2b10>
           │       └ <function run at 0x103b65a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1048694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103bd98a0>
    └ <asyncio.runners.Runner object at 0x1048694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103bd9bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-7' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x103bba8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103bd3600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103bd3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103bd93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103b66340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10743e190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
          └ <fastapi.applications.FastAPI object at 0x10743e190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1070c7e20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10743e210>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1054bc720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107446340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10704a610>
                     └ <function get_request_handler.<locals>.app at 0x1074462a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10549ec00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x107049bd0>, 'manager': <services.manager.FileManager object at 0x106b...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107455610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x107049bd0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x106bb6010>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1059cfba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1059cfc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1059cf9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:10:52.589 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x103140ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10304da80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10304cfe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e17d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    └ <function subprocess_started at 0x1048c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e2b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1048abe20>
           │       │   └ <uvicorn.server.Server object at 0x1070e2b10>
           │       └ <function run at 0x103b65a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1048694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103bd98a0>
    └ <asyncio.runners.Runner object at 0x1048694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103bd9bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-7' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x103bba8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103bd3600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103bd3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103bd93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103b66340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10743e190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
          └ <fastapi.applications.FastAPI object at 0x10743e190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1070c7e20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10743e210>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1054bc720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107474f40>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x107481d10>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107446340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x10704a610>
                     └ <function get_request_handler.<locals>.app at 0x1074462a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10549ec00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x107049bd0>, 'manager': <services.manager.FileManager object at 0x106b...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107455610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x107049bd0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x106bb6010>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1059cfba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1059cfc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1059cf9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:10:52.595 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x103140ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10304da80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10304cfe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e17d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    └ <function subprocess_started at 0x1048c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e2b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1048abe20>
           │       │   └ <uvicorn.server.Server object at 0x1070e2b10>
           │       └ <function run at 0x103b65a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1048694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103bd98a0>
    └ <asyncio.runners.Runner object at 0x1048694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103bd9bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-7' coro=<RequestResponseCycle.run_asgi() done, defined at /Users/romanvolodin/Desktop/YAP/Author/D...
    │    │                  │     └ <function gather at 0x103bba8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103bd3600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103bd3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103bd93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103b66340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10743e190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
          └ <fastapi.applications.FastAPI object at 0x10743e190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106fff100>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10743e210>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1054bc720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107446340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1074e9cd0>
                     └ <function get_request_handler.<locals>.app at 0x1074462a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10549ec00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1180014d0>, 'manager': <services.manager.FileManager object at 0x106b...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107455610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1180014d0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x106bb6010>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1059cfba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1059cfc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1059cf9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:10:52.599 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x103140ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x10304da80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10304cfe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1070e17d0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>
    │    └ <function subprocess_started at 0x1048c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17688 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1070e2b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1048abe20>
           │       │   └ <uvicorn.server.Server object at 0x1070e2b10>
           │       └ <function run at 0x103b65a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1048694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103bd98a0>
    └ <asyncio.runners.Runner object at 0x1048694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103bd9bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-7' coro=<RequestResponseCycle.run_asgi() done, defined at /Users/romanvolodin/Desktop/YAP/Author/D...
    │    │                  │     └ <function gather at 0x103bba8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103bd3600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103bd3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103bd93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103b66340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10743e190>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1070e3e50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
          └ <fastapi.applications.FastAPI object at 0x10743e190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106fff100>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107460110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10743ee90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10743e210>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107457e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1054bc720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1074bbba0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1074eb6d0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x107446340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1074e9cd0>
                     └ <function get_request_handler.<locals>.app at 0x1074462a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10549ec00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x1180014d0>, 'manager': <services.manager.FileManager object at 0x106b...
                 │         └ <function get_file at 0x10702b920>
                 └ <fastapi.dependencies.models.Dependant object at 0x107455610>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x1180014d0>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x10702b420>
                 └ <services.manager.FileManager object at 0x106bb6010>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    uploaded = await result.content.read()
                     │      │       └ <function StreamReader.read at 0x1059cfba0>
                     │      └ <StreamReader>
                     └ <ClientResponse(http://localhost:9000/files/UGSEVtWqCLnG6JfiVVpWGi/%D0%94%D0%BE%D0%BA%D1%83%D0%BC%D0%B5%D0%BD%D1%82.jpg) [200...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x1059cfc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x1059cf9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:10:53.230 request id: app - logging:callHandlers - Started server process [17911]
INFO     2023-06-21 12:10:53.230 request id: app - logging:callHandlers - Started server process [17911]
INFO     2023-06-21 12:10:53.231 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:10:53.231 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:10:53.275 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:10:53.275 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:10:53.279 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:10:53.279 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:10:53.283 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:10:53.284 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:10:53.289 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:10:53.291 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:10:53.291 request id: app - logging:callHandlers - [generated in 0.00025s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:10:53.301 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:10:53.303 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:10:53.303 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:10:53.304 request id: app - logging:callHandlers - 127.0.0.1:58925 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:10:53.474 request id: app - logging:callHandlers - 127.0.0.1:58925 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:10:54.313 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:10:54.314 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:10:54.416 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:10:54.416 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:10:54.417 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:10:54.418 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:10:54.418 request id: app - logging:callHandlers - Finished server process [17911]
INFO     2023-06-21 12:10:54.418 request id: app - logging:callHandlers - Finished server process [17911]
INFO     2023-06-21 12:10:56.027 request id: app - logging:callHandlers - Started server process [17925]
INFO     2023-06-21 12:10:56.027 request id: app - logging:callHandlers - Started server process [17925]
INFO     2023-06-21 12:10:56.027 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:10:56.027 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:10:56.081 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:10:56.081 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:10:56.086 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:10:56.087 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:10:56.090 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:10:56.090 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:10:56.092 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:10:56.094 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:10:56.095 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:10:56.098 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:10:56.098 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:10:56.099 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:10:57.703 request id: app - logging:callHandlers - 127.0.0.1:58938 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:10:57.798 request id: app - logging:callHandlers - 127.0.0.1:58938 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:11:01.334 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:11:01.337 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:11:01.337 request id: app - logging:callHandlers - [generated in 0.00039s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:11:46.975 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:11:46.976 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:11:47.078 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:11:47.078 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:12:18.486 request id: app - logging:callHandlers - Finished server process [17925]
INFO     2023-06-21 12:12:18.487 request id: app - logging:callHandlers - Finished server process [17925]
ERROR    2023-06-21 12:12:18.495 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:12:18.495 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:12:18.499 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:12:18.519 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1026f0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1025fda80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1025fcfe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105c18ad0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>
    │    └ <function subprocess_started at 0x1035c4e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105c19e50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1035afe20>
           │       │   └ <uvicorn.server.Server object at 0x105c19e50>
           │       └ <function run at 0x103115a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1058a1210>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1031898a0>
    └ <asyncio.runners.Runner object at 0x1058a1210>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103189bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x10316a8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103183600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103183560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1031893a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103116340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c19e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c7d850>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c19e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c8eed0>
          └ <fastapi.applications.FastAPI object at 0x105c7d850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x105ca91c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c8ecd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c8eed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c8e850>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c8ecd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c7d910>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c8e850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x10425c720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x105c76340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x105c02b10>
                     └ <function get_request_handler.<locals>.app at 0x105c762a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10423ec00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x105c8da10>, 'manager': <services.manager.FileManager object at 0x105c...
                 │         └ <function get_file at 0x105b63920>
                 └ <fastapi.dependencies.models.Dependant object at 0x105c8ca90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x105c8da10>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x105b63420>
                 └ <services.manager.FileManager object at 0x105c9c890>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    async with tempfile.NamedTemporaryFile(mode='w+b', suffix='.png', delete=False) as temp_file:
               │        └ <function NamedTemporaryFile at 0x105b56fc0>
               └ <module 'aiofiles.tempfile' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x10479bc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x10479b9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:12:18.529 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1026f0ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1025fda80>
           └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1025fcfe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x105c18ad0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>
    │    └ <function subprocess_started at 0x1035c4e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=17923 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x105c19e50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1035afe20>
           │       │   └ <uvicorn.server.Server object at 0x105c19e50>
           │       └ <function run at 0x103115a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1058a1210>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1031898a0>
    └ <asyncio.runners.Runner object at 0x1058a1210>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103189bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x10316a8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103183600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103183560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1031893a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103116340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c19e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c7d850>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c19e90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c8eed0>
          └ <fastapi.applications.FastAPI object at 0x105c7d850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x105ca91c0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c8ecd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105c8eed0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c8e850>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x105c8ecd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c7d910>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105c8e850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x10425c720>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105ca9120>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105cc1390>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x105c76340>
          └ APIRoute(path='/api/v1/download/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x105c02b10>
                     └ <function get_request_handler.<locals>.app at 0x105c762a0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x10423ec00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x105c8da10>, 'manager': <services.manager.FileManager object at 0x105c...
                 │         └ <function get_file at 0x105b63920>
                 └ <fastapi.dependencies.models.Dependant object at 0x105c8ca90>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 41, in get_file
    return await manager.get_file_by_short_uuid_full_download(db, short_name=short_name)
                 │       │                                    │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                                    └ <sqlalchemy.orm.session.AsyncSession object at 0x105c8da10>
                 │       └ <function FileManager.get_file_by_short_uuid_full_download at 0x105b63420>
                 └ <services.manager.FileManager object at 0x105c9c890>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 46, in get_file_by_short_uuid_full_download
    async with tempfile.NamedTemporaryFile(mode='w+b', suffix='.png', delete=False) as temp_file:
               │        └ <function NamedTemporaryFile at 0x105b56fc0>
               └ <module 'aiofiles.tempfile' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 375, in read
    block = await self.readany()
                  │    └ <function StreamReader.readany at 0x10479bc40>
                  └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 397, in readany
    await self._wait("readany")
          │    └ <function StreamReader._wait at 0x10479b9c0>
          └ <StreamReader>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 304, in _wait
    await waiter
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:12:18.533 request id: app - logging:callHandlers - 127.0.0.1:58942 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
INFO     2023-06-21 12:12:19.146 request id: app - logging:callHandlers - Started server process [18081]
INFO     2023-06-21 12:12:19.146 request id: app - logging:callHandlers - Started server process [18081]
INFO     2023-06-21 12:12:19.146 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:12:19.146 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:12:19.187 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:12:19.188 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:12:19.191 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:12:19.191 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:12:19.194 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:12:19.194 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:12:19.196 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:19.198 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:12:19.198 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:12:19.203 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:12:19.204 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:12:19.204 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:12:20.319 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:12:20.319 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:12:20.425 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:12:20.426 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:12:20.429 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:12:20.429 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:12:20.430 request id: app - logging:callHandlers - Finished server process [18081]
INFO     2023-06-21 12:12:20.430 request id: app - logging:callHandlers - Finished server process [18081]
INFO     2023-06-21 12:12:22.580 request id: app - logging:callHandlers - Started server process [18093]
INFO     2023-06-21 12:12:22.580 request id: app - logging:callHandlers - Started server process [18093]
INFO     2023-06-21 12:12:22.580 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:12:22.580 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:12:22.640 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:12:22.640 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:12:22.643 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:12:22.643 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:12:22.646 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:12:22.646 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:12:22.648 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:22.650 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:12:22.650 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:12:22.657 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:12:22.660 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:12:22.660 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:12:26.084 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:26.087 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:26.087 request id: app - logging:callHandlers - [generated in 0.00030s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:26.129 request id: app - logging:callHandlers - 127.0.0.1:58986 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:26.131 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:31.534 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:31.535 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:31.535 request id: app - logging:callHandlers - [cached since 5.448s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:31.547 request id: app - logging:callHandlers - 127.0.0.1:58987 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:31.548 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:37.554 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:37.556 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:37.557 request id: app - logging:callHandlers - [cached since 11.47s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:37.585 request id: app - logging:callHandlers - 127.0.0.1:58991 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:37.588 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:40.163 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:40.164 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:40.165 request id: app - logging:callHandlers - [cached since 14.08s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:40.196 request id: app - logging:callHandlers - 127.0.0.1:58999 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:40.198 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:41.711 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:41.712 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:41.712 request id: app - logging:callHandlers - [cached since 15.63s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:41.736 request id: app - logging:callHandlers - 127.0.0.1:58999 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:41.738 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:54.318 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:54.322 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:54.322 request id: app - logging:callHandlers - [cached since 28.24s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:54.362 request id: app - logging:callHandlers - 127.0.0.1:59007 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:54.365 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:57.459 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:57.460 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:57.460 request id: app - logging:callHandlers - [cached since 31.37s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:57.491 request id: app - logging:callHandlers - 127.0.0.1:59007 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:57.493 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:58.332 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:58.333 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:58.333 request id: app - logging:callHandlers - [cached since 32.25s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:58.356 request id: app - logging:callHandlers - 127.0.0.1:59007 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:58.358 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:12:58.833 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:12:58.836 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:12:58.837 request id: app - logging:callHandlers - [cached since 32.75s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:12:58.868 request id: app - logging:callHandlers - 127.0.0.1:59007 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:12:58.870 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:15:19.811 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:15:19.812 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:15:19.914 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:15:19.914 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:15:19.915 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:15:19.915 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:15:19.915 request id: app - logging:callHandlers - Finished server process [18093]
INFO     2023-06-21 12:15:19.916 request id: app - logging:callHandlers - Finished server process [18093]
INFO     2023-06-21 12:15:20.829 request id: app - logging:callHandlers - Started server process [18389]
INFO     2023-06-21 12:15:20.829 request id: app - logging:callHandlers - Started server process [18389]
INFO     2023-06-21 12:15:20.829 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:15:20.829 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:15:20.893 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:15:20.893 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:15:20.898 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:15:20.898 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:15:20.903 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:15:20.903 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:15:20.906 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:15:20.908 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:15:20.908 request id: app - logging:callHandlers - [generated in 0.00033s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:15:20.918 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:15:20.921 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:15:20.921 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:15:22.668 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:15:22.670 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:15:22.670 request id: app - logging:callHandlers - [generated in 0.00033s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:15:22.782 request id: app - logging:callHandlers - 127.0.0.1:59034 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:15:22.784 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:15:23.448 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:15:23.449 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:15:23.450 request id: app - logging:callHandlers - [cached since 0.78s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:15:23.470 request id: app - logging:callHandlers - 127.0.0.1:59034 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:15:23.472 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:15:24.010 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:15:24.011 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:15:24.011 request id: app - logging:callHandlers - [cached since 1.342s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:15:24.036 request id: app - logging:callHandlers - 127.0.0.1:59034 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:15:24.039 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:15:24.462 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:15:24.464 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:15:24.466 request id: app - logging:callHandlers - [cached since 1.795s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:15:24.489 request id: app - logging:callHandlers - 127.0.0.1:59034 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:15:24.490 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:15:24.927 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:15:24.928 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:15:24.928 request id: app - logging:callHandlers - [cached since 2.259s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:15:24.951 request id: app - logging:callHandlers - 127.0.0.1:59034 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:15:24.953 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:19:09.634 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:19:09.635 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:19:09.736 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:19:09.737 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:19:09.737 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:19:09.738 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:19:09.738 request id: app - logging:callHandlers - Finished server process [18389]
INFO     2023-06-21 12:19:09.738 request id: app - logging:callHandlers - Finished server process [18389]
INFO     2023-06-21 12:19:10.345 request id: app - logging:callHandlers - Started server process [18778]
INFO     2023-06-21 12:19:10.345 request id: app - logging:callHandlers - Started server process [18778]
INFO     2023-06-21 12:19:10.346 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:19:10.346 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:19:10.388 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:19:10.388 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:19:10.393 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:19:10.393 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:19:10.397 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:19:10.397 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:19:10.400 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:19:10.402 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:19:10.402 request id: app - logging:callHandlers - [generated in 0.00028s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:19:10.406 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:19:10.407 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:19:10.407 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:19:14.251 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:19:14.252 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:19:14.353 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:19:14.353 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:19:14.354 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:19:14.354 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:19:14.354 request id: app - logging:callHandlers - Finished server process [18778]
INFO     2023-06-21 12:19:14.354 request id: app - logging:callHandlers - Finished server process [18778]
INFO     2023-06-21 12:19:14.824 request id: app - logging:callHandlers - Started server process [18797]
INFO     2023-06-21 12:19:14.824 request id: app - logging:callHandlers - Started server process [18797]
INFO     2023-06-21 12:19:14.824 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:19:14.825 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:19:14.883 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:19:14.883 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:19:14.886 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:19:14.886 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:19:14.889 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:19:14.889 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:19:14.892 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:19:14.894 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:19:14.894 request id: app - logging:callHandlers - [generated in 0.00039s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:19:14.898 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:19:14.899 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:19:14.900 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:21:36.017 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:21:36.017 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:21:36.119 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:21:36.119 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:21:36.120 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:21:36.120 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:21:36.120 request id: app - logging:callHandlers - Finished server process [18797]
INFO     2023-06-21 12:21:36.121 request id: app - logging:callHandlers - Finished server process [18797]
INFO     2023-06-21 12:21:36.816 request id: app - logging:callHandlers - Started server process [19020]
INFO     2023-06-21 12:21:36.816 request id: app - logging:callHandlers - Started server process [19020]
INFO     2023-06-21 12:21:36.817 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:21:36.817 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:21:36.878 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:21:36.878 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:21:36.883 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:21:36.883 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:21:36.886 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:21:36.886 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:21:36.889 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:21:36.891 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:21:36.891 request id: app - logging:callHandlers - [generated in 0.00031s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:21:36.895 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:21:36.896 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:21:36.897 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:21:40.258 request id: app - logging:callHandlers - 127.0.0.1:59232 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 404
INFO     2023-06-21 12:21:41.278 request id: app - logging:callHandlers - 127.0.0.1:59232 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 404
INFO     2023-06-21 12:21:42.298 request id: app - logging:callHandlers - 127.0.0.1:59232 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 404
INFO     2023-06-21 12:21:43.700 request id: app - logging:callHandlers - 127.0.0.1:59232 - "GET /api/v1/download/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 404
INFO     2023-06-21 12:21:50.814 request id: app - logging:callHandlers - 127.0.0.1:59233 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:21:51.053 request id: app - logging:callHandlers - 127.0.0.1:59233 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:21:56.337 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:21:56.344 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:21:56.344 request id: app - logging:callHandlers - [generated in 0.00131s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:21:56.410 request id: app - logging:callHandlers - 127.0.0.1:59234 - "GET /api/v1/download-full/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:21:56.412 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:21:58.089 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:21:58.091 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:21:58.091 request id: app - logging:callHandlers - [cached since 1.749s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:21:58.122 request id: app - logging:callHandlers - 127.0.0.1:59234 - "GET /api/v1/download-full/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:21:58.124 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:21:58.824 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:21:58.825 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:21:58.826 request id: app - logging:callHandlers - [cached since 2.483s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:21:58.857 request id: app - logging:callHandlers - 127.0.0.1:59234 - "GET /api/v1/download-full/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:21:58.860 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:22:05.282 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:22:05.283 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:22:05.283 request id: app - logging:callHandlers - [cached since 8.94s ago] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:22:05.297 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:22:05.299 request id: app - logging:callHandlers - 127.0.0.1:59242 - "GET /api/v1/download-stream/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 500
ERROR    2023-06-21 12:22:05.300 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x105030ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f3da80>
           └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f3cfe0>
    └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11bde3b10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>
    │    └ <function subprocess_started at 0x107bc0e00>
    └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11bde8ed0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x107babe20>
           │       │   └ <uvicorn.server.Server object at 0x11bde8ed0>
           │       └ <function run at 0x105b71a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11bdf4040>
           │      └ <function Runner.run at 0x105be59e0>
           └ <asyncio.runners.Runner object at 0x107b695d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105bdf600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x107b695d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105bdf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105be53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105b72340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11bdeb010>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x11c154490>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11bdeb010>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11c15f710>
          └ <fastapi.applications.FastAPI object at 0x11c154490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x11c17a160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11c15f050>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11c15f710>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11c15f550>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11c15f050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x11c154550>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11c15f550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x11a2b8720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x11c146b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x11c1ee0d0>
                     └ <function get_request_handler.<locals>.app at 0x11c146ac0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x11a29ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x11c1ec850>, 'manager': <services.manager.FileManager object at 0x11c1...
                 │         └ <function get_file at 0x11bd2bd80>
                 └ <fastapi.dependencies.models.Dependant object at 0x11c15c7d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 56, in get_file
    return await manager.get_file_by_short_name(db, short_name=short_name)
                 │       │                      │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                      └ <sqlalchemy.orm.session.AsyncSession object at 0x11c1ec850>
                 │       └ <function FileManager.get_file_by_short_name at 0x11bd2b6a0>
                 └ <services.manager.FileManager object at 0x11c163b50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 67, in get_file_by_short_name
    media_type=file.media_type,
               └ <unprintable FileDbModel object>

AttributeError: 'FileDbModel' object has no attribute 'media_type'
ERROR    2023-06-21 12:22:05.319 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x105030ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104f3da80>
           └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104f3cfe0>
    └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11bde3b10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>
    │    └ <function subprocess_started at 0x107bc0e00>
    └ <SpawnProcess name='SpawnProcess-5' parent=18091 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x11bde8ed0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x107babe20>
           │       │   └ <uvicorn.server.Server object at 0x11bde8ed0>
           │       └ <function run at 0x105b71a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x11bdf4040>
           │      └ <function Runner.run at 0x105be59e0>
           └ <asyncio.runners.Runner object at 0x107b695d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x105bdf600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x107b695d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105bdf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105be53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105b72340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11bdeb010>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x11c154490>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x11bdeb010>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11c15f710>
          └ <fastapi.applications.FastAPI object at 0x11c154490>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x11c17a160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11c15f050>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11c15f710>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11c15f550>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11c15f050>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x11c154550>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11c15f550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x11a2b8720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x11c179ee0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11c1ebe90>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x11c146b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x11c1ee0d0>
                     └ <function get_request_handler.<locals>.app at 0x11c146ac0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 241, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x11a29ac00>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/routing.py", line 167, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'db': <sqlalchemy.orm.session.AsyncSession object at 0x11c1ec850>, 'manager': <services.manager.FileManager object at 0x11c1...
                 │         └ <function get_file at 0x11bd2bd80>
                 └ <fastapi.dependencies.models.Dependant object at 0x11c15c7d0>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/api/v1/files.py", line 56, in get_file
    return await manager.get_file_by_short_name(db, short_name=short_name)
                 │       │                      │              └ 'UGSEVtWqCLnG6JfiVVpWGi'
                 │       │                      └ <sqlalchemy.orm.session.AsyncSession object at 0x11c1ec850>
                 │       └ <function FileManager.get_file_by_short_name at 0x11bd2b6a0>
                 └ <services.manager.FileManager object at 0x11c163b50>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 67, in get_file_by_short_name
    media_type=file.media_type,
               └ <unprintable FileDbModel object>

AttributeError: 'FileDbModel' object has no attribute 'media_type'
INFO     2023-06-21 12:22:16.630 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:22:16.631 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:22:16.733 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:22:16.733 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:22:16.734 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:22:16.734 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:22:16.734 request id: app - logging:callHandlers - Finished server process [19020]
INFO     2023-06-21 12:22:16.734 request id: app - logging:callHandlers - Finished server process [19020]
INFO     2023-06-21 12:22:17.489 request id: app - logging:callHandlers - Started server process [19094]
INFO     2023-06-21 12:22:17.490 request id: app - logging:callHandlers - Started server process [19094]
INFO     2023-06-21 12:22:17.490 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:22:17.490 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:22:17.562 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:22:17.562 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:22:17.566 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:22:17.567 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:22:17.570 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:22:17.571 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:22:17.574 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:22:17.576 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:22:17.576 request id: app - logging:callHandlers - [generated in 0.00045s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:22:17.581 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:22:17.582 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:22:17.582 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:22:25.176 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:22:25.177 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:22:25.278 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:22:25.279 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:22:25.279 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:22:25.280 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:22:25.280 request id: app - logging:callHandlers - Finished server process [19094]
INFO     2023-06-21 12:22:25.280 request id: app - logging:callHandlers - Finished server process [19094]
INFO     2023-06-21 12:22:25.861 request id: app - logging:callHandlers - Started server process [19115]
INFO     2023-06-21 12:22:25.861 request id: app - logging:callHandlers - Started server process [19115]
INFO     2023-06-21 12:22:25.861 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:22:25.861 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:22:25.942 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:22:25.942 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:22:25.946 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:22:25.947 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:22:25.959 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:22:25.960 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:22:25.970 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:22:25.972 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:22:25.972 request id: app - logging:callHandlers - [generated in 0.00027s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:22:25.977 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:22:25.978 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:22:25.979 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:22:27.404 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:22:27.405 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:22:27.406 request id: app - logging:callHandlers - [generated in 0.00030s] ('UGSEVtWqCLnG6JfiVVpWGi',)
INFO     2023-06-21 12:22:27.443 request id: app - logging:callHandlers - 127.0.0.1:59250 - "GET /api/v1/download-stream/UGSEVtWqCLnG6JfiVVpWGi HTTP/1.1" 200
INFO     2023-06-21 12:23:52.240 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:23:52.241 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:23:52.343 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:23:52.343 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:23:53.254 request id: app - logging:callHandlers - Finished server process [19115]
INFO     2023-06-21 12:23:53.254 request id: app - logging:callHandlers - Finished server process [19115]
ERROR    2023-06-21 12:23:53.261 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:23:53.262 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:23:53.266 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:23:53.275 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10510cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x105019a80>
           └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105018fe0>
    └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10aee2f90>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>
    │    └ <function subprocess_started at 0x106cc0e00>
    └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10aee8350>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x106cabe20>
           │       │   └ <uvicorn.server.Server object at 0x10aee8350>
           │       └ <function run at 0x105d71a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x106c694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x105de58a0>
    └ <asyncio.runners.Runner object at 0x106c694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x105de5bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x105dc68e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x105ddf600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105ddf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105de53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105d72340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aee9990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10b077c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aee9990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b09a190>
          └ <fastapi.applications.FastAPI object at 0x10b077c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10b0b5760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10b09a1d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b09a190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10b09a250>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10b09a1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10b077d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10b09a250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107f5c720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10b082b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x10b0c0bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x107f3cae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x10b0c0bd0>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x10b0b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x105dc7740>
          │    └ <asyncio.locks.Event object at 0x10b0ac590 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:23:53.290 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x10510cae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x105019a80>
           └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x105018fe0>
    └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10aee2f90>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>
    │    └ <function subprocess_started at 0x106cc0e00>
    └ <SpawnProcess name='SpawnProcess-7' parent=18091 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10aee8350>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x106cabe20>
           │       │   └ <uvicorn.server.Server object at 0x10aee8350>
           │       └ <function run at 0x105d71a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x106c694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x105de58a0>
    └ <asyncio.runners.Runner object at 0x106c694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x105de5bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x105dc68e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x105ddf600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105ddf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105de53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105d72340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aee9990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10b077c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10aee9990>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b09a190>
          └ <fastapi.applications.FastAPI object at 0x10b077c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10b0b5760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10b09a1d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10b09a190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10b09a250>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10b09a1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10b077d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10b09a250>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x107f5c720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10b082b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10b0b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x10b0c0bd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x107f3cae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x10b0c0bd0>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x10b0b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x105dc7740>
          │    └ <asyncio.locks.Event object at 0x10b0ac590 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10b0aca50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:23:56.323 request id: app - logging:callHandlers - Started server process [19263]
INFO     2023-06-21 12:23:56.323 request id: app - logging:callHandlers - Started server process [19263]
INFO     2023-06-21 12:23:56.323 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:23:56.323 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:23:56.369 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:23:56.370 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:23:56.374 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:23:56.374 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:23:56.378 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:23:56.379 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:23:56.381 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:23:56.383 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:23:56.384 request id: app - logging:callHandlers - [generated in 0.00040s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:23:56.387 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:23:56.388 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:23:56.388 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:24:06.516 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:06.520 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 12:24:06.521 request id: app - logging:callHandlers - [generated in 0.00113s] (UUID('1fe57b33-aff6-4231-9166-fc1f5fb47945'), 'M9ZCNmSnesZkbeLGmtqu9h/263051.png', '263051.png', 7932, 'image/png', 'M9ZCNmSnesZkbeLGmtqu9h', datetime.datetime(2023, 6, 21, 9, 24, 6, 520332))
INFO     2023-06-21 12:24:06.552 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:24:06.558 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:06.560 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.id = $1::UUID
INFO     2023-06-21 12:24:06.560 request id: app - logging:callHandlers - [generated in 0.00043s] (UUID('1fe57b33-aff6-4231-9166-fc1f5fb47945'),)
INFO     2023-06-21 12:24:06.570 request id: app - logging:callHandlers - 127.0.0.1:59284 - "POST /api/v1/ HTTP/1.1" 200
INFO     2023-06-21 12:24:06.571 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:24:23.862 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:23.865 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:24:23.865 request id: app - logging:callHandlers - [generated in 0.00047s] ('M9ZCNmSnesZkbeLGmtqu9h',)
INFO     2023-06-21 12:24:23.897 request id: app - logging:callHandlers - 127.0.0.1:59289 - "GET /api/v1/download-stream/M9ZCNmSnesZkbeLGmtqu9h HTTP/1.1" 200
INFO     2023-06-21 12:24:23.898 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:24:28.330 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:28.331 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:24:28.332 request id: app - logging:callHandlers - [cached since 4.467s ago] ('M9ZCNmSnesZkbeLGmtqu9h',)
INFO     2023-06-21 12:24:28.358 request id: app - logging:callHandlers - 127.0.0.1:59289 - "GET /api/v1/download-stream/M9ZCNmSnesZkbeLGmtqu9h HTTP/1.1" 200
INFO     2023-06-21 12:24:28.361 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:24:29.196 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:29.199 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:24:29.200 request id: app - logging:callHandlers - [cached since 5.336s ago] ('M9ZCNmSnesZkbeLGmtqu9h',)
INFO     2023-06-21 12:24:29.221 request id: app - logging:callHandlers - 127.0.0.1:59289 - "GET /api/v1/download-stream/M9ZCNmSnesZkbeLGmtqu9h HTTP/1.1" 200
INFO     2023-06-21 12:24:29.224 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:24:29.899 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:29.901 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:24:29.901 request id: app - logging:callHandlers - [cached since 6.036s ago] ('M9ZCNmSnesZkbeLGmtqu9h',)
INFO     2023-06-21 12:24:29.917 request id: app - logging:callHandlers - 127.0.0.1:59289 - "GET /api/v1/download-stream/M9ZCNmSnesZkbeLGmtqu9h HTTP/1.1" 200
INFO     2023-06-21 12:24:29.919 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:24:30.557 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:24:30.558 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:24:30.559 request id: app - logging:callHandlers - [cached since 6.695s ago] ('M9ZCNmSnesZkbeLGmtqu9h',)
INFO     2023-06-21 12:24:30.580 request id: app - logging:callHandlers - 127.0.0.1:59289 - "GET /api/v1/download-stream/M9ZCNmSnesZkbeLGmtqu9h HTTP/1.1" 200
INFO     2023-06-21 12:25:03.761 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:25:03.762 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:25:03.863 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:25:03.863 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:25:07.405 request id: app - logging:callHandlers - Finished server process [19263]
INFO     2023-06-21 12:25:07.406 request id: app - logging:callHandlers - Finished server process [19263]
ERROR    2023-06-21 12:25:07.411 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:25:07.412 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:25:07.413 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:25:07.430 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ec4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104dd1a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104dd0fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1093e3750>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>
    │    └ <function subprocess_started at 0x1066ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1093e8b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1066d7e20>
           │       │   └ <uvicorn.server.Server object at 0x1093e8b10>
           │       └ <function run at 0x10623da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x106695410>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1062b18a0>
    └ <asyncio.runners.Runner object at 0x106695410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1062b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x1062928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1062ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1062ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1062b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10623e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1093ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109454390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1093ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10945fe90>
          └ <fastapi.applications.FastAPI object at 0x109454390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1094d7f60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10945f8d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10945fe90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10945ed10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10945f8d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x109454450>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10945ed10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1073ec720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x109446b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x1094636d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1073ccae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x1094636d0>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x109479940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x106293740>
          │    └ <asyncio.locks.Event object at 0x109473cd0 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:25:07.441 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104ec4ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104dd1a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104dd0fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1093e3750>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>
    │    └ <function subprocess_started at 0x1066ece00>
    └ <SpawnProcess name='SpawnProcess-1' parent=19260 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1093e8b10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1066d7e20>
           │       │   └ <uvicorn.server.Server object at 0x1093e8b10>
           │       └ <function run at 0x10623da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x106695410>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1062b18a0>
    └ <asyncio.runners.Runner object at 0x106695410>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1062b1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x1062928e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1062ab600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1062ab560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1062b13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10623e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1093ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109454390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x1093ea1d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10945fe90>
          └ <fastapi.applications.FastAPI object at 0x109454390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1094d7f60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10945f8d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10945fe90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10945ed10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10945f8d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x109454450>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10945ed10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1073ec720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x109446b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1094d7d80>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x1094636d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1073ccae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x1094636d0>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x109479940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x106293740>
          │    └ <asyncio.locks.Event object at 0x109473cd0 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109473ad0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:25:08.047 request id: app - logging:callHandlers - Started server process [19391]
INFO     2023-06-21 12:25:08.048 request id: app - logging:callHandlers - Started server process [19391]
INFO     2023-06-21 12:25:08.048 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:25:08.048 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:25:08.106 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:25:08.106 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:25:08.109 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:25:08.109 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:25:08.113 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:25:08.113 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:25:08.115 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:25:08.117 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:25:08.117 request id: app - logging:callHandlers - [generated in 0.00025s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:25:08.121 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:25:08.123 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:25:08.124 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:25:09.845 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:25:09.846 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:25:09.947 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:25:09.948 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:25:09.949 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:25:09.949 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:25:09.949 request id: app - logging:callHandlers - Finished server process [19391]
INFO     2023-06-21 12:25:09.950 request id: app - logging:callHandlers - Finished server process [19391]
INFO     2023-06-21 12:25:11.606 request id: app - logging:callHandlers - Started server process [19403]
INFO     2023-06-21 12:25:11.606 request id: app - logging:callHandlers - Started server process [19403]
INFO     2023-06-21 12:25:11.606 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:25:11.607 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:25:11.663 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:25:11.663 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:25:11.667 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:25:11.668 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:25:11.671 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:25:11.671 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:25:11.673 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:25:11.676 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:25:11.676 request id: app - logging:callHandlers - [generated in 0.00033s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:25:11.679 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:25:11.680 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:25:11.680 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:25:22.780 request id: app - logging:callHandlers - 127.0.0.1:59314 - "GET /api/openapi HTTP/1.1" 200
INFO     2023-06-21 12:25:23.020 request id: app - logging:callHandlers - 127.0.0.1:59314 - "GET /api/openapi.json HTTP/1.1" 200
INFO     2023-06-21 12:25:35.178 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:25:35.183 request id: app - logging:callHandlers - INSERT INTO files (id, path_in_storage, filename, size, file_type, short_name, created_at) VALUES ($1::UUID, $2::VARCHAR, $3::VARCHAR, $4::INTEGER, $5::VARCHAR, $6::VARCHAR, $7::TIMESTAMP WITHOUT TIME ZONE)
INFO     2023-06-21 12:25:35.185 request id: app - logging:callHandlers - [generated in 0.00242s] (UUID('2f53e086-402c-4d03-8b05-221df0619f27'), 'UFiAdvdXPnt9MJEzBTNEzy/Рабочая тетрадь 03.02.2022 - ВЭД, перспективы на 2022 год (Новикова Т.А.).pdf', 'Рабочая тетрадь 03.02.2022 - ВЭД, перспективы на 2022 год (Новикова Т.А.).pdf', 2467951, 'application/pdf', 'UFiAdvdXPnt9MJEzBTNEzy', datetime.datetime(2023, 6, 21, 9, 25, 35, 183454))
INFO     2023-06-21 12:25:35.195 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:25:35.200 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:25:35.203 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.id = $1::UUID
INFO     2023-06-21 12:25:35.203 request id: app - logging:callHandlers - [generated in 0.00029s] (UUID('2f53e086-402c-4d03-8b05-221df0619f27'),)
INFO     2023-06-21 12:25:35.214 request id: app - logging:callHandlers - 127.0.0.1:59315 - "POST /api/v1/ HTTP/1.1" 200
INFO     2023-06-21 12:25:35.214 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:25:44.584 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:25:44.586 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:25:44.586 request id: app - logging:callHandlers - [generated in 0.00055s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:25:44.625 request id: app - logging:callHandlers - 127.0.0.1:59323 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:25:44.627 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:25:44.628 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100528ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100435a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100434fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103f1f390>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>
    │    └ <function subprocess_started at 0x1013fce00>
    └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ba4710>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1013e7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ba4710>
           │       └ <function run at 0x100f4da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103f34040>
           │      └ <function Runner.run at 0x100fc19e0>
           └ <asyncio.runners.Runner object at 0x1013a54d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100fbb600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1013a54d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100fbb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100fc13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100f4e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103f25c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10483bc90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103f25c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10485e9d0>
          └ <fastapi.applications.FastAPI object at 0x10483bc90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1048e2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10485ec10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10485e9d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10485ee10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10485ec10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10483bd90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10485ee10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102094720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x104846b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x103e3ef10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
               │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0x1048897d0>
               │     └ <function create_task_group at 0x101ed4ae0>
               └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
          └ [ClientConnectionError('Connection closed')]
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.stream_response of <starlette.responses.StreamingResponse object at 0x103e3...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
                       │    └ <async_generator object FileManager.get_file_by_short_name.<locals>.s3_stream at 0x104803030>
                       └ <starlette.responses.StreamingResponse object at 0x103e3ef10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 62, in s3_stream
    async for chunk in result.content.iter_chunked(32 * 1024):
                       │      │       └ <function AsyncStreamReaderMixin.iter_chunked at 0x1025daf20>
                       │      └ <StreamReader 64959 bytes e=ClientConnectionError('Connection closed')>
                       └ <ClientResponse(http://localhost:9000/files/UFiAdvdXPnt9MJEzBTNEzy/%D0%A0%D0%B0%D0%B1%D0%BE%D1%87%D0%B0%D1%8F%20%D1%82%D0%B5%...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 35, in __anext__
    rv = await self.read_func()
               │    └ <function AsyncStreamReaderMixin.iter_chunked.<locals>.<lambda> at 0x104879940>
               └ <aiohttp.streams.AsyncStreamIterator object at 0x103e71dd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 349, in read
    raise self._exception
          │    └ ClientConnectionError('Connection closed')
          └ <StreamReader 64959 bytes e=ClientConnectionError('Connection closed')>

aiohttp.client_exceptions.ClientConnectionError: Connection closed
ERROR    2023-06-21 12:25:44.653 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100528ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x100435a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100434fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x103f1f390>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>
    │    └ <function subprocess_started at 0x1013fce00>
    └ <SpawnProcess name='SpawnProcess-1' parent=19401 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103ba4710>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=25, family=2, type=1, proto=0, laddr=('0.0.0.0', 8001)>]
           │       │   │    └ <function Server.serve at 0x1013e7e20>
           │       │   └ <uvicorn.server.Server object at 0x103ba4710>
           │       └ <function run at 0x100f4da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 190, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x103f34040>
           │      └ <function Runner.run at 0x100fc19e0>
           └ <asyncio.runners.Runner object at 0x1013a54d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/li...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x100fbb600>
           │    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x1013a54d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100fbb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100fc13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100f4e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103f25c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10483bc90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103f25c50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10485e9d0>
          └ <fastapi.applications.FastAPI object at 0x10483bc90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 184, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1048e2200>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10485ec10>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10485e9d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10485ee10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10485ec10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 20, in __call__
    raise e
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10483bd90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10485ee10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x102094720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x104846b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1048e1da0>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10488b090>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x103e3ef10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 270, in __call__
    async with anyio.create_task_group() as task_group:
               │     │                      └ <anyio._backends._asyncio.TaskGroup object at 0x1048897d0>
               │     └ <function create_task_group at 0x101ed4ae0>
               └ <module 'anyio' from '/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/__ini...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/anyio/_backends/_asyncio.py", line 597, in __aexit__
    raise exceptions[0]
          └ [ClientConnectionError('Connection closed')]
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.stream_response of <starlette.responses.StreamingResponse object at 0x103e3...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 262, in stream_response
    async for chunk in self.body_iterator:
                       │    └ <async_generator object FileManager.get_file_by_short_name.<locals>.s3_stream at 0x104803030>
                       └ <starlette.responses.StreamingResponse object at 0x103e3ef10>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/fastApiProject/services/manager.py", line 62, in s3_stream
    async for chunk in result.content.iter_chunked(32 * 1024):
                       │      │       └ <function AsyncStreamReaderMixin.iter_chunked at 0x1025daf20>
                       │      └ <StreamReader 64959 bytes e=ClientConnectionError('Connection closed')>
                       └ <ClientResponse(http://localhost:9000/files/UFiAdvdXPnt9MJEzBTNEzy/%D0%A0%D0%B0%D0%B1%D0%BE%D1%87%D0%B0%D1%8F%20%D1%82%D0%B5%...

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 35, in __anext__
    rv = await self.read_func()
               │    └ <function AsyncStreamReaderMixin.iter_chunked.<locals>.<lambda> at 0x104879940>
               └ <aiohttp.streams.AsyncStreamIterator object at 0x103e71dd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/aiohttp/streams.py", line 349, in read
    raise self._exception
          │    └ ClientConnectionError('Connection closed')
          └ <StreamReader 64959 bytes e=ClientConnectionError('Connection closed')>

aiohttp.client_exceptions.ClientConnectionError: Connection closed
INFO     2023-06-21 12:26:20.082 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:26:20.083 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:26:20.184 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:26:20.184 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:26:20.185 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:26:20.185 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:26:20.186 request id: app - logging:callHandlers - Finished server process [19403]
INFO     2023-06-21 12:26:20.186 request id: app - logging:callHandlers - Finished server process [19403]
INFO     2023-06-21 12:26:20.849 request id: app - logging:callHandlers - Started server process [19526]
INFO     2023-06-21 12:26:20.850 request id: app - logging:callHandlers - Started server process [19526]
INFO     2023-06-21 12:26:20.850 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:26:20.850 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:26:20.901 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:26:20.901 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:26:20.906 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:26:20.906 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:26:20.909 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:26:20.909 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:26:20.912 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:26:20.914 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:26:20.914 request id: app - logging:callHandlers - [generated in 0.00030s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:26:20.918 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:26:20.926 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:26:20.927 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:26:22.349 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:26:22.354 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:26:22.354 request id: app - logging:callHandlers - [generated in 0.00067s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:26:22.401 request id: app - logging:callHandlers - 127.0.0.1:59341 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:28:10.131 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:28:10.133 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:28:10.244 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:28:10.245 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:28:10.852 request id: app - logging:callHandlers - Finished server process [19526]
INFO     2023-06-21 12:28:10.854 request id: app - logging:callHandlers - Finished server process [19526]
ERROR    2023-06-21 12:28:10.860 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:28:10.861 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:28:10.866 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:28:10.896 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104538ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104445a80>
           └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104444fe0>
    └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x110fe7c90>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>
    │    └ <function subprocess_started at 0x10540ce00>
    └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x110fe9050>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1053f7e20>
           │       │   └ <uvicorn.server.Server object at 0x110fe9050>
           │       └ <function run at 0x104f5da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1053b54d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x104fd18a0>
    └ <asyncio.runners.Runner object at 0x1053b54d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x104fd1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelled name='starlette.responses.StreamingResponse.__call__.<locals>.wrap' coro=<StreamingResponse.__call__.<locals...
    │    │                  │     └ <function gather at 0x104fb28e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x104fcb600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104fcb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104fd13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104f5e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110fea4d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x111190510>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110fea4d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11119a290>
          └ <fastapi.applications.FastAPI object at 0x111190510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1111b5760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111199850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11119a290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11119ab90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111199850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x111190610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11119ab90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1073c4720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x111182b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x1111f3810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1073a4ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x1111f3810>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1111b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x104fb3740>
          │    └ <asyncio.locks.Event object at 0x1111aca10 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:28:10.908 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104538ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104445a80>
           └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104444fe0>
    └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x110fe7c90>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>
    │    └ <function subprocess_started at 0x10540ce00>
    └ <SpawnProcess name='SpawnProcess-2' parent=19401 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x110fe9050>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1053f7e20>
           │       │   └ <uvicorn.server.Server object at 0x110fe9050>
           │       └ <function run at 0x104f5da80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1053b54d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x104fd18a0>
    └ <asyncio.runners.Runner object at 0x1053b54d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x104fd1bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelled name='starlette.responses.StreamingResponse.__call__.<locals>.wrap' coro=<StreamingResponse.__call__.<locals...
    │    │                  │     └ <function gather at 0x104fb28e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x104fcb600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104fcb560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104fd13a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104f5e340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110fea4d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x111190510>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x110fea4d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11119a290>
          └ <fastapi.applications.FastAPI object at 0x111190510>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1111b5760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111199850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11119a290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11119ab90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x111199850>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x111190610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11119ab90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1073c4720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x111182b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1111b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x1111f3810>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1073a4ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x1111f3810>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1111b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x104fb3740>
          │    └ <asyncio.locks.Event object at 0x1111aca10 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1111ac750>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:28:21.709 request id: app - logging:callHandlers - Started server process [19757]
INFO     2023-06-21 12:28:21.709 request id: app - logging:callHandlers - Started server process [19757]
INFO     2023-06-21 12:28:21.710 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:28:21.710 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:28:21.756 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:28:21.756 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:28:21.759 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:28:21.759 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:28:21.761 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:28:21.762 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:28:21.763 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:28:21.765 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:28:21.766 request id: app - logging:callHandlers - [generated in 0.00034s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:28:21.770 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:28:21.771 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:28:21.772 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:28:30.210 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:28:30.215 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:28:30.216 request id: app - logging:callHandlers - [generated in 0.00073s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:28:30.506 request id: app - logging:callHandlers - 127.0.0.1:59426 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:30:50.098 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:30:50.101 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:30:50.204 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:30:50.208 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:30:51.624 request id: app - logging:callHandlers - Finished server process [19757]
INFO     2023-06-21 12:30:51.624 request id: app - logging:callHandlers - Finished server process [19757]
ERROR    2023-06-21 12:30:51.636 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:30:51.636 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:30:51.640 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:30:51.660 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104548ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104455a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104454fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11251f510>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>
    │    └ <function subprocess_started at 0x1078c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1125248d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1078abe20>
           │       │   └ <uvicorn.server.Server object at 0x1125248d0>
           │       └ <function run at 0x106171a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1078695d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1061e58a0>
    └ <asyncio.runners.Runner object at 0x1078695d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1061e5bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-6' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x1061c68e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1061df600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1061df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1061e53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106172340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x112525c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112577c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x112525c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1124ee310>
          └ <fastapi.applications.FastAPI object at 0x112577c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1125b4d60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11259a0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1124ee310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11259a110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11259a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112577d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11259a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1104e4720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x112582b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x112472350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1104c4ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x112472350>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1125b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x1061c7740>
          │    └ <asyncio.locks.Event object at 0x11259db50 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:30:51.670 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x104548ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104455a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104454fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x11251f510>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>
    │    └ <function subprocess_started at 0x1078c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=19755 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1125248d0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1078abe20>
           │       │   └ <uvicorn.server.Server object at 0x1125248d0>
           │       └ <function run at 0x106171a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1078695d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1061e58a0>
    └ <asyncio.runners.Runner object at 0x1078695d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1061e5bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-6' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x1061c68e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1061df600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1061df560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1061e53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x106172340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x112525c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x112577c90>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x112525c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1124ee310>
          └ <fastapi.applications.FastAPI object at 0x112577c90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1125b4d60>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11259a0d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1124ee310>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11259a110>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x11259a0d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x112577d90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11259a110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1104e4720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x112582b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1125b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x112472350>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1104c4ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x112472350>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1125b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x1061c7740>
          │    └ <asyncio.locks.Event object at 0x11259db50 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x11259d290>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:31:30.623 request id: app - logging:callHandlers - Started server process [20090]
INFO     2023-06-21 12:31:30.623 request id: app - logging:callHandlers - Started server process [20090]
INFO     2023-06-21 12:31:30.623 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:31:30.623 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:31:30.724 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:31:30.725 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:31:30.727 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:31:30.728 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:31:30.730 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:31:30.730 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:31:30.734 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:30.736 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:31:30.736 request id: app - logging:callHandlers - [generated in 0.00042s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:31:30.742 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:31:30.743 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:31:30.744 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:31:46.004 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:46.008 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:46.009 request id: app - logging:callHandlers - [generated in 0.00052s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:46.115 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:46.122 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:48.729 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:48.730 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:48.731 request id: app - logging:callHandlers - [cached since 2.722s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:48.799 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:48.819 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:49.515 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:49.516 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:49.517 request id: app - logging:callHandlers - [cached since 3.509s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:49.591 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:49.610 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:50.303 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:50.305 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:50.305 request id: app - logging:callHandlers - [cached since 4.297s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:50.380 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:50.399 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:50.962 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:50.964 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:50.965 request id: app - logging:callHandlers - [cached since 4.957s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:51.015 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:51.032 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:51.794 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:51.795 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:51.796 request id: app - logging:callHandlers - [cached since 5.788s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:51.856 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:51.865 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:52.366 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:52.366 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:52.367 request id: app - logging:callHandlers - [cached since 6.359s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:52.421 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-full/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:31:52.434 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:31:57.085 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:31:57.087 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:31:57.088 request id: app - logging:callHandlers - [cached since 11.08s ago] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:31:57.126 request id: app - logging:callHandlers - 127.0.0.1:59511 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:33:02.856 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:33:02.857 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:33:02.959 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:33:02.960 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:33:04.788 request id: app - logging:callHandlers - Finished server process [20090]
INFO     2023-06-21 12:33:04.789 request id: app - logging:callHandlers - Finished server process [20090]
ERROR    2023-06-21 12:33:04.795 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:33:04.796 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:33:04.797 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:33:04.822 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100494ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1003a1a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1003a0fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10511e810>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>
    │    └ <function subprocess_started at 0x1014c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10511fb10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1014abe20>
           │       │   └ <uvicorn.server.Server object at 0x10511fb10>
           │       └ <function run at 0x100eb9a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1014694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x100f2d8a0>
    └ <asyncio.runners.Runner object at 0x1014694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x100f2dbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelled name='starlette.responses.StreamingResponse.__call__.<locals>.wrap' coro=<StreamingResponse.__call__.<locals...
    │    │                  │     └ <function gather at 0x100f0e8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x100f27600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f27560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f2d3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eba340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105129110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105177390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105129110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10519b210>
          └ <fastapi.applications.FastAPI object at 0x105177390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1051f5b20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10519b450>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10519b210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10519b290>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10519b450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105177490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10519b290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x103218720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x105182b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x105212b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1031f8ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x105212b90>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1051b5260>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x100f0f740>
          │    └ <asyncio.locks.Event object at 0x105229510 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:33:04.837 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x100494ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x1003a1a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1003a0fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10511e810>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>
    │    └ <function subprocess_started at 0x1014c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20086 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10511fb10>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1014abe20>
           │       │   └ <uvicorn.server.Server object at 0x10511fb10>
           │       └ <function run at 0x100eb9a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1014694d0>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x100f2d8a0>
    └ <asyncio.runners.Runner object at 0x1014694d0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x100f2dbc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelled name='starlette.responses.StreamingResponse.__call__.<locals>.wrap' coro=<StreamingResponse.__call__.<locals...
    │    │                  │     └ <function gather at 0x100f0e8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x100f27600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x100f27560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x100f2d3a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x100eba340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105129110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105177390>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105129110>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10519b210>
          └ <fastapi.applications.FastAPI object at 0x105177390>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1051f5b20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10519b450>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10519b210>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10519b290>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10519b450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105177490>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10519b290>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x103218720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x105182b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1051f63e0>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x105212b90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1031f8ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x105212b90>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1051b5260>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x100f0f740>
          │    └ <asyncio.locks.Event object at 0x105229510 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x10522afd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:33:05.489 request id: app - logging:callHandlers - Started server process [20249]
INFO     2023-06-21 12:33:05.489 request id: app - logging:callHandlers - Started server process [20249]
INFO     2023-06-21 12:33:05.489 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:33:05.489 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:33:05.544 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:33:05.545 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:33:05.549 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:33:05.549 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:33:05.561 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:33:05.561 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:33:05.563 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:33:05.565 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:33:05.565 request id: app - logging:callHandlers - [generated in 0.00025s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:33:05.571 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:33:05.573 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:33:05.573 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:33:11.663 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:33:11.664 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:33:11.664 request id: app - logging:callHandlers - [generated in 0.00027s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:33:11.722 request id: app - logging:callHandlers - 127.0.0.1:59529 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:33:37.194 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:33:37.196 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:33:37.298 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:33:37.299 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:33:37.603 request id: app - logging:callHandlers - Finished server process [20249]
INFO     2023-06-21 12:33:37.603 request id: app - logging:callHandlers - Finished server process [20249]
ERROR    2023-06-21 12:33:37.612 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:33:37.613 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:33:37.616 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:33:37.636 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e60ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d6da80>
           └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d6cfe0>
    └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106523550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>
    │    └ <function subprocess_started at 0x103d34e00>
    └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106528910>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103d1fe20>
           │       │   └ <uvicorn.server.Server object at 0x106528910>
           │       └ <function run at 0x103885a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x105e22650>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1038f98a0>
    └ <asyncio.runners.Runner object at 0x105e22650>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1038f9bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-6' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x1038da8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1038f3600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1038f3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1038f93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103886340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10652ac10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106577fd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10652ac10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1065123d0>
          └ <fastapi.applications.FastAPI object at 0x106577fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106582de0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10659b650>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1065123d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10659ab90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10659b650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106590110>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10659ab90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1049cc720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106582b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x1065fee50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1049acae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x1065fee50>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1065b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x1038db740>
          │    └ <asyncio.locks.Event object at 0x1065b0450 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:33:37.650 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x102e60ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x102d6da80>
           └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102d6cfe0>
    └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x106523550>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>
    │    └ <function subprocess_started at 0x103d34e00>
    └ <SpawnProcess name='SpawnProcess-2' parent=20086 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x106528910>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x103d1fe20>
           │       │   └ <uvicorn.server.Server object at 0x106528910>
           │       └ <function run at 0x103885a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x105e22650>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x1038f98a0>
    └ <asyncio.runners.Runner object at 0x105e22650>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x1038f9bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelling name='Task-6' coro=<RequestResponseCycle.run_asgi() running at /Users/romanvolodin/Desktop/YAP/Author/Djang...
    │    │                  │     └ <function gather at 0x1038da8e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x1038f3600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1038f3560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1038f93a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103886340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10652ac10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x106577fd0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x10652ac10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1065123d0>
          └ <fastapi.applications.FastAPI object at 0x106577fd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106582de0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10659b650>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1065123d0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10659ab90>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x10659b650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x106590110>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10659ab90>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1049cc720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x106582b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1065b5800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x1065fee50>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1049acae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x1065fee50>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x1065b5940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x1038db740>
          │    └ <asyncio.locks.Event object at 0x1065b0450 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1065b3690>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:33:39.985 request id: app - logging:callHandlers - Started server process [20313]
INFO     2023-06-21 12:33:39.985 request id: app - logging:callHandlers - Started server process [20313]
INFO     2023-06-21 12:33:39.985 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:33:39.985 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:33:40.042 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:33:40.042 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:33:40.045 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:33:40.045 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:33:40.048 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:33:40.048 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:33:40.050 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:33:40.052 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:33:40.052 request id: app - logging:callHandlers - [generated in 0.00023s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:33:40.055 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:33:40.056 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:33:40.056 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:33:43.882 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:33:43.887 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:33:43.888 request id: app - logging:callHandlers - [generated in 0.00051s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:33:43.966 request id: app - logging:callHandlers - 127.0.0.1:59555 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:36:51.807 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:36:51.808 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:36:51.912 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:36:51.912 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:36:54.956 request id: app - logging:callHandlers - Finished server process [20313]
INFO     2023-06-21 12:36:54.957 request id: app - logging:callHandlers - Finished server process [20313]
ERROR    2023-06-21 12:36:54.961 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:36:54.962 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:36:54.965 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:36:54.975 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x103214ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x103121a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x103120fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x109a1ec50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>
    │    └ <function subprocess_started at 0x1056c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x109a1ff90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1056abe20>
           │       │   └ <uvicorn.server.Server object at 0x109a1ff90>
           │       └ <function run at 0x103e71a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1095b1550>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103ee58a0>
    └ <asyncio.runners.Runner object at 0x1095b1550>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103ee5bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelled name='starlette.responses.StreamingResponse.__call__.<locals>.wrap' coro=<StreamingResponse.__call__.<locals...
    │    │                  │     └ <function gather at 0x103ec68e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103edf600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103edf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103ee53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103e72340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x109a29650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109c3b550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x109a29650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109c5d950>
          └ <fastapi.applications.FastAPI object at 0x109c3b550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x109c79760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109c5dcd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109c5d950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109c5da10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109c5dcd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x109c3b610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109c5da10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1072f8720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x109c46b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x109a28190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1072d8ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x109a28190>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x109c79940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x103ec7740>
          │    └ <asyncio.locks.Event object at 0x109c62d90 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:36:54.990 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x103214ae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x103121a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x103120fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x109a1ec50>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>
    │    └ <function subprocess_started at 0x1056c0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20309 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x109a1ff90>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x1056abe20>
           │       │   └ <uvicorn.server.Server object at 0x109a1ff90>
           │       └ <function run at 0x103e71a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1095b1550>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x103ee58a0>
    └ <asyncio.runners.Runner object at 0x1095b1550>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x103ee5bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task cancelled name='starlette.responses.StreamingResponse.__call__.<locals>.wrap' coro=<StreamingResponse.__call__.<locals...
    │    │                  │     └ <function gather at 0x103ec68e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x103edf600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x103edf560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103ee53a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103e72340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x109a29650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x109c3b550>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x109a29650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109c5d950>
          └ <fastapi.applications.FastAPI object at 0x109c3b550>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x109c79760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109c5dcd0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x109c5d950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109c5da10>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x109c5dcd0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x109c3b610>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x109c5da10>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x1072f8720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x109c46b60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x109c79800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x109a28190>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x1072d8ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x109a28190>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x109c79940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x103ec7740>
          │    └ <asyncio.locks.Event object at 0x109c62d90 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x109c63fd0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
INFO     2023-06-21 12:36:55.669 request id: app - logging:callHandlers - Started server process [20620]
INFO     2023-06-21 12:36:55.669 request id: app - logging:callHandlers - Started server process [20620]
INFO     2023-06-21 12:36:55.669 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:36:55.670 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:36:55.719 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:36:55.719 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:36:55.722 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:36:55.722 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:36:55.725 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:36:55.725 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:36:55.727 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:36:55.729 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:36:55.729 request id: app - logging:callHandlers - [generated in 0.00032s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:36:55.733 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:36:55.734 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:36:55.734 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:37:02.007 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:37:02.009 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:37:02.010 request id: app - logging:callHandlers - [generated in 0.00059s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:37:11.618 request id: app - logging:callHandlers - 127.0.0.1:59619 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:37:11.622 request id: app - logging:callHandlers - ROLLBACK
INFO     2023-06-21 12:38:56.673 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:38:56.674 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:38:56.776 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:38:56.778 request id: app - logging:callHandlers - Waiting for application shutdown.
INFO     2023-06-21 12:38:56.781 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:38:56.781 request id: app - logging:callHandlers - Application shutdown complete.
INFO     2023-06-21 12:38:56.782 request id: app - logging:callHandlers - Finished server process [20620]
INFO     2023-06-21 12:38:56.782 request id: app - logging:callHandlers - Finished server process [20620]
INFO     2023-06-21 12:38:58.930 request id: app - logging:callHandlers - Started server process [20838]
INFO     2023-06-21 12:38:58.930 request id: app - logging:callHandlers - Started server process [20838]
INFO     2023-06-21 12:38:58.931 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:38:58.931 request id: app - logging:callHandlers - Waiting for application startup.
INFO     2023-06-21 12:38:58.991 request id: app - logging:callHandlers - select pg_catalog.version()
INFO     2023-06-21 12:38:58.992 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:38:58.995 request id: app - logging:callHandlers - select current_schema()
INFO     2023-06-21 12:38:58.996 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:38:58.999 request id: app - logging:callHandlers - show standard_conforming_strings
INFO     2023-06-21 12:38:58.999 request id: app - logging:callHandlers - [raw sql] ()
INFO     2023-06-21 12:38:59.001 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:38:59.003 request id: app - logging:callHandlers - SELECT pg_catalog.pg_class.relname 
FROM pg_catalog.pg_class JOIN pg_catalog.pg_namespace ON pg_catalog.pg_namespace.oid = pg_catalog.pg_class.relnamespace 
WHERE pg_catalog.pg_class.relname = $1::VARCHAR AND pg_catalog.pg_class.relkind = ANY (ARRAY[$2::VARCHAR, $3::VARCHAR, $4::VARCHAR, $5::VARCHAR, $6::VARCHAR]) AND pg_catalog.pg_table_is_visible(pg_catalog.pg_class.oid) AND pg_catalog.pg_namespace.nspname != $7::VARCHAR
INFO     2023-06-21 12:38:59.003 request id: app - logging:callHandlers - [generated in 0.00034s] ('files', 'r', 'p', 'f', 'v', 'm', 'pg_catalog')
INFO     2023-06-21 12:38:59.019 request id: app - logging:callHandlers - COMMIT
INFO     2023-06-21 12:38:59.021 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:38:59.021 request id: app - logging:callHandlers - Application startup complete.
INFO     2023-06-21 12:39:30.364 request id: app - logging:callHandlers - BEGIN (implicit)
INFO     2023-06-21 12:39:30.367 request id: app - logging:callHandlers - SELECT files.id, files.path_in_storage, files.filename, files.size, files.file_type, files.short_name, files.created_at 
FROM files 
WHERE files.short_name = $1::VARCHAR
INFO     2023-06-21 12:39:30.367 request id: app - logging:callHandlers - [generated in 0.00039s] ('UFiAdvdXPnt9MJEzBTNEzy',)
INFO     2023-06-21 12:39:30.420 request id: app - logging:callHandlers - 127.0.0.1:59678 - "GET /api/v1/download-stream/UFiAdvdXPnt9MJEzBTNEzy HTTP/1.1" 200
INFO     2023-06-21 12:40:42.250 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:40:42.251 request id: app - logging:callHandlers - Shutting down
INFO     2023-06-21 12:40:42.353 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:40:42.353 request id: app - logging:callHandlers - Waiting for connections to close. (CTRL+C to force quit)
INFO     2023-06-21 12:40:43.870 request id: app - logging:callHandlers - Finished server process [20838]
INFO     2023-06-21 12:40:43.871 request id: app - logging:callHandlers - Finished server process [20838]
ERROR    2023-06-21 12:40:43.875 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

ERROR    2023-06-21 12:40:43.875 request id: app - logging:callHandlers - Traceback (most recent call last):
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 686, in lifespan
    await receive()
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/lifespan/on.py", line 139, in receive
    return await self.receive_queue.get()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/queues.py", line 158, in get
    await getter
asyncio.exceptions.CancelledError

INFO     2023-06-21 12:40:43.878 request id: app - logging:callHandlers - ROLLBACK
ERROR    2023-06-21 12:40:43.889 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1050dcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104fe9a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104fe8fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10860bf10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>
    │    └ <function subprocess_started at 0x105fb0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108611290>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x105f9be20>
           │       │   └ <uvicorn.server.Server object at 0x108611290>
           │       └ <function run at 0x105b01a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1085a5a50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x105b758a0>
    └ <asyncio.runners.Runner object at 0x1085a5a50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x105b75bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x105b568e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x105b6f600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105b6f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105b753a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105b02340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108612950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108674ad0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108612950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108683890>
          └ <fastapi.applications.FastAPI object at 0x108674ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10869d760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108683450>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108683890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108683650>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108683450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108674b90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108683650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106c48720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10866ab60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x108686150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x106c28ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x108686150>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x10869d940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x105b57740>
          │    └ <asyncio.locks.Event object at 0x1085d3650 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
ERROR    2023-06-21 12:40:43.902 request id: app - logging:callHandlers - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 120, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 3
               │     └ 28
               └ <function _main at 0x1050dcae0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/spawn.py", line 133, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 3
           │    └ <function BaseProcess._bootstrap at 0x104fe9a80>
           └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104fe8fe0>
    └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10860bf10>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>
    │    └ <function subprocess_started at 0x105fb0e00>
    └ <SpawnProcess name='SpawnProcess-1' parent=20834 started>

  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/_subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x108611290>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/server.py", line 61, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket [closed] fd=-1, family=2, type=1, proto=0>]
           │       │   │    └ <function Server.serve at 0x105f9be20>
           │       │   └ <uvicorn.server.Server object at 0x108611290>
           │       └ <function run at 0x105b01a80>
           └ <module 'asyncio' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyn...

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 189, in run
    with Runner(debug=debug) as runner:
         │            │         └ <asyncio.runners.Runner object at 0x1085a5a50>
         │            └ None
         └ <class 'asyncio.runners.Runner'>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 63, in __exit__
    self.close()
    │    └ <function Runner.close at 0x105b758a0>
    └ <asyncio.runners.Runner object at 0x1085a5a50>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 71, in close
    _cancel_all_tasks(loop)
    │                 └ <_UnixSelectorEventLoop running=True closed=False debug=False>
    └ <function _cancel_all_tasks at 0x105b75bc0>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/runners.py", line 201, in _cancel_all_tasks
    loop.run_until_complete(tasks.gather(*to_cancel, return_exceptions=True))
    │    │                  │     │       └ {<Task finished name='Task-2' coro=<LifespanOn.main() done, defined at /Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMi...
    │    │                  │     └ <function gather at 0x105b568e0>
    │    │                  └ <module 'asyncio.tasks' from '/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.1...
    │    └ <function BaseEventLoop.run_until_complete at 0x105b6f600>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 640, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105b6f560>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 607, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105b753a0>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/base_events.py", line 1922, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x105b02340>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup(<Future finished result=None>)>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup(<Future finished result=None>)>

> File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 428, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108612950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/middleware/proxy_headers.py", line 78, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x108674ad0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x108612950>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/applications.py", line 282, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/applications.py", line 122, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108683890>
          └ <fastapi.applications.FastAPI object at 0x108674ad0>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/errors.py", line 162, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x10869d760>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108683450>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x108683890>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108683650>
          └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x108683450>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/fastapi/middleware/asyncexitstack.py", line 17, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x108674b90>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x108683650>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │     └ <function Route.handle at 0x106c48720>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          │    └ <function request_response.<locals>.app at 0x10866ab60>
          └ APIRoute(path='/api/v1/download-stream/{short_name}', name='get_file', methods=['GET'])
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/routing.py", line 69, in app
    await response(scope, receive, send)
          │        │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10869d800>
          │        │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8001), 'cl...
          └ <starlette.responses.StreamingResponse object at 0x108686150>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 277, in __call__
    await wrap(partial(self.listen_for_disconnect, receive))
          │    │       │    │                      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
          │    │       │    └ <function StreamingResponse.listen_for_disconnect at 0x106c28ae0>
          │    │       └ <starlette.responses.StreamingResponse object at 0x108686150>
          │    └ <class 'functools.partial'>
          └ <function StreamingResponse.__call__.<locals>.wrap at 0x10869d940>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 273, in wrap
    await func()
          └ functools.partial(<bound method StreamingResponse.listen_for_disconnect of <starlette.responses.StreamingResponse object at 0...
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/starlette/responses.py", line 250, in listen_for_disconnect
    message = await receive()
                    └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>>
  File "/Users/romanvolodin/Desktop/YAP/Author/DjangoFastAPIMinio/venv/lib/python3.11/site-packages/uvicorn/protocols/http/h11_impl.py", line 564, in receive
    await self.message_event.wait()
          │    │             └ <function Event.wait at 0x105b57740>
          │    └ <asyncio.locks.Event object at 0x1085d3650 [unset]>
          └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1086a8550>

  File "/opt/homebrew/Cellar/python@3.11/3.11.3/Frameworks/Python.framework/Versions/3.11/lib/python3.11/asyncio/locks.py", line 213, in wait
    await fut
          └ <Future cancelled>

asyncio.exceptions.CancelledError
